/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"ac41d975dc7fcac86e91.css"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(t,n,a){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,l=[],s=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(a=o.call(n)).done)&&(l.push(a.value),l.length!==t);s=!0);}catch(e){i=!0,r=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(i)throw r}}return l}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function u(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var s=a&&a.prototype instanceof l?a:l,i=Object.create(s.prototype);return d(i,"_invoke",function(n,a,r){var o,l,s,i=0,u=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,l=0,s=e,f.n=n,c}};function m(n,a){for(l=n,s=a,t=0;!d&&i&&!r&&t<u.length;t++){var r,o=u[t],m=f.p,g=o[2];n>3?(r=g===a)&&(s=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(l=0,f.v=a,f.n=o[1]):m<g&&(r=n<3||o[0]>a||a>g)&&(o[4]=n,o[5]=a,f.n=g,l=0))}if(r||n>1)return c;throw d=!0,a}return function(r,u,g){if(i>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,g),l=u,s=g;(t=l<2?e:s)||!d;){o||(l?l<3?(l>1&&(f.n=-1),m(l,s)):f.n=s:f.v=s);try{if(i=2,o){if(l||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==c)break}catch(t){o=e,l=1,s=t}finally{i=1}}return{value:t,done:d}}}(n,r,o),!0),i}var c={};function l(){}function s(){}function i(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(d(t={},a,function(){return this}),t),m=i.prototype=l.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,d(e,r,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=i,d(m,"constructor",i),d(i,"constructor",s),s.displayName="GeneratorFunction",d(i,r,"GeneratorFunction"),d(m),d(m,r,"Generator"),d(m,a,function(){return this}),d(m,"toString",function(){return"[object Generator]"}),(u=function(){return{w:o,m:g}})()}function d(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}d=function(e,t,n,a){function o(t,n){d(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},d(e,t,n,a)}function f(e,t,n,a,r,o,c){try{var l=e[o](c),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){f(o,a,r,c,l,"next",e)}function l(e){f(o,a,r,c,l,"throw",e)}c(void 0)})}}var g="Wiz_Cfg_SN_Col",p="Wiz_Cfg_Amt_Col",h="Wiz_Cfg_Data_Range",v="Wiz_Cfg_Header_Row";function y(e){for(var t="",n=e;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}function b(e){var t=0;e=e.toUpperCase();for(var n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-64);return t-1}function w(e){var t=e.match(/![\$]?([A-Z]+)[\$]?:[\$]?[A-Z]+/i);return t&&t[1]?t[1].toUpperCase():null}var x=[],I=[],k=null,E=[],S={filteredRowCount:0,totalAmount:0,isValid:!1};function C(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("message-area");n&&(n.textContent=e,n.className=t?"message-area error":"message-area success"),console.log(e)}function A(e,t){var n=document.getElementById("progress-overlay"),a=document.getElementById("progress-title"),r=document.getElementById("progress-message"),o=document.getElementById("progress-bar"),c=document.getElementById("progress-detail");n&&a&&r&&o&&c&&(a.textContent=e,r.textContent=t,o.style.width="0%",c.textContent="",n.classList.add("show"))}function R(e,t,n){var a=document.getElementById("progress-bar"),r=document.getElementById("progress-detail");if(a&&r){var o=t>0?Math.round(e/t*100):0;a.style.width="".concat(o,"%"),r.textContent=n||"".concat(e," / ").concat(t)}}function V(){var e=document.getElementById("progress-overlay");e&&e.classList.remove("show")}function N(e){var t=document.getElementById("debug-log");if(t){var n=document.createElement("div");n.textContent=e,n.style.marginBottom="2px",t.appendChild(n),t.scrollTop=t.scrollHeight}console.log(e)}function T(){var e=[];S.isValid&&(e.push("筛选出的总条数：".concat(S.filteredRowCount)),e.push("对应合计金额：".concat(S.totalAmount.toFixed(2))),e.push(""));for(var t=!1,n=0,a=E;n<a.length;n++){var r=a[n];if(r.selectedValues.size<r.allValues.length&&r.selectedValues.size>0){var o=Array.from(r.selectedValues),c=o.length>5?o.slice(0,5).join("、")+"...等".concat(o.length,"项"):o.join("、");e.push("【".concat(r.headerText,"】：").concat(c)),t=!0}}return t||S.isValid?e.join("\n"):"无筛选条件"}function B(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("filter-text-container"),n=document.getElementById("filter-text-content");if(t&&n){var a=T();if("无筛选条件"===a&&e)t.style.display="none";else{t.style.display="block";var r=a.split("\n").map(function(e){if(""===e.trim())return"<hr class='filter-text-divider'>";if(e.startsWith("筛选出的总条数：")){var t=e.replace("筛选出的总条数：","");return'<span class="stat-label">筛选出的总条数：</span><span class="stat-value">'.concat(t,"</span>")}if(e.startsWith("对应合计金额：")){var n=e.replace("对应合计金额：","");return'<span class="stat-label">对应合计金额：</span><span class="stat-value">'.concat(n,"</span>")}var a=e.match(/【(.+?)】：(.+)/);return a?'<span class="field-name">【'.concat(a[1],'】</span>：<span class="field-value">').concat(a[2],"</span>"):e}).join("<br>");n.innerHTML=r}}}function L(){return F.apply(this,arguments)}function F(){return(F=m(u().m(function e(){var t,n,a,r;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if("无筛选条件"!==(t=T())){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,navigator.clipboard.writeText(t);case 2:return j(),e.a(2,!0);case 3:return e.p=3,a=e.v,console.error("复制到剪贴板失败:",a),e.p=4,(n=document.createElement("textarea")).value=t,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),j(),e.a(2,!0);case 5:return e.p=5,r=e.v,console.error("备用复制方式也失败:",r),e.a(2,!1)}},e,null,[[4,5],[1,3]])}))).apply(this,arguments)}function j(){var e=document.getElementById("copy-success-hint");e&&(e.classList.add("show"),setTimeout(function(){e.classList.remove("show")},2e3))}function D(){var e=document.getElementById("debug-log");e&&(e.innerHTML="")}function z(e){if(null==e||""===e)return 0;if("number"==typeof e)return isNaN(e)?0:e;var t=String(e).trim();if(""===t)return 0;var n=(t=(t=(t=(t=t.replace(/RMB|CNY|USD|EUR|GBP/gi,"")).replace(/[¥$€£￥]/g,"")).replace(/[,，]/g,"")).replace(/\s+/g,"")).startsWith("-");n&&(t=t.substring(1));var a=(t=t.replace(/[^\d.]/g,"")).indexOf(".");-1!==a&&(t=t.substring(0,a+1)+t.substring(a+1).replace(/\./g,""));var r=parseFloat(t);return isNaN(r)?0:n?-r:r}function O(){return O=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,C("正在设置数据区域...",!1),N("开始执行 setDataRange"),e.n=1,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,c,l,s,i,d,f,m,g,p,v,b,w,x,I,E,S;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=t.workbook.worksheets.getActiveWorksheet()).load("name"),a=t.workbook.getSelectedRange()){e.n=1;break}return C("请先选择一个数据区域",!0),e.a(2);case 1:return a.load("address, rowIndex, columnIndex, rowCount, columnCount"),e.n=2,t.sync();case 2:return r=a.address,N("选中区域原始引用: ".concat(r)),r.includes("!")&&(o=r.split("!")).length>1&&(o[0].replace(/^'|'$/g,""),r=o[1]),r.includes("$")||(c=a.rowIndex+1,l=a.columnIndex,s=c+a.rowCount-1,i=l+a.columnCount-1,d=y(l),f=y(i),r="$".concat(d,"$").concat(c,":$").concat(f,"$").concat(s),N("构建绝对引用: ".concat(r))),m=n.name,N("当前Sheet名: [".concat(m,"]")),g="'".concat(m.replace(/'/g,"''"),"'"),N("转义后Sheet名: [".concat(g,"]")),p="".concat(g,"!").concat(r),v=t.workbook.names,e.p=3,(b=v.getItem(h)).load("name"),e.n=4,t.sync();case 4:return N("找到旧名称，准备删除: ".concat(h)),b.delete(),e.n=5,t.sync();case 5:N("已删除旧定义的名称"),e.n=7;break;case 6:e.p=6,"ItemNotFound"!==(E=e.v).code?N("检查旧名称时遇到非404错误: ".concat(E.code," - ").concat(E.message)):N("旧名称不存在 (ItemNotFound)，无需删除");case 7:return w="=".concat(p),N("=== 准备创建 NamedItem ==="),N("Name: ".concat(h)),N("Formula: ".concat(w)),N("RefersTo: ".concat(p)),e.p=8,v.add(h,w),e.n=9,t.sync();case 9:N("创建成功!"),e.n=11;break;case 10:throw e.p=10,S=e.v,console.error("创建 NamedItem 失败:",S),x=JSON.stringify(S,Object.getOwnPropertyNames(S)),N("❌ 创建失败详情: ".concat(x)),I=S.message,S.code&&(I="[".concat(S.code,"] ").concat(I)),new Error(I);case 11:k?(k.dataRange=p,k.sheetName=m):k={dataRange:p,headerRow:0,snColumn:0,amtColumn:0,sheetName:m},q(),C("已设置数据区域: ".concat(r));case 12:return e.a(2)}},e,null,[[8,10],[3,6]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置数据区域时出错:",t),C("设置数据区域失败: ".concat(t.message),!0),N("CRITICAL: ".concat(t.message));case 3:return e.a(2)}},e,null,[[0,2]])})),O.apply(this,arguments)}function H(){return H=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,C("正在设置标题行...",!1),N("开始执行 setHeaderRow"),e.n=1,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,c,l,s,i,d,f,m;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return(n=t.workbook.worksheets.getActiveWorksheet()).load("name"),(a=t.workbook.getSelectedRange()).load("rowIndex"),e.n=1,t.sync();case 1:return r=a.rowIndex+1,o=n.name,c="'".concat(o.replace(/'/g,"''"),"'"),N("目标Sheet: ".concat(c,", 行: ").concat(r)),l=t.workbook.names,e.p=2,l.getItem(v).delete(),e.n=3,t.sync();case 3:N("已删除旧定义的名称: ".concat(v)),e.n=5;break;case 4:e.p=4,"ItemNotFound"!==(f=e.v).code&&N("删除旧名称警告: ".concat(f.message));case 5:return s="".concat(c,"!$").concat(r,":$").concat(r),i="=".concat(s),N("公式: ".concat(i)),e.p=6,l.add(v,i),e.n=7,t.sync();case 7:e.n=9;break;case 8:throw e.p=8,m=e.v,d=JSON.stringify(m,Object.getOwnPropertyNames(m)),N("❌ 创建失败详情: ".concat(d)),m;case 9:k?(k.headerRow=r,k.sheetName=n.name):k={dataRange:"",headerRow:r,snColumn:0,amtColumn:0,sheetName:n.name},q(),C("已设置标题行: 第 ".concat(r," 行"));case 10:return e.a(2)}},e,null,[[6,8],[2,4]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置标题行时出错:",t),C("设置标题行失败: ".concat(t.message),!0),N("CRITICAL: ".concat(t.message));case 3:return e.a(2)}},e,null,[[0,2]])})),H.apply(this,arguments)}function P(){return P=m(u().m(function e(t,n){var a;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,C("正在设置".concat(n,"..."),!1),N("开始执行 setColumnConfig: ".concat(n)),e.n=1,Excel.run(function(){var e=m(u().m(function e(a){var r,o,c,l,s,i,d,f,m,h,v;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return(r=a.workbook.worksheets.getActiveWorksheet()).load("name"),(o=a.workbook.getSelectedRange()).load("address, columnIndex"),e.n=1,a.sync();case 1:if(o.address){e.n=2;break}return C("请先在 Excel 中选择".concat(n,"所在的列中的任意单元格"),!0),e.a(2);case 2:return c=o.columnIndex,l=y(c),s=a.workbook.names,e.p=3,s.getItem(t).delete(),e.n=4,a.sync();case 4:N("已删除旧定义的列名称: ".concat(t)),e.n=6;break;case 5:e.p=5,"ItemNotFound"!==(h=e.v).code&&N("删除旧列名称警告: ".concat(h.message));case 6:return i=r.name,d="'".concat(i.replace(/'/g,"''"),"'"),f="=".concat(d,"!$").concat(l,"$1"),N("创建NamedItem: ".concat(t,", 公式: ").concat(f)),e.p=7,s.add(t,f),e.n=8,a.sync();case 8:e.n=10;break;case 9:throw e.p=9,v=e.v,m=JSON.stringify(v,Object.getOwnPropertyNames(v)),N("❌ 列配置创建失败: ".concat(m)),v;case 10:k?(t===g?k.snColumn=c:t===p&&(k.amtColumn=c),k.sheetName=r.name):k={dataRange:"",headerRow:0,snColumn:t===g?c:0,amtColumn:t===p?c:0,sheetName:r.name},C("成功设置".concat(n,"为第 ").concat(c+1," 列 (").concat(l,")")),q();case 11:return e.a(2)}},e,null,[[7,9],[3,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,a=e.v,console.error("设置列配置时出错:",a),C("设置".concat(n,"失败: ").concat(a.message),!0),N("CRITICAL: ".concat(a.message));case 3:return e.a(2)}},e,null,[[0,2]])})),P.apply(this,arguments)}function $(){return $=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,A("检查合并单元格","正在读取选中列数据..."),e.n=1,Excel.run(function(){var e=m(u().m(function e(t){var a,r,o,l,s,i,d,f,m,p,h,v,b,w,x,I,E,S,N,T,B,L,F,j,D,z,O,H,P,$,M,_,U,W,J,Y,K,Z,Q,X,ee,te,ne,ae,re,oe,ce,le,se,ie,ue,de,fe,me,ge,pe,he,ve,ye,be,we,xe,Ie,ke,Ee,Se,Ce,Ae,Re,Ve,Ne;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return(a=t.workbook.worksheets.getActiveWorksheet()).load("name"),(r=t.workbook.getSelectedRange()).load("address, columnIndex"),(o=a.getUsedRange()).load("rowCount, rowIndex, columnCount, address"),e.n=1,t.sync();case 1:return l=r.columnIndex,s=y(l),i=o.rowIndex,d=o.rowCount,f=o.columnCount,console.log("开始检查列 ".concat(s," 的合并单元格，范围: 行").concat(i+1,"到").concat(i+d)),R(10,100,"正在扫描第 ".concat(l+1," 列 (").concat(s,")，共 ").concat(d," 行...")),(m=a.getRangeByIndexes(i,l,d,1)).load("values"),e.n=2,t.sync();case 2:return p=m.values,console.log("读取到 ".concat(p.length," 个单元格值")),R(30,100,"数据读取完成，正在检测合并单元格..."),h=[],R(40,100,"正在使用 API 检测合并单元格..."),e.p=3,(v=m.getMergedAreasOrNullObject()).load("isNullObject, areaCount"),e.n=4,t.sync();case 4:if(v.isNullObject||!(v.areaCount>0)){e.n=8;break}return v.load("areas"),e.n=5,t.sync();case 5:return(b=v.areas).load("items"),e.n=6,t.sync();case 6:for(w=0;w<b.items.length;w++)b.items[w].load("rowCount, address, rowIndex, columnIndex");return e.n=7,t.sync();case 7:for(x=0;x<b.items.length;x++)(I=b.items[x]).rowCount>1&&I.columnIndex===l&&(h.push({address:I.address,startRow:I.rowIndex,endRow:I.rowIndex+I.rowCount-1,columnIndex:l}),console.log("API 检测到合并区域: ".concat(I.address,", 跨").concat(I.rowCount,"行")));case 8:e.n=10;break;case 9:e.p=9,Ve=e.v,console.log("API 检测方法失败，使用备用方法:",Ve);case 10:if(0!==h.length){e.n=16;break}R(50,100,"使用值模式检测合并单元格..."),E=0;case 11:if(!(E<d)){e.n=16;break}S=p[E][0],N=0,T=E+1;case 12:if(!(T<d)){e.n=15;break}if(null!=(B=p[T][0])&&""!==B){e.n=13;break}N++,e.n=14;break;case 13:return e.a(3,15);case 14:T++,e.n=12;break;case 15:N>0&&null!=S&&""!==S?(j=(L=i+E)+(F=N+1)-1,D="".concat(s).concat(L+1,":").concat(s).concat(j+1),console.log("值模式检测到可能的合并区域: ".concat(D,", 跨").concat(F,"行")),h.push({address:D,startRow:L,endRow:j,columnIndex:l}),E+=F):E++,e.n=11;break;case 16:if(console.log("总共检测到 ".concat(h.length," 个合并单元格区域")),R(80,100,"检测完成，发现 ".concat(h.length," 个合并区域")),V(),!(h.length>0)){e.n=43;break}return C("检测到 ".concat(h.length," 个合并单元格区域"),!1),e.n=17,G("在第 ".concat(l+1," 列 (").concat(s,") 中检测到 ").concat(h.length," 个合并单元格区域。\n\n是否将这些合并单元格用黄色背景标注？"));case 17:if(!e.v){e.n=19;break}z=c(h);try{for(z.s();!(O=z.n()).done;)H=O.value,a.getRange(H.address).format.fill.color="#FFFF00"}catch(e){z.e(e)}finally{z.f()}return e.n=18,t.sync();case 18:C("已标注 ".concat(h.length," 个合并单元格区域"));case 19:return e.n=20,G("是否需要拆分合并单元格并合并行数据？\n\n操作说明：\n• 取消单元格合并\n• 相同内容保留其一\n• 不同内容换行拼接到第一行\n• 删除多余行\n• 用浅灰色背景标注处理过的行");case 20:if(!e.v){e.n=42;break}A("处理合并单元格","正在处理 ".concat(h.length," 个合并区域，请耐心等待...")),P=h.sort(function(e,t){return t.startRow-e.startRow}),$=0,M=P.length,_=1/0,U=0,W=c(P);try{for(W.s();!(J=W.n()).done;)Y=J.value,_=Math.min(_,Y.startRow),U=Math.max(U,Y.endRow)}catch(e){W.e(e)}finally{W.f()}return(K=a.getRangeByIndexes(_,0,U-_+1,f)).load("values"),e.n=21,t.sync();case 21:Z=K.values,R(0,M,"数据读取完成，开始处理..."),Q=[],X=0;case 22:if(!(X<P.length)){e.n=29;break}if(ee=P[X],!((te=ee.endRow-ee.startRow+1)<2)){e.n=23;break}return e.a(3,28);case 23:ne=ee.startRow,re=Z[ae=ne-_].slice(),oe=1;case 24:if(!(oe<te)){e.n=27;break}if(!((ce=ae+oe)>=Z.length)){e.n=25;break}return e.a(3,27);case 25:for(le=Z[ce],se=0;se<f;se++)ie=String(re[se]||"").trim(),(ue=String(le[se]||"").trim())&&ue!==ie&&(re[se]=ie?ie+"\n"+ue:ue);case 26:oe++,e.n=24;break;case 27:Q.push({firstRowIndex:ne,mergedValues:re,rowsToDelete:te-1});case 28:X++,e.n=22;break;case 29:de=20,fe=0;case 30:if(!(fe<Q.length)){e.n=41;break}me=Math.min(fe+de,Q.length),ge=Q.slice(fe,me),R(fe,Q.length,"批量处理 ".concat(fe+1,"-").concat(me,"/").concat(Q.length)),pe=c(ge),e.p=31,ve=u().m(function e(){var t,n;return u().w(function(e){for(;;)switch(e.n){case 0:t=he.value,n=P.find(function(e){return e.startRow===t.firstRowIndex}),n&&a.getRange(n.address).unmerge();case 1:return e.a(2)}},e)}),pe.s();case 32:if((he=pe.n()).done){e.n=34;break}return e.d(n(ve()),33);case 33:e.n=32;break;case 34:e.n=36;break;case 35:e.p=35,Ne=e.v,pe.e(Ne);case 36:return e.p=36,pe.f(),e.f(36);case 37:return e.n=38,t.sync();case 38:ye=c(ge);try{for(ye.s();!(be=ye.n()).done;)we=be.value,(xe=a.getRangeByIndexes(we.firstRowIndex,0,1,f)).values=[we.mergedValues],xe.format.wrapText=!0,xe.format.fill.color="#F5F5F5"}catch(e){ye.e(e)}finally{ye.f()}return e.n=39,t.sync();case 39:Ie=c(ge);try{for(Ie.s();!(ke=Ie.n()).done;)for(Ee=ke.value,Se=Ee.rowsToDelete;Se>0;Se--)a.getRangeByIndexes(Ee.firstRowIndex+Se,0,1,f).delete(Excel.DeleteShiftDirection.up),$++}catch(e){Ie.e(e)}finally{Ie.f()}return e.n=40,t.sync();case 40:fe+=de,e.n=30;break;case 41:V(),C("已拆分并合并 ".concat(h.length," 个区域的行数据，删除了 ").concat($," 行"));case 42:e.n=44;break;case 43:C("第 ".concat(l+1," 列 (").concat(s,") 未检测到合并单元格，共扫描 ").concat(d," 行"),!1);case 44:return Ce=t.workbook.names,e.p=45,Ce.getItem(g).delete(),e.n=46,t.sync();case 46:e.n=48;break;case 47:e.p=47,e.v;case 48:return Ae="='".concat(a.name,"'!$").concat(s,":$").concat(s),Ce.add(g,Ae),e.n=49,t.sync();case 49:k?(k.snColumn=l,k.sheetName=a.name):k={dataRange:"",headerRow:0,snColumn:l,amtColumn:0,sheetName:a.name},Re=h.length>0?" (已处理 ".concat(h.length," 个合并区域)"):"",C("成功设置 S/N 列为第 ".concat(l+1," 列 (").concat(s,")").concat(Re)),q();case 50:return e.a(2)}},e,null,[[45,47],[31,35,36,37],[3,9]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置SN列时出错:",t),V(),C("设置 S/N 列失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),$.apply(this,arguments)}function q(){var e=document.getElementById("data-range-info");e&&(k&&k.dataRange?(e.textContent=k.dataRange,e.className="step-value clickable",e.title="点击跳转到主报表"):(e.textContent="未配置",e.className="step-value not-configured",e.title=""));var t=document.getElementById("header-row-info");t&&(k&&k.headerRow>0?(t.textContent="第 ".concat(k.headerRow," 行"),t.className="step-value"):(t.textContent="未配置",t.className="step-value not-configured"));var n=document.getElementById("sn-col-info");if(n)if(k&&k.snColumn>=0){var a=y(k.snColumn);n.textContent="第 ".concat(k.snColumn+1," 列 (").concat(a,")"),n.className="step-value"}else n.textContent="未配置",n.className="step-value not-configured";var r=document.getElementById("amt-col-info");if(r)if(k&&k.amtColumn>=0){var o=y(k.amtColumn);r.textContent="第 ".concat(k.amtColumn+1," 列 (").concat(o,")"),r.className="step-value"}else r.textContent="未配置",r.className="step-value not-configured";var c=document.getElementById("btn-enable-filter");if(c){var l=k&&k.dataRange&&k.headerRow>0&&k.snColumn>=0&&k.amtColumn>=0;c.disabled=!l}}function M(){var e,t=document.getElementById("reports-table-body");if(t){var n="";k&&k.sheetName&&(n+='\n      <tr class="main-report-row">\n        <td>\n          <span class="main-report-link" title="点击跳转到主报表">\n            <i class="ms-Icon ms-Icon--Home" style="margin-right: 4px; font-size: 10px;"></i>'.concat(k.sheetName,'\n          </span>\n        </td>\n        <td><span class="main-report-badge">主报表</span></td>\n        <td></td>\n      </tr>\n    ')),0!==x.length||null!==(e=k)&&void 0!==e&&e.sheetName?(n+=x.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return'\n      <tr>\n        <td>\n          <span class="report-name-display" data-index="'.concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="点击跳转，双击修改名称">').concat(e.sheetName,'</span>\n          <div class="report-name-edit-container" style="display: none;">\n            <input type="text" class="report-name-input" data-index="').concat(t,'" value="').concat(e.sheetName,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n        </td>\n        <td>').concat(n,'</td>\n        <td>\n          <button class="icon-button-small danger" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="删除报表">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </td>\n      </tr>\n    ')}).join(""),t.innerHTML=n,t.querySelectorAll(".main-report-link").forEach(function(e){e.addEventListener("click",function(){Ie()})}),t.querySelectorAll(".report-name-display").forEach(function(e){e.addEventListener("click",function(e){var t=e.target.getAttribute("data-sheet-name");t&&function(e){W.apply(this,arguments)}(t)}),e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container"),o=null==r?void 0:r.querySelector(".report-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),t.querySelectorAll(".report-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){U.apply(this,arguments)}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;_(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){_(n)},200)})}),t.querySelectorAll(".icon-button-small.danger").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){J.apply(this,arguments)}(n,a)})})):t.innerHTML='<tr><td colspan="3" class="no-reports">暂无报表</td></tr>'}}function _(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function U(){return U=m(u().m(function e(t,n){var a,r;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=x.length)){e.n=1;break}return e.a(2);case 1:if(a=x[t].sheetName,(n=n.trim())&&n!==a){e.n=2;break}return _(t),e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(r){var o,c;return u().w(function(e){for(;;)switch(e.n){case 0:return o=r.workbook,(c=o.worksheets.getItem(a)).name=n,c.getRange("A1").values=[[n]],e.n=1,r.sync();case 1:x[t].sheetName=n,M(),C("报表名称已修改为: ".concat(n));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.error("修改报表名称失败:",r),C("修改名称失败: ".concat(r.message),!0),_(t);case 5:return e.a(2)}},e,null,[[2,4]])})),U.apply(this,arguments)}function W(){return W=m(u().m(function e(t){return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=m(u().m(function e(n){return u().w(function(e){for(;;)switch(e.n){case 0:return n.workbook.worksheets.getItem(t).activate(),e.n=1,n.sync();case 1:C("已跳转到报表: ".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,e.v,C('跳转失败: 找不到工作表 "'.concat(t,'"'),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),W.apply(this,arguments)}function G(e){return new Promise(function(t){var n=document.getElementById("confirm-dialog"),a=document.getElementById("confirm-dialog-message"),r=document.getElementById("confirm-dialog-ok"),o=document.getElementById("confirm-dialog-cancel");if(n&&a&&r&&o){a.textContent=e,n.classList.add("show");var c=function(){n.classList.remove("show"),r.removeEventListener("click",l),o.removeEventListener("click",s)},l=function(){c(),t(!0)},s=function(){c(),t(!1)};r.addEventListener("click",l),o.addEventListener("click",s)}else t(!1)})}function J(){return J=m(u().m(function e(t,n){var a;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,G('确定要删除报表 "'.concat(n,'" 吗？此操作不可恢复。'));case 1:if(e.v){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(a){var r;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=a.workbook,e.p=1,r.worksheets.getItem(n).delete(),e.n=2,a.sync();case 2:x.splice(t,1),M(),C("已删除报表: ".concat(n)),e.n=4;break;case 3:e.p=3,e.v,x.splice(t,1),M(),C('报表 "'.concat(n,'" 不存在，已从列表中移除'));case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,a=e.v,C("删除失败: ".concat(a.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),J.apply(this,arguments)}function Y(e,t,n){var a={sheetName:e,createTime:(new Date).toISOString(),rowCount:t,totalAmount:n};x.unshift(a),M()}function K(){var e=document.getElementById("filter-conditions-list");e&&(0!==I.length?(e.innerHTML=I.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=e.filterSettings.map(function(e){return e.headerText}).join(", ");return'\n      <div class="filter-condition-item">\n        <div class="filter-condition-info">\n          <span class="filter-name-display" data-index="'.concat(t,'" title="双击修改名称 | ').concat(a,'">').concat(e.name,'</span>\n          <div class="filter-name-edit-container" style="display: none;">\n            <input type="text" class="filter-name-input" data-index="').concat(t,'" value="').concat(e.name,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n          <span class="filter-condition-time">').concat(n,'</span>\n        </div>\n        <div class="filter-condition-actions">\n          <button class="icon-button-small apply-filter-btn" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="应用此筛选条件">\n            <i class="ms-Icon ms-Icon--Play"></i>\n          </button>\n          <button class="icon-button-small danger delete-filter-btn" data-index="').concat(t,'" title="删除此筛选条件">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </div>\n      </div>\n    ')}).join(""),e.querySelectorAll(".filter-name-display").forEach(function(e){e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container"),o=null==r?void 0:r.querySelector(".filter-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),e.querySelectorAll(".filter-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){if(!(e<0||e>=I.length)){t=t.trim();var n=I[e].name;t&&t!==n?(I[e].name=t,K(),C("筛选条件名称已修改为: ".concat(t))):Z(e)}}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;Z(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){Z(n)},200)})}),e.querySelectorAll(".apply-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){Q.apply(this,arguments)}(n,a)})}),e.querySelectorAll(".delete-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t,n=e.currentTarget;(t=parseInt(n.getAttribute("data-index")||"0"))>=0&&t<I.length&&(I.splice(t,1),K(),C("已删除筛选条件"))})})):e.innerHTML='<div class="no-filters">暂无保存的筛选条件</div>')}function Z(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function Q(){return Q=m(u().m(function e(t,a){var r,o;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=I.length)){e.n=1;break}return C("筛选条件不存在",!0),e.a(2);case 1:return r=I[t],e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(t){var a,o,l,s,i,d,f,m,g,p,h,v,b,w,x,I,S,A,R,V,N,T,B,L,F,j,D,z,O,H,P;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook,(o=a.worksheets.getItem(r.config.sheetName)).activate(),o.load("name"),(l=o.getUsedRange()).load("values, rowCount, columnCount, address, rowIndex"),e.n=1,t.sync();case 1:if(l.values&&0!==l.values.length){e.n=2;break}return C("工作表没有数据",!0),e.a(2);case 2:s=l.rowIndex+1,i=s+l.rowCount-1,k={dataRange:l.address,headerRow:s,snColumn:r.config.snColumn,amtColumn:r.config.amtColumn,sheetName:o.name},d=l.values[0],E=[],f=u().m(function e(t){var n,a,o,c,s,i,f,m;return u().w(function(e){for(;;)switch(e.n){case 0:for(n=d[t]?String(d[t]):y(t),a=new Set,o=1;o<l.values.length;o++)c=l.values[o][t],""!==(s=null!=c?String(c):"")&&a.add(s);i=Array.from(a).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),f=r.filterSettings.find(function(e){return e.columnIndex===t}),m=f&&f.isFiltered?new Set(f.filterValues.filter(function(e){return a.has(e)})):new Set(i),E.push({columnIndex:t,headerText:n,allValues:i,selectedValues:m,isTimeField:!1,timeDimension:"all"});case 1:return e.a(2)}},e)}),m=0;case 3:if(!(m<l.columnCount)){e.n=5;break}return e.d(n(f(m)),4);case 4:m++,e.n=3;break;case 5:for(ae(),g=document.getElementById("btn-apply-filter"),p=document.getElementById("btn-clear-filter"),h=document.getElementById("btn-save-filter"),v=document.getElementById("btn-generate"),b=document.getElementById("btn-reset-filter"),g&&(g.disabled=!1),p&&(p.disabled=!1),h&&(h.disabled=!1),v&&(v.disabled=!1),b&&(b.disabled=!1),w=s+1;w<=i;w++)o.getRange("".concat(w,":").concat(w)).rowHidden=!1;return e.n=6,t.sync();case 6:for(x=[],I=0,S=E;I<S.length;I++)(A=S[I]).selectedValues.size<A.allValues.length&&A.selectedValues.size>0&&x.push({colIdx:A.columnIndex,allowedValues:A.selectedValues,headerText:A.headerText});if(0!==x.length){e.n=7;break}return X([]),C("已加载筛选条件到面板，当前无筛选"),e.a(2);case 7:R=0,V=0,N=1;case 8:if(!(N<l.values.length)){e.n=17;break}T=l.values[N],B=s+N,L=!1,F=c(x),e.p=9,F.s();case 10:if((j=F.n()).done){e.n=12;break}if(!((D=j.value).colIdx<T.length)){e.n=11;break}if(z=T[D.colIdx],O=null!=z?String(z):"",D.allowedValues.has(O)){e.n=11;break}return L=!0,e.a(3,12);case 11:e.n=10;break;case 12:e.n=14;break;case 13:e.p=13,P=e.v,F.e(P);case 14:return e.p=14,F.f(),e.f(14);case 15:L?(o.getRange("".concat(B,":").concat(B)).rowHidden=!0,R++):V++;case 16:N++,e.n=8;break;case 17:return e.n=18,t.sync();case 18:X(x.map(function(e){return{columnIndex:e.colIdx,columnName:y(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),H=x.map(function(e){return"".concat(e.headerText,"(").concat(e.allowedValues.size,"项)")}).join(", "),C("已应用筛选条件: ".concat(H," | 可见").concat(V,"行, 隐藏").concat(R,"行"));case 19:return e.a(2)}},e,null,[[9,13,14,15]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,o=e.v,console.error("应用筛选条件时出错:",o),N("应用筛选条件失败: ".concat(o.message)),C("应用筛选条件失败: ".concat(o.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),Q.apply(this,arguments)}function X(e){var t=document.getElementById("current-filter-display");if(t){var n=e.filter(function(e){return e.isFiltered});if(0!==n.length){var a=n.map(function(e,t){var n=e.filterValues,a=n.length;if(a<=3)return'\n        <div class="current-filter-item">\n          <span class="filter-field">'.concat(e.headerText,'</span>\n          <span class="filter-separator">：</span>\n          <span class="filter-value">').concat(n.join("、"),"</span>\n        </div>\n      ");var r=n.slice(0,3),o=a,c="filter-expand-".concat(t);return'\n        <div class="current-filter-item">\n          <span class="filter-field">'.concat(e.headerText,'</span>\n          <span class="filter-separator">：</span>\n          <span class="filter-value-collapsed" id="').concat(c,'-collapsed">\n            ').concat(r.join("、"),'\n            <a href="javascript:void(0)" class="filter-expand-link" onclick="expandFilterValues(\'').concat(c,"', ").concat(t,')">等').concat(o,'个结果</a>\n          </span>\n          <span class="filter-value-expanded" id="').concat(c,'-expanded" style="display: none;">\n            ').concat(n.join("、"),'\n            <a href="javascript:void(0)" class="filter-collapse-link" onclick="collapseFilterValues(\'').concat(c,"')\">收起</a>\n          </span>\n        </div>\n      ")}).join("");t.innerHTML='\n    <div class="current-filter-title">当前应用的筛选条件：</div>\n    <div class="current-filter-items">\n      '.concat(a,"\n    </div>\n  ")}else t.innerHTML='<div class="no-filters">当前未应用筛选条件</div>'}}function ee(){var e=document.getElementById("current-filter-display");if(e){for(var t=[],n=0,a=E;n<a.length;n++){var r=a[n];if(r.selectedValues.size<r.allValues.length&&r.selectedValues.size>0){var o=Array.from(r.selectedValues);t.push({columnIndex:r.columnIndex,columnName:y(r.columnIndex),headerText:r.headerText,filterType:"values",filterValues:o,isFiltered:!0})}}t.length>0?X(t):E.length>0?e.innerHTML='<div class="no-filters">当前未应用筛选条件（所有字段均为全选）</div>':e.innerHTML='<div class="no-filters">请先点击"启用筛选"加载字段</div>'}}function te(){return te=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,c,l,s,i,d,f,m,g,p,h,v,b,w,x;return u().w(function(e){for(;;)switch(e.n){case 0:return r=t.workbook,(o=r.worksheets.getActiveWorksheet()).load("name"),(c=o.getUsedRange()).load("values, rowCount, columnCount, address"),e.n=1,t.sync();case 1:if(c.values&&!(c.values.length<2)){e.n=2;break}return C("当前工作表数据不足",!0),e.a(2);case 2:for(l=c.values[0],k={dataRange:c.address,headerRow:1,snColumn:(null===(n=k)||void 0===n?void 0:n.snColumn)||0,amtColumn:(null===(a=k)||void 0===a?void 0:a.amtColumn)||0,sheetName:o.name},E=[],s=0;s<c.columnCount;s++){for(i=l[s]?String(l[s]):y(s),d=new Set,f=1;f<c.values.length;f++)m=c.values[f][s],""!==(g=null!=m?String(m):"")&&d.add(g);p=Array.from(d).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),E.push({columnIndex:s,headerText:i,allValues:p,selectedValues:new Set(p),isTimeField:!1,timeDimension:"all"})}ae(),h=document.getElementById("btn-apply-filter"),v=document.getElementById("btn-clear-filter"),b=document.getElementById("btn-save-filter"),w=document.getElementById("btn-generate"),x=document.getElementById("btn-reset-filter"),h&&(h.disabled=!1),v&&(v.disabled=!1),b&&(b.disabled=!1),w&&(w.disabled=!1),x&&(x.disabled=!1),q(),C("已加载 ".concat(E.length," 个字段的筛选选项"));case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载筛选面板时出错:",t),C("加载筛选面板失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),te.apply(this,arguments)}window.expandFilterValues=function(e,t){var n=document.getElementById("".concat(e,"-collapsed")),a=document.getElementById("".concat(e,"-expanded"));n&&a&&(n.style.display="none",a.style.display="inline")},window.collapseFilterValues=function(e){var t=document.getElementById("".concat(e,"-collapsed")),n=document.getElementById("".concat(e,"-expanded"));t&&n&&(t.style.display="inline",n.style.display="none")};var ne=-1;function ae(){var e=document.getElementById("filter-panel");if(e)if(0!==E.length){for(var t='<div class="filter-tags-container">',n=0;n<E.length;n++){var a=E[n],r=a.selectedValues.size,o=a.allValues.length,c=r<o,l="filter-tag";c&&(l+=" filtered"),n===ne&&(l+=" active"),a.isTimeField&&(l+=" time-field"),t+='\n      <div class="'.concat(l,'" data-field-index="').concat(n,'">\n        <span class="filter-tag-name">').concat(re(a.headerText),'</span>\n        <span class="filter-tag-count">').concat(c?r+"/":"").concat(o,'</span>\n        <span class="time-field-toggle ').concat(a.isTimeField?"active":"",'" \n              data-field-index="').concat(n,'" title="标记为时间字段">T</span>\n      </div>\n    ')}t+="</div>";var s="";if(ne>=0&&ne<E.length){var i=E[ne],u="filter-field-".concat(ne),d="";i.isTimeField&&(d='\n        <div class="time-dimension-selector">\n          <span class="time-dimension-label">筛选维度：</span>\n          <select class="time-dimension-select" id="'.concat(u,'-dimension" data-field-index="').concat(ne,'">\n            <option value="all" ').concat("all"===i.timeDimension?"selected":"",'>全部值</option>\n            <option value="year" ').concat("year"===i.timeDimension?"selected":"",'>按年</option>\n            <option value="month" ').concat("month"===i.timeDimension?"selected":"",'>按月</option>\n            <option value="day" ').concat("day"===i.timeDimension?"selected":"",">按日</option>\n          </select>\n        </div>\n      ")),s='\n      <div class="filter-dropdown show" data-field-index="'.concat(ne,'">\n        <div class="filter-dropdown-header">\n          <span class="filter-dropdown-title">').concat(re(i.headerText),' 筛选</span>\n          <button class="filter-dropdown-close" id="btn-close-dropdown">收起</button>\n        </div>\n        ').concat(d,'\n        <input type="text" class="filter-field-search" placeholder="搜索选项..." \n               id="').concat(u,'-search" data-field-index="').concat(ne,'">\n        <div class="filter-options-container" id="').concat(u,'-options">\n    ');var f=i.allValues;i.isTimeField&&"all"!==i.timeDimension&&i.timeValues&&(f=i.timeValues[i.timeDimension]||i.allValues);for(var m=0;m<f.length;m++){var g=f[m],p=i.selectedValues.has(g),h=g.length>40?g.substring(0,40)+"...":g;s+='\n        <div class="filter-option '.concat(p?"selected":"",'" \n             data-field-index="').concat(ne,'" data-value-index="').concat(m,'" data-value="').concat(re(g),'">\n          <input type="checkbox" ').concat(p?"checked":"",' \n                 id="').concat(u,"-opt-").concat(m,'" data-field-index="').concat(ne,'" data-value="').concat(re(g),'">\n          <span class="filter-option-label" title="').concat(re(g),'">').concat(re(h),"</span>\n        </div>\n      ")}s+='\n        </div>\n        <div class="filter-select-actions" id="'.concat(u,'-actions">\n          <button class="filter-select-action" data-field-index="').concat(ne,'" data-action="all">全选</button>\n          <button class="filter-select-action" data-field-index="').concat(ne,'" data-action="none">全不选</button>\n          <button class="filter-select-action" data-field-index="').concat(ne,'" data-action="invert">反选</button>\n        </div>\n        <div class="filter-search-hint" id="').concat(u,'-search-hint" style="display: none;">\n          <i class="ms-Icon ms-Icon--Info" aria-hidden="true"></i>\n          <span>以上操作仅针对当前搜索结果</span>\n        </div>\n      </div>\n    ')}e.innerHTML=t+s}else e.innerHTML='<div class="filter-panel-hint">请先点击"启用筛选"加载字段</div>'}function re(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function oe(){return(oe=m(u().m(function e(t){var n;return u().w(function(e){for(;;)switch(e.n){case 0:if(!(t<0||t>=E.length)){e.n=1;break}return e.a(2);case 1:if((n=E[t]).isTimeField=!n.isTimeField,!n.isTimeField){e.n=3;break}return C('已将"'.concat(n.headerText,'"标记为时间字段')),e.n=2,ce(t);case 2:e.n=4;break;case 3:n.timeDimension="all",n.timeValues=void 0,C('已取消"'.concat(n.headerText,'"的时间字段标记'));case 4:ae();case 5:return e.a(2)}},e)}))).apply(this,arguments)}function ce(e){return le.apply(this,arguments)}function le(){return le=m(u().m(function e(t){var n,a;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=E.length)){e.n=1;break}return e.a(2);case 1:if(n=E[t],k){e.n=2;break}return C("请先设置主报表配置",!0),e.a(2);case 2:return A("检查时间格式","正在检查..."),e.p=3,e.n=4,Excel.run(function(){var e=m(u().m(function e(a){var r,o,c,l,s,i,d,f,m,g,p,h;return u().w(function(e){for(;;)switch(e.n){case 0:return r=a.workbook.worksheets.getItem(k.sheetName),(o=r.getUsedRange()).load("values, rowCount"),e.n=1,a.sync();case 1:c=n.columnIndex,l=o.rowCount,s=0,i=0,d=[],f=[],m=1;case 2:if(!(m<l)){e.n=5;break}if(g=o.values[m][c],m%100==0&&R(m,l,"已检查 ".concat(m,"/").concat(l," 行")),null!=g&&""!==g){e.n=3;break}return e.a(3,4);case 3:se(g)?s++:(i++,d.length<10&&(d.push(m+1),f.push(String(g))));case 4:m++,e.n=2;break;case 5:if(R(l,l,"检查完成"),V(),fe(t,o.values,c),0!==i){e.n=6;break}C('"'.concat(n.headerText,'"列共 ').concat(s," 个时间值，全部为标准格式")),e.n=9;break;case 6:if(p=f.slice(0,3).join("、"),h='"'.concat(n.headerText,'"列检测到 ').concat(i," 个非标准时间格式（如：").concat(p,"...）\n是否自动转换为标准格式？"),!confirm(h)){e.n=8;break}return e.n=7,ie(t,o,r,a);case 7:e.n=9;break;case 8:C("已跳过时间格式转换，共 ".concat(i," 个非标准格式"));case 9:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:e.n=6;break;case 5:e.p=5,a=e.v,V(),console.error("检查时间格式失败:",a),C("检查时间格式失败: ".concat(a.message),!0);case 6:return e.a(2)}},e,null,[[3,5]])})),le.apply(this,arguments)}function se(e){if(null==e||""===e)return!0;if("number"==typeof e)return!0;for(var t=String(e).trim(),n=0,a=[/^\d{4}[-/]\d{1,2}[-/]\d{1,2}$/,/^\d{4}[-/]\d{1,2}[-/]\d{1,2}\s+\d{1,2}:\d{2}(:\d{2})?$/,/^\d{1,2}[-/]\d{1,2}[-/]\d{4}$/,/^\d{4}年\d{1,2}月\d{1,2}日$/];n<a.length;n++)if(a[n].test(t))return!0;var r=new Date(t);return!isNaN(r.getTime())}function ie(e,t,n,a){return ue.apply(this,arguments)}function ue(){return(ue=m(u().m(function e(t,n,a,r){var o,c,l,s,i,d,f,m,g,p,h;return u().w(function(e){for(;;)switch(e.n){case 0:o=E[t],c=o.columnIndex,l=y(c),A("转换时间格式","正在转换..."),s=0,i=n.values.length,d=1;case 1:if(!(d<i)){e.n=4;break}if(f=n.values[d][c],d%50==0&&R(d,i,"已处理 ".concat(d,"/").concat(i," 行")),null!=f&&""!==f){e.n=2;break}return e.a(3,3);case 2:se(f)||(m=de(f))&&(g=d+1,p="".concat(l).concat(g),(h=a.getRange(p)).values=[[m]],h.format.font.color="#7b1fa2",s++);case 3:d++,e.n=1;break;case 4:return e.n=5,r.sync();case 5:return R(i,i,"转换完成"),V(),e.n=6,ge(t);case 6:C("已转换 ".concat(s," 个时间格式，已用紫色文字标注"));case 7:return e.a(2)}},e)}))).apply(this,arguments)}function de(e){var t=String(e).trim();if(/^\d{8}$/.test(t))return"".concat(t.slice(0,4),"-").concat(t.slice(4,6),"-").concat(t.slice(6,8));if(/^\d{4}\.\d{1,2}\.\d{1,2}$/.test(t))return t.replace(/\./g,"-");var n=t.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{4})$/);if(n){var a=l(n,4),r=a[1],o=a[2],c=a[3];return"".concat(c,"-").concat(o.padStart(2,"0"),"-").concat(r.padStart(2,"0"))}var s=t.match(/^(\d{4})年(\d{1,2})月(\d{1,2})日?$/);if(s){var i=l(s,4),u=i[1],d=i[2],f=i[3];return"".concat(u,"-").concat(d.padStart(2,"0"),"-").concat(f.padStart(2,"0"))}var m=t.toLowerCase().match(/^([a-z]+)\s+(\d{1,2}),?\s+(\d{4})$/);if(m){var g=l(m,4),p=g[1],h=g[2],v=g[3],y={jan:"01",january:"01",feb:"02",february:"02",mar:"03",march:"03",apr:"04",april:"04",may:"05",jun:"06",june:"06",jul:"07",july:"07",aug:"08",august:"08",sep:"09",september:"09",oct:"10",october:"10",nov:"11",november:"11",dec:"12",december:"12"}[p];if(y)return"".concat(v,"-").concat(y,"-").concat(h.padStart(2,"0"))}var b=new Date(t);if(!isNaN(b.getTime())){var w=b.getFullYear(),x=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return"".concat(w,"-").concat(x,"-").concat(I)}return null}function fe(e,t,n){for(var a=E[e],r=new Set,o=new Set,c=new Set,l=1;l<t.length;l++){var s=t[l][n];if(null!=s&&""!==s){var i=me(s);i&&(r.add(i.year),o.add(i.yearMonth),c.add(i.date))}}a.timeValues={year:Array.from(r).sort(),month:Array.from(o).sort(),day:Array.from(c).sort()}}function me(e){var t,n,a=null;if("number"==typeof e)t=e,n=new Date(1899,11,30),a=new Date(n.getTime()+864e5*t);else{var r=String(e).trim();if(a=new Date(r),isNaN(a.getTime())&&/^\d{8}$/.test(r)){var o=parseInt(r.slice(0,4)),c=parseInt(r.slice(4,6))-1,l=parseInt(r.slice(6,8));a=new Date(o,c,l)}}if(!a||isNaN(a.getTime()))return null;var s=String(a.getFullYear()),i=String(a.getMonth()+1).padStart(2,"0"),u=String(a.getDate()).padStart(2,"0");return{year:s,yearMonth:"".concat(s,"-").concat(i),date:"".concat(s,"-").concat(i,"-").concat(u)}}function ge(e){return pe.apply(this,arguments)}function pe(){return pe=m(u().m(function e(t){var n,a;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(k){e.n=1;break}return e.a(2);case 1:return n=E[t],e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(a){var r,o;return u().w(function(e){for(;;)switch(e.n){case 0:return r=a.workbook.worksheets.getItem(k.sheetName),(o=r.getUsedRange()).load("values"),e.n=1,a.sync();case 1:fe(t,o.values,n.columnIndex);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,a=e.v,console.error("重新计算时间维度值失败:",a);case 5:return e.a(2)}},e,null,[[2,4]])})),pe.apply(this,arguments)}var he=!1;function ve(e){var t=E[e];if(t){var n=document.querySelector('.filter-tag[data-field-index="'.concat(e,'"]'));if(n){var a=t.selectedValues.size,r=t.allValues.length,o=a<r;n.classList.toggle("filtered",o);var c=n.querySelector(".filter-tag-count");c&&(c.textContent=o?"".concat(a,"/").concat(r):"".concat(r))}}}function ye(){return ye=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(0!==E.length){e.n=1;break}return C("请先加载筛选面板",!0),e.a(2);case 1:return C("正在应用筛选条件...",!1),e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,l,s,i,d,f,m,g,p,h,v,b,w,x,I,A,R,V,T,F,j,D,O,H,P,$,q,M,_,U,W,G;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=t.workbook,(o=k?r.worksheets.getItem(k.sheetName):r.worksheets.getActiveWorksheet()).activate(),(l=o.getUsedRange()).load("values, rowCount, rowIndex, columnCount"),e.n=1,t.sync();case 1:if(l.values&&0!==l.values.length){e.n=2;break}return C("工作表没有数据",!0),e.a(2);case 2:s=l.rowIndex,i=l.rowCount,d=l.columnCount,f=[],m=c(E);try{for(m.s();!(g=m.n()).done;)(p=g.value).selectedValues.size<p.allValues.length&&p.selectedValues.size>0&&f.push({colIdx:p.columnIndex,allowedValues:p.selectedValues,headerText:p.headerText})}catch(e){m.e(e)}finally{m.f()}(h=[]).push(!0),v=0,b=0,w=0,x=null!==(n=null===(a=k)||void 0===a?void 0:a.amtColumn)&&void 0!==n?n:-1,I=1;case 3:if(!(I<l.values.length)){e.n=12;break}if(A=l.values[I],R=!0,!(f.length>0)){e.n=10;break}V=c(f),e.p=4,V.s();case 5:if((T=V.n()).done){e.n=7;break}if(!((F=T.value).colIdx<A.length)){e.n=6;break}if(j=A[F.colIdx],D=null!=j?String(j):"",F.allowedValues.has(D)){e.n=6;break}return R=!1,e.a(3,7);case 6:e.n=5;break;case 7:e.n=9;break;case 8:e.p=8,G=e.v,V.e(G);case 9:return e.p=9,V.f(),e.f(9);case 10:h.push(R),R?(v++,x>=0&&x<A.length&&(O=A[x],w+=z(O))):b++;case 11:I++,e.n=3;break;case 12:return S={filteredRowCount:v,totalAmount:w,isValid:!0},(P=s+i)>=(H=s+2)&&(o.getRange("".concat(H,":").concat(P)).rowHidden=!1),e.n=13,t.sync();case 13:for($=1,q=0;$<h.length;)if(h[$])$++;else{for(M=$;M+1<h.length&&!h[M+1];)M++;_=s+$+1,U=s+M+1,o.getRange("".concat(_,":").concat(U)).rowHidden=!0,q++,$=M+1}return e.n=14,t.sync();case 14:return N("应用筛选完成: 隐藏了 ".concat(q," 个连续范围, 共 ").concat(b," 行")),N("数据起始行: Excel 第 ".concat(s+1," 行, 共 ").concat(i," 行")),o.getRangeByIndexes(s+1,0,i-1,d).format.rowHeight=20,e.n=15,t.sync();case 15:return X(f.map(function(e){return{columnIndex:e.colIdx,columnName:y(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),B(),e.n=16,L();case 16:W=f.map(function(e){var t=e.allowedValues.size;return"".concat(e.headerText,"(").concat(t,"项)")}).join(", "),C("已应用筛选: ".concat(W," | 可见").concat(v,"行, 隐藏").concat(b,"行")),N("应用筛选: ".concat(W));case 17:return e.a(2)}},e,null,[[4,8,9,10]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,t=e.v,console.error("应用筛选时出错:",t),C("应用筛选失败: ".concat(t.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),ye.apply(this,arguments)}function be(){return be=m(u().m(function e(){var t,n,a,r;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:t=c(E);try{for(t.s();!(n=t.n()).done;)(a=n.value).selectedValues=new Set(a.allValues)}catch(e){t.e(e)}finally{t.f()}return S={filteredRowCount:0,totalAmount:0,isValid:!1},ae(),e.p=1,e.n=2,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,c,l,s;return u().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,a=k?n.worksheets.getItem(k.sheetName):n.worksheets.getActiveWorksheet(),(r=a.getUsedRange()).load("rowCount, rowIndex, columnCount"),e.n=1,t.sync();case 1:return r.rowCount-1>0&&(o=r.rowIndex+2,c=r.rowIndex+r.rowCount,(l=a.getRange("".concat(o,":").concat(c))).rowHidden=!1,l.format.rowHeight=20),e.n=2,t.sync();case 2:X([]),(s=document.getElementById("filter-text-container"))&&(s.style.display="none"),C("已清除所有筛选");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,r=e.v,console.error("清除筛选时出错:",r),C("清除筛选失败: ".concat(r.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),be.apply(this,arguments)}function we(){return xe.apply(this,arguments)}function xe(){return(xe=m(u().m(function e(){var t,n,a,o,l,s,i;return u().w(function(e){for(;;)switch(e.n){case 0:n=[],a=c(E);try{for(a.s();!(o=a.n()).done;)(l=o.value).selectedValues.size<l.allValues.length&&l.selectedValues.size>0&&(n.push({columnIndex:l.columnIndex,columnName:y(l.columnIndex),headerText:l.headerText,filterType:"values",filterValues:Array.from(l.selectedValues),isFiltered:!0}),N("筛选条件 - ".concat(l.headerText,": ").concat(l.selectedValues.size,"/").concat(l.allValues.length,"项")))}catch(e){a.e(e)}finally{a.f()}if(0!==n.length){e.n=1;break}return N("没有筛选条件需要保存"),e.a(2);case 1:s={id:"filter_".concat(Date.now()),name:"筛选条件_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(t=k)||void 0===t?void 0:t.sheetName)||"未知",filterSettings:n,config:k?r({},k):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}},I.unshift(s),K(),ee(),i=n.length,N("已保存筛选条件: ".concat(i," 列有筛选"));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function Ie(){return ke.apply(this,arguments)}function ke(){return ke=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(k&&k.sheetName){e.n=1;break}return C("未配置主报表",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=m(u().m(function e(t){var n,a;return u().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,(a=n.worksheets.getItem(k.sheetName)).activate(),a.getRange("A1").select(),e.n=1,t.sync();case 1:C("已跳转到主报表: ".concat(k.sheetName));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("跳转到主报表失败:",t),C("跳转失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),ke.apply(this,arguments)}function Ee(){return Ee=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(k&&k.sheetName){e.n=1;break}return C("未配置主报表",!0),e.a(2);case 1:return S={filteredRowCount:0,totalAmount:0,isValid:!1},e.p=2,e.n=3,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,l,s,i,d,f,m;return u().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,(a=n.worksheets.getItem(k.sheetName)).activate(),(r=a.getUsedRange()).load("rowCount, rowIndex"),e.n=1,t.sync();case 1:return r.rowCount-1>0&&(o=r.rowIndex+2,l=r.rowIndex+r.rowCount,(s=a.getRange("".concat(o,":").concat(l))).rowHidden=!1,s.format.rowHeight=20),a.getRange("A1").select(),e.n=2,t.sync();case 2:i=c(E);try{for(i.s();!(d=i.n()).done;)(f=d.value).selectedValues=new Set(f.allValues)}catch(e){i.e(e)}finally{i.f()}ne=-1,ae(),ee(),(m=document.getElementById("filter-text-container"))&&(m.style.display="none"),C("已重置筛选并跳转到主报表");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,t=e.v,console.error("重置筛选失败:",t),C("重置失败: ".concat(t.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),Ee.apply(this,arguments)}function Se(){return Se=m(u().m(function e(){var n;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=m(u().m(function e(n){var a,r,o,l,s,i,d,f,m,h,v,x,I,S,A,R,V,T,B,L,F,j,O,H,P,$,q,M,_,U,W,G,J,K,Z,Q,X,ee,te,ne,ae,re,oe,ce,le,se,ie,ue,de,fe,me,ge,pe,he,ve,ye,be,xe,Ie,ke,Ee,Se,Ce,Ae,Re,Ve,Ne,Te,Be,Le,Fe,je,De,ze,Oe,He,Pe,$e,qe,Me,_e,Ue,We,Ge,Je,Ye,Ke,Ze,Qe,Xe,et;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=n.workbook,l=!1,k&&k.sheetName?(o=r.worksheets.getItem(k.sheetName),l=!0):o=r.worksheets.getActiveWorksheet(),o.load("name"),e.n=1,n.sync();case 1:return N('生成报表 - 使用工作表: "'.concat(o.name,'", 是否主报表配置: ').concat(l)),k&&N('  主报表配置: sheetName="'.concat(k.sheetName,'"')),s=null,i=null,d="",e.p=2,(f=r.names.getItem(g)).load("name, formula"),e.n=3,n.sync();case 3:return d=o.name,(m=f.getRange()).load("columnIndex, address, columnCount"),e.n=4,n.sync();case 4:h=m.columnIndex,v=w(f.formula),x=null,v&&(x=b(v)),s=null!==x?x:h,N("S/N 列 NamedItem: ".concat(f.name)),N("  公式: ".concat(f.formula)),N("  地址: ".concat(m.address)),N("  从 Range 获取列索引: ".concat(h," (列 ").concat(y(h),")")),v&&N("  从公式解析列名: ".concat(v,", 列索引: ").concat(x)),N("  最终使用列索引: ".concat(s," (列 ").concat(y(s),")")),e.n=6;break;case 5:return e.p=5,e.v,C('错误: 未配置 S/N 列，请先点击"设为 S/N 列"按钮',!0),e.a(2);case 6:return e.p=6,(I=r.names.getItem(p)).load("name, formula"),e.n=7,n.sync();case 7:return(S=I.getRange()).load("columnIndex, address, columnCount"),e.n=8,n.sync();case 8:A=S.columnIndex,R=w(I.formula),V=null,R&&(V=b(R)),i=null!==V?V:A,N("金额列 NamedItem: ".concat(I.name)),N("  公式: ".concat(I.formula)),N("  地址: ".concat(S.address)),N("  从 Range 获取列索引: ".concat(A," (列 ").concat(y(A),")")),R&&N("  从公式解析列名: ".concat(R,", 列索引: ").concat(V)),N("  最终使用列索引: ".concat(i," (列 ").concat(y(i),")")),e.n=10;break;case 9:return e.p=9,e.v,C('错误: 未配置金额列，请先点击"设为金额列"按钮',!0),e.a(2);case 10:if(T=o.getUsedRange()){e.n=11;break}return C("错误: 无法获取工作表使用范围",!0),e.a(2);case 11:return T.load("rowCount, columnCount, address, values, rowIndex"),e.n=12,n.sync();case 12:if(0!==T.rowCount&&0!==T.columnCount){e.n=13;break}return C("错误: 当前工作表没有数据",!0),e.a(2);case 13:if(B=T.rowCount,L=T.columnCount,T.values&&0!==T.values.length){e.n=14;break}return C("错误: 无法读取工作表数据 (行数: ".concat(B,", 列数: ").concat(L,")"),!0),e.a(2);case 14:D(),N("开始处理数据..."),N("S/N 列索引: ".concat(s,", 金额列索引: ").concat(i)),s===i&&N("警告: S/N 列和金额列的索引相同！这可能导致错误。"),F=[],j=c(E);try{for(j.s();!(O=j.n()).done;)(H=O.value).selectedValues.size<H.allValues.length&&H.selectedValues.size>0&&F.push({colIdx:H.columnIndex,allowedValues:H.selectedValues,headerText:H.headerText})}catch(e){j.e(e)}finally{j.f()}for(N("筛选条件数量: ".concat(F.length)),P=0,$=F;P<$.length;P++)q=$[P],N("  ".concat(q.headerText,": ").concat(q.allowedValues.size," 项"));M=[],_=function(e){return e&&Array.isArray(e)?e.length===L?e:e.length<L?[].concat(t(e),t(new Array(L-e.length).fill(""))):e.slice(0,L):new Array(L).fill("")},T.values.length>0&&T.values[0]&&M.push(_(T.values[0])),U=0,W=0,G=1;case 15:if(!(G<T.values.length)){e.n=25;break}if((J=T.values[G])&&Array.isArray(J)){e.n=16;break}return e.a(3,24);case 16:if(K=!0,!(F.length>0)){e.n=23;break}Z=c(F),e.p=17,Z.s();case 18:if((Q=Z.n()).done){e.n=20;break}if(!((X=Q.value).colIdx<J.length)){e.n=19;break}if(ee=J[X.colIdx],te=null!=ee?String(ee):"",X.allowedValues.has(te)){e.n=19;break}return K=!1,e.a(3,20);case 19:e.n=18;break;case 20:e.n=22;break;case 21:e.p=21,Xe=e.v,Z.e(Xe);case 22:return e.p=22,Z.f(),e.f(22);case 23:K?(M.push(_(J)),U++):W++;case 24:G++,e.n=15;break;case 25:if(N("总行数: ".concat(B,", 符合条件: ").concat(U,", 不符合条件: ").concat(W)),0!=(ne=M.length-1)){e.n=26;break}return C("筛选后没有符合条件的数据行，请调整筛选条件后重试。",!0),e.a(2);case 26:for(N("筛选完成，可见数据行数: ".concat(ne)),ae=0,re=[],oe=1;oe<M.length;oe++)ce=M[oe],le=oe+1,ce&&Array.isArray(ce)&&null!==i&&i>=0&&i<ce.length?(se=ce[i],ie=null!==s&&s>=0&&s<ce.length?ce[s]:"N/A",null!=se&&""!==se?(ue=z(se),ae+=ue,re.push(ue),de="string"==typeof se?'"'.concat(se,'"'):String(se),N("Row ".concat(le,": SN列[").concat(s,"]=").concat(ie,", 金额列[").concat(i,"]=").concat(de," -> Clean=").concat(ue.toFixed(2)))):N("Row ".concat(le,": SN列[").concat(s,"]=").concat(ie,", 金额列[").concat(i,"]=空"))):N("Row ".concat(le,": 警告 - 金额列索引 ").concat(i," 超出数据范围 (数据长度: ").concat(ce?ce.length:0,")"));N("--- 汇总 ---"),N("总金额: ".concat(ae.toFixed(2))),N("金额明细: [".concat(re.map(function(e){return e.toFixed(2)}).join(", "),"]")),fe=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19),me="报表_".concat(fe),e.p=27,ge=r.worksheets.add(me),e.n=33;break;case 28:e.p=28,e.v,pe=1;case 29:return e.p=30,ge=r.worksheets.add("".concat(me,"_").concat(pe)),e.a(3,33);case 31:e.p=31,e.v,pe++;case 32:e.n=29;break;case 33:ge.load("name"),he="无筛选条件",ve=[];try{ye=c(E);try{for(ye.s();!(be=ye.n()).done;)(xe=be.value).selectedValues.size<xe.allValues.length&&xe.selectedValues.size>0&&(Ie=Array.from(xe.selectedValues),void 0,ke=Ie.length<=5?Ie.join("; "):Ie.slice(0,5).join("; ")+"... (共".concat(Ie.length,"项)"),ve.push({fieldName:xe.headerText,values:ke}),N("筛选条件 - ".concat(xe.headerText,": ").concat(Ie.length,"/").concat(xe.allValues.length,"项")))}catch(e){ye.e(e)}finally{ye.f()}ve.length>0?(he=ve.map(function(e){return"【".concat(e.fieldName,"】：").concat(e.values)}).join("\n"),N("筛选条件: ".concat(he))):N("未检测到筛选条件（筛选面板无筛选）")}catch(e){console.warn("获取筛选条件失败:",e),N("获取筛选条件失败: ".concat(e.message))}if(Ee=ve.length>0?ve.length:1,Ce=(Se=4+Ee+1)+1,(Ae=ge.getRange("A1:E".concat(Se))).format.verticalAlignment=Excel.VerticalAlignment.center,Ae.format.horizontalAlignment=Excel.HorizontalAlignment.left,Ae.format.fill.color="#F5F5F5",Ae.format.font.name="Arial",Ae.format.font.size=11,Ae.format.font.color="#323130",Re=[[me,"","","",""],["总条数",ne.toString(),"","源表名称",d],["总金额",ae.toFixed(2),"","生成时间",(new Date).toLocaleString("zh-CN")]],ge.getRange("A1:E3").values=Re,(Ve=ge.getRange("A1:E1")).merge(),Ve.format.font.size=14,Ve.format.font.bold=!0,Ve.format.font.color="#0078d4",Ve.format.horizontalAlignment=Excel.HorizontalAlignment.center,(Ne=ge.getRange("A2:A3")).format.font.bold=!0,Ne.format.font.color="#323130",(Te=ge.getRange("B2:B3")).format.font.color="#0078d4",Te.format.font.bold=!0,ge.getRange("D2:D3").format.font.bold=!0,ge.getRange("E2:E3").format.font.color="#323130",Be=ge.getRange("E2"),Le=(null===(a=k)||void 0===a?void 0:a.headerRow)||1,Fe="'".concat(d,"'!A").concat(Le),Be.hyperlink={address:"",documentReference:Fe,screenTip:"点击返回原表: ".concat(d),textToDisplay:d},Be.format.font.color="#0078d4",Be.format.font.underline=Excel.RangeUnderlineStyle.single,ve.length>0)for(je=0;je<ve.length;je++)De=4+je,ze=ve[je],ge.getRange("A".concat(De,":E").concat(De)).values=0===je?[["筛选条件","【".concat(ze.fieldName,"】"),ze.values,"",""]]:[["","【".concat(ze.fieldName,"】"),ze.values,"",""]],(Oe=ge.getRange("A".concat(De))).format.font.bold=!0,Oe.format.font.color="#323130",(He=ge.getRange("B".concat(De))).format.font.color="#0d47a1",He.format.font.bold=!0,(Pe=ge.getRange("C".concat(De))).format.font.color="#323130",Pe.format.wrapText=!0;else ge.getRange("A4:E4").values=[["筛选条件","无筛选条件","","",""]],($e=ge.getRange("A4")).format.font.bold=!0,$e.format.font.color="#323130",(qe=ge.getRange("B4")).format.font.color="#a19f9d",qe.format.font.italic=!0;return Ae.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("EdgeTop").color="#D1D1D1",Ae.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("EdgeBottom").color="#D1D1D1",Ae.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("EdgeLeft").color="#D1D1D1",Ae.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("EdgeRight").color="#D1D1D1",Ae.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("InsideHorizontal").color="#E1E1E1",Ae.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,Ae.format.borders.getItem("InsideVertical").color="#E1E1E1",e.n=34,n.sync();case 34:if(!(M.length>0)){e.n=38;break}for(Me=y(L-1),N("准备写入数据..."),N("目标范围: A".concat(Ce,":").concat(Me).concat(Ce+M.length-1)),N("filteredRows.length = ".concat(M.length)),N("columnCount = ".concat(L)),_e=0;_e<M.length;_e++)(Ue=M[_e]?M[_e].length:0)!==L&&N("警告: 第 ".concat(_e," 行列数 (").concat(Ue,") 与 columnCount (").concat(L,") 不匹配"));We=M.length,Ge=L,N("目标区域: ".concat(We," 行 x ").concat(Ge," 列")),Je=ge.getRange("A".concat(Ce,":").concat(Me).concat(Ce+M.length-1)),e.p=35,Je.values=M,e.n=37;break;case 36:throw e.p=36,et=e.v,N("写入数据失败: ".concat(et.message)),N("第一行数据: ".concat(JSON.stringify(M[0]))),M.length>1&&N("第二行数据: ".concat(JSON.stringify(M[1]))),et;case 37:if(Je.format.font.name="Arial",Je.format.font.size=11,Je.format.font.color="#323130",Je.format.verticalAlignment=Excel.VerticalAlignment.center,Je.format.horizontalAlignment=Excel.HorizontalAlignment.left,(Ye=ge.getRange("A".concat(Ce,":").concat(Me).concat(Ce))).format.fill.color="#0078d4",Ye.format.font.bold=!0,Ye.format.font.color="#FFFFFF",Ye.format.font.size=11,Ye.format.font.name="Arial",Ye.format.horizontalAlignment=Excel.HorizontalAlignment.center,Ye.format.verticalAlignment=Excel.VerticalAlignment.center,Ye.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,Ye.format.borders.getItem("EdgeTop").color="#005a9e",Ye.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,Ye.format.borders.getItem("EdgeBottom").color="#005a9e",Ye.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,Ye.format.borders.getItem("EdgeLeft").color="#005a9e",Ye.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,Ye.format.borders.getItem("EdgeRight").color="#005a9e",M.length>1)for((Ke=ge.getRange("A".concat(Ce+1,":").concat(Me).concat(Ce+M.length-1))).format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("EdgeTop").color="#E1E1E1",Ke.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("EdgeBottom").color="#E1E1E1",Ke.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("EdgeLeft").color="#E1E1E1",Ke.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("EdgeRight").color="#E1E1E1",Ke.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("InsideHorizontal").color="#F0F0F0",Ke.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,Ke.format.borders.getItem("InsideVertical").color="#F0F0F0",Qe=Ze=Ce+1;Qe<=Ce+M.length-1;Qe++)ge.getRange("A".concat(Qe,":").concat(Me).concat(Qe)).format.fill.color=(Qe-Ze)%2==0?"#FAFAFA":"#FFFFFF";case 38:return ge.getUsedRange().format.autofitColumns(),ge.getUsedRange().format.rowHeight=20,ge.getRange("1:".concat(Se)).format.rowHeight=22,ge.activate(),e.n=39,n.sync();case 39:return Y(ge.name,ne,ae),e.n=40,we();case 40:C("报表生成成功！共 ".concat(ne," 条记录，总金额: ").concat(ae.toFixed(2)));case 41:return e.a(2)}},e,null,[[35,36],[30,31],[27,28],[17,21,22,23],[6,9],[2,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:return B(),e.n=2,L();case 2:e.n=4;break;case 3:e.p=3,n=e.v,console.error("生成报表时出错:",n),C("生成报表失败: ".concat(n.message),!0);case 4:return e.a(2)}},e,null,[[0,3]])})),Se.apply(this,arguments)}function Ce(){return Ce=m(u().m(function e(){var t;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=m(u().m(function e(t){var n,a,r,o,c,l,s,i,d;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.workbook,e.p=1,(a=n.names.getItem(h)).load("formula"),e.n=2,t.sync();case 2:(r=a.formula.match(/=([^!]+)!([^$]+)/))&&(k?(k.dataRange=a.formula.replace(/^=/,""),k.sheetName=r[1]):k={dataRange:a.formula.replace(/^=/,""),headerRow:0,snColumn:0,amtColumn:0,sheetName:r[1]}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.p=4,(o=n.names.getItem(v)).load("formula"),e.n=5,t.sync();case 5:(c=o.formula.match(/:(\d+):/))&&k&&(k.headerRow=parseInt(c[1])),e.n=7;break;case 6:e.p=6,e.v;case 7:return e.p=7,l=n.names.getItem(g),(s=l.getRange()).load("columnIndex"),e.n=8,t.sync();case 8:k&&(k.snColumn=s.columnIndex),e.n=10;break;case 9:e.p=9,e.v;case 10:return e.p=10,i=n.names.getItem(p),(d=i.getRange()).load("columnIndex"),e.n=11,t.sync();case 11:k&&(k.amtColumn=d.columnIndex),e.n=13;break;case 12:e.p=12,e.v;case 13:return e.a(2)}},e,null,[[10,12],[7,9],[4,6],[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载主报表配置时出错:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),Ce.apply(this,arguments)}Office.onReady(function(e){var t,n,a,o,l,s,i,d,f,g,h,v,b;e.host===Office.HostType.Excel&&(null===(t=document.getElementById("btn-set-data-range"))||void 0===t||t.addEventListener("click",function(){!function(){O.apply(this,arguments)}()}),null===(n=document.getElementById("btn-set-header-row"))||void 0===n||n.addEventListener("click",function(){!function(){H.apply(this,arguments)}()}),null===(a=document.getElementById("btn-set-sn"))||void 0===a||a.addEventListener("click",function(){!function(){$.apply(this,arguments)}()}),null===(o=document.getElementById("btn-set-amt"))||void 0===o||o.addEventListener("click",function(){!function(e,t){P.apply(this,arguments)}(p,"金额列")}),null===(l=document.getElementById("btn-enable-filter"))||void 0===l||l.addEventListener("click",function(){!function(){te.apply(this,arguments)}()}),null===(s=document.getElementById("btn-generate"))||void 0===s||s.addEventListener("click",function(){!function(){Se.apply(this,arguments)}()}),null===(i=document.getElementById("btn-apply-filter"))||void 0===i||i.addEventListener("click",function(){!function(){ye.apply(this,arguments)}()}),null===(d=document.getElementById("btn-clear-filter"))||void 0===d||d.addEventListener("click",function(){!function(){be.apply(this,arguments)}()}),null===(f=document.getElementById("btn-save-filter"))||void 0===f||f.addEventListener("click",function(){!function(){var e;if(0!==E.length){for(var t=[],n=0,a=E;n<a.length;n++){var o=a[n];o.selectedValues.size<o.allValues.length&&o.selectedValues.size>0&&t.push({columnIndex:o.columnIndex,columnName:y(o.columnIndex),headerText:o.headerText,filterType:"values",filterValues:Array.from(o.selectedValues),isFiltered:!0})}if(0!==t.length){var c={id:"filter_".concat(Date.now()),name:"筛选_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(e=k)||void 0===e?void 0:e.sheetName)||"未知",filterSettings:t,config:k?r({},k):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}};I.unshift(c),K();var l=t.map(function(e){return"".concat(e.headerText,"(").concat(e.filterValues.length,"项)")}).join(", ");C("已保存筛选条件: ".concat(l))}else C("没有需要保存的筛选条件（所有字段都是全选状态）",!0)}else C("请先加载筛选面板",!0)}()}),null===(g=document.getElementById("btn-reset-filter"))||void 0===g||g.addEventListener("click",function(){!function(){Ee.apply(this,arguments)}()}),null===(h=document.getElementById("data-range-info"))||void 0===h||h.addEventListener("click",function(){Ie()}),(b=document.getElementById("filter-panel"))&&!he&&(he=!0,console.log("[筛选面板] 绑定事件委托"),b.addEventListener("click",function(e){var t=e.target;if(t.classList.contains("time-field-toggle")){e.preventDefault(),e.stopPropagation();var n=parseInt(t.getAttribute("data-field-index")||"-1",10);n>=0&&n<E.length&&function(e){oe.apply(this,arguments)}(n)}else{var a=t.closest(".filter-tag");if(a&&!t.classList.contains("time-field-toggle")){var r=parseInt(a.getAttribute("data-field-index")||"-1",10);return r===ne?ne=-1:(ne=r,E[r].isTimeField&&ce(r)),void ae()}if("btn-close-dropdown"===t.id||t.closest("#btn-close-dropdown"))return ne=-1,void ae();var o=t.closest(".filter-select-action");if(o){e.preventDefault(),e.stopPropagation();var l=parseInt(o.getAttribute("data-field-index")||"0",10),s=o.getAttribute("data-action");if(console.log("[筛选操作] action=".concat(s,", fieldIndex=").concat(l)),l>=0&&l<E.length){var i=E[l],u=document.getElementById("filter-field-".concat(l,"-search")),d=u?u.value.trim():"",f=d.length>0;if(console.log("[筛选操作] isSearchMode=".concat(f,', searchText="').concat(d,'"')),console.log("[筛选操作] 操作前 selectedValues.size=".concat(i.selectedValues.size,", allValues.length=").concat(i.allValues.length)),f){var m=document.getElementById("filter-field-".concat(l,"-options")),g=[];if(m&&m.querySelectorAll(".filter-option:not(.hidden)").forEach(function(e){var t=e.getAttribute("data-value-index"),n=null!==t?parseInt(t,10):-1,a=n>=0&&n<i.allValues.length?i.allValues[n]:e.getAttribute("data-value")||"";g.push(a)}),console.log("[筛选操作] 搜索模式，可见选项数: ".concat(g.length)),"all"===s){var p,h=c(g);try{for(h.s();!(p=h.n()).done;){var v=p.value;i.selectedValues.add(v)}}catch(e){h.e(e)}finally{h.f()}}else if("none"===s){var y,b=c(g);try{for(b.s();!(y=b.n()).done;){var w=y.value;i.selectedValues.delete(w)}}catch(e){b.e(e)}finally{b.f()}}else if("invert"===s){var x,I=c(g);try{for(I.s();!(x=I.n()).done;){var k=x.value;i.selectedValues.has(k)?i.selectedValues.delete(k):i.selectedValues.add(k)}}catch(e){I.e(e)}finally{I.f()}}}else if(console.log("[筛选操作] 非搜索模式，操作所有 ".concat(i.allValues.length," 个选项")),"all"===s)i.selectedValues=new Set(i.allValues);else if("none"===s)i.selectedValues=new Set;else if("invert"===s){var S,C=new Set,A=c(i.allValues);try{for(A.s();!(S=A.n()).done;){var R=S.value;i.selectedValues.has(R)||C.add(R)}}catch(e){A.e(e)}finally{A.f()}console.log("[筛选操作] 反选：之前选中 ".concat(i.selectedValues.size," 个，反选后应选中 ").concat(C.size," 个")),i.selectedValues=C}console.log("[筛选操作] 操作后 selectedValues.size=".concat(i.selectedValues.size)),function(e){var t=E[e],n=document.getElementById("filter-field-".concat(e,"-options"));if(n&&t){var a=n.querySelectorAll(".filter-option");a.forEach(function(e){var n=e.getAttribute("data-value-index"),a=null!==n?parseInt(n,10):-1,r=a>=0&&a<t.allValues.length?t.allValues[a]:e.getAttribute("data-value")||"",o=t.selectedValues.has(r),c=e.querySelector("input[type='checkbox']");c&&(c.checked=o),e.classList.toggle("selected",o)}),console.log("[updateFieldOptions] fieldIndex=".concat(e,", 更新了 ").concat(a.length," 个选项"))}}(l),ve(l)}}else{var V=t.closest(".filter-option");if(V&&"INPUT"!==t.tagName){var N=parseInt(V.getAttribute("data-field-index")||"0",10),T=V.querySelector("input[type='checkbox']");if(N>=0&&N<E.length&&T){var B=E[N],L=V.getAttribute("data-value-index"),F=null!==L?parseInt(L,10):-1,j=F>=0&&F<B.allValues.length?B.allValues[F]:V.getAttribute("data-value")||"",D=!T.checked;T.checked=D,D?B.selectedValues.add(j):B.selectedValues.delete(j),V.classList.toggle("selected",D),ve(N)}}}}}),b.addEventListener("input",function(e){var t=e.target;t.classList.contains("filter-field-search")&&function(e,t){var n=document.getElementById("filter-field-".concat(e,"-options")),a=document.getElementById("filter-field-".concat(e,"-actions")),r=document.getElementById("filter-field-".concat(e,"-search-hint"));if(n){var o=n.querySelectorAll(".filter-option"),c=t.toLowerCase().trim(),l=c.length>0,s=0;if(o.forEach(function(e){var t=(e.getAttribute("data-value")||"").toLowerCase().includes(c);e.classList.toggle("hidden",!t),t&&s++}),a&&a.classList.toggle("search-mode",l),r){r.style.display=l?"flex":"none";var i=r.querySelector("span");i&&l&&(i.textContent="以上操作仅针对当前搜索结果（".concat(s," 项）"))}}}(parseInt(t.getAttribute("data-field-index")||"0",10),t.value)}),b.addEventListener("change",function(e){var t=e.target;if("checkbox"===t.type&&t.closest(".filter-option")){var n=parseInt(t.getAttribute("data-field-index")||"0",10);if(n>=0&&n<E.length){var a=E[n],r=t.closest(".filter-option"),o=t.getAttribute("data-value")||"";if(r){var c=r.getAttribute("data-value-index"),l=null!==c?parseInt(c,10):-1;l>=0&&l<a.allValues.length&&(o=a.allValues[l])}t.checked?a.selectedValues.add(o):a.selectedValues.delete(o),r&&r.classList.toggle("selected",t.checked),ve(n)}}if(t.classList.contains("time-dimension-select")){var s=parseInt(t.getAttribute("data-field-index")||"-1",10),i=t.value;s>=0&&s<E.length&&function(e,t){if(!(e<0||e>=E.length)){var n=E[e];n.timeDimension=t,"all"===t?n.selectedValues=new Set(n.allValues):n.timeValues&&n.timeValues[t]&&(n.selectedValues=new Set(n.timeValues[t])),ae(),C('已切换"'.concat(n.headerText,'"筛选维度为：').concat(function(e){switch(e){case"year":return"按年";case"month":return"按月";case"day":return"按日";default:return"全部值"}}(t)))}}(s,i)}})),(v=document.getElementById("filter-text-content"))&&v.addEventListener("click",m(u().m(function e(){return u().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,L();case 1:return e.a(2)}},e)}))),function(){return Ce.apply(this,arguments)}().then(function(){q(),M(),K()}),console.log("Excel Add-in 初始化完成"))})}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map