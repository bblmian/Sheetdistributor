/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"8d24d8b00361cadf0fde.css"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(t,n,a){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw o}}}}function l(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function i(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,a,r,o){var s=a&&a.prototype instanceof l?a:l,i=Object.create(s.prototype);return u(i,"_invoke",function(n,a,r){var o,l,s,i=0,u=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,l=0,s=e,f.n=n,c}};function m(n,a){for(l=n,s=a,t=0;!d&&i&&!r&&t<u.length;t++){var r,o=u[t],m=f.p,g=o[2];n>3?(r=g===a)&&(s=o[(l=o[4])?5:(l=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(l=0,f.v=a,f.n=o[1]):m<g&&(r=n<3||o[0]>a||a>g)&&(o[4]=n,o[5]=a,f.n=g,l=0))}if(r||n>1)return c;throw d=!0,a}return function(r,u,g){if(i>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,g),l=u,s=g;(t=l<2?e:s)||!d;){o||(l?l<3?(l>1&&(f.n=-1),m(l,s)):f.n=s:f.v=s);try{if(i=2,o){if(l||(r="next"),t=o[r]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,l<2&&(l=0)}else 1===l&&(t=o.return)&&t.call(o),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);o=e}else if((t=(d=f.n<0)?s:n.call(a,f))!==c)break}catch(t){o=e,l=1,s=t}finally{i=1}}return{value:t,done:d}}}(n,r,o),!0),i}var c={};function l(){}function s(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(u(t={},a,function(){return this}),t),m=d.prototype=l.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,u(e,r,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=d,u(m,"constructor",d),u(d,"constructor",s),s.displayName="GeneratorFunction",u(d,r,"GeneratorFunction"),u(m),u(m,r,"Generator"),u(m,a,function(){return this}),u(m,"toString",function(){return"[object Generator]"}),(i=function(){return{w:o,m:g}})()}function u(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}u=function(e,t,n,a){function o(t,n){u(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},u(e,t,n,a)}function d(e,t,n,a,r,o,c){try{var l=e[o](c),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){d(o,a,r,c,l,"next",e)}function l(e){d(o,a,r,c,l,"throw",e)}c(void 0)})}}var m="Wiz_Cfg_SN_Col",g="Wiz_Cfg_Amt_Col",p="Wiz_Cfg_Data_Range",h="Wiz_Cfg_Header_Row";function v(e){for(var t="",n=e;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}function y(e){var t=0;e=e.toUpperCase();for(var n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-64);return t-1}function b(e){var t=e.match(/![\$]?([A-Z]+)[\$]?:[\$]?[A-Z]+/i);return t&&t[1]?t[1].toUpperCase():null}var w=[],x=[],I=null,E=[];function k(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("message-area");n&&(n.textContent=e,n.className=t?"message-area error":"message-area success"),console.log(e)}function S(e,t){var n=document.getElementById("progress-overlay"),a=document.getElementById("progress-title"),r=document.getElementById("progress-message"),o=document.getElementById("progress-bar"),c=document.getElementById("progress-detail");n&&a&&r&&o&&c&&(a.textContent=e,r.textContent=t,o.style.width="0%",c.textContent="",n.classList.add("show"))}function C(e,t,n){var a=document.getElementById("progress-bar"),r=document.getElementById("progress-detail");if(a&&r){var o=t>0?Math.round(e/t*100):0;a.style.width="".concat(o,"%"),r.textContent=n||"".concat(e," / ").concat(t)}}function A(){var e=document.getElementById("progress-overlay");e&&e.classList.remove("show")}function R(e){var t=document.getElementById("debug-log");if(t){var n=document.createElement("div");n.textContent=e,n.style.marginBottom="2px",t.appendChild(n),t.scrollTop=t.scrollHeight}console.log(e)}function V(){for(var e=[],t=0,n=E;t<n.length;t++){var a=n[t];if(a.selectedValues.size<a.allValues.length&&a.selectedValues.size>0){var r=Array.from(a.selectedValues),o=r.length>5?r.slice(0,5).join("、")+"...等".concat(r.length,"项"):r.join("、");e.push("【".concat(a.headerText,"】：").concat(o))}}return 0===e.length?"无筛选条件":e.join("\n")}function N(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("filter-text-container"),n=document.getElementById("filter-text-content");if(t&&n){var a=V();if("无筛选条件"===a&&e)t.style.display="none";else{t.style.display="block";var r=a.split("\n").map(function(e){var t=e.match(/【(.+?)】：(.+)/);return t?'<span class="field-name">【'.concat(t[1],'】</span>：<span class="field-value">').concat(t[2],"</span>"):e}).join("<br>");n.innerHTML=r}}}function B(){return L.apply(this,arguments)}function L(){return(L=f(i().m(function e(){var t,n,a,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if("无筛选条件"!==(t=V())){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,navigator.clipboard.writeText(t);case 2:return T(),e.a(2,!0);case 3:return e.p=3,a=e.v,console.error("复制到剪贴板失败:",a),e.p=4,(n=document.createElement("textarea")).value=t,n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),T(),e.a(2,!0);case 5:return e.p=5,r=e.v,console.error("备用复制方式也失败:",r),e.a(2,!1)}},e,null,[[4,5],[1,3]])}))).apply(this,arguments)}function T(){var e=document.getElementById("copy-success-hint");e&&(e.classList.add("show"),setTimeout(function(){e.classList.remove("show")},2e3))}function z(){var e=document.getElementById("debug-log");e&&(e.innerHTML="")}function j(e){if(null==e||""===e)return 0;if("number"==typeof e)return isNaN(e)?0:e;var t=String(e).trim();if(""===t)return 0;var n=(t=(t=(t=(t=t.replace(/RMB|CNY|USD|EUR|GBP/gi,"")).replace(/[¥$€£￥]/g,"")).replace(/[,，]/g,"")).replace(/\s+/g,"")).startsWith("-");n&&(t=t.substring(1));var a=(t=t.replace(/[^\d.]/g,"")).indexOf(".");-1!==a&&(t=t.substring(0,a+1)+t.substring(a+1).replace(/\./g,""));var r=parseFloat(t);return isNaN(r)?0:n?-r:r}function F(){return F=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,c,l,s,u,d,f,m,g,h,y,b,w;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=t.workbook.worksheets.getActiveWorksheet()).load("name"),a=t.workbook.getSelectedRange()){e.n=1;break}return k("请先选择一个数据区域",!0),e.a(2);case 1:return a.load("address, rowIndex, columnIndex, rowCount, columnCount"),e.n=2,t.sync();case 2:return(r=a.address).includes("!")&&(o=r.split("!")).length>1&&(o[0].replace(/^'|'$/g,""),r=o[1]),r.includes("$")||(c=a.rowIndex+1,l=a.columnIndex,s=c+a.rowCount-1,u=l+a.columnCount-1,d=v(l),f=v(u),r="$".concat(d,"$").concat(c,":$").concat(f,"$").concat(s)),m=n.name,g=m.includes(" ")||m.includes("-")||m.includes("'")?"'".concat(m.replace(/'/g,"''"),"'"):m,h="".concat(g,"!").concat(r),y=t.workbook.names,e.p=3,y.getItem(p).delete(),e.n=4,t.sync();case 4:e.n=6;break;case 5:e.p=5,e.v;case 6:return b="=".concat(h),R("创建 NamedItem: ".concat(p)),R("公式: ".concat(b)),R("地址: ".concat(h)),e.p=7,y.add(p,b),e.n=8,t.sync();case 8:e.n=10;break;case 9:throw e.p=9,w=e.v,console.error("创建 NamedItem 失败:",w),R("错误: ".concat(w.message)),w;case 10:I?(I.dataRange=h,I.sheetName=m):I={dataRange:h,headerRow:0,snColumn:0,amtColumn:0,sheetName:m},q(),k("已设置数据区域: ".concat(r));case 11:return e.a(2)}},e,null,[[7,9],[3,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置数据区域时出错:",t),k("设置数据区域失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),F.apply(this,arguments)}function O(){return O=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return(n=t.workbook.worksheets.getActiveWorksheet()).load("name"),(a=t.workbook.getSelectedRange()).load("rowIndex"),e.n=1,t.sync();case 1:return r=a.rowIndex+1,o=t.workbook.names,e.p=2,o.getItem(h).delete(),e.n=3,t.sync();case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return c="".concat(n.name,"!").concat(r,":").concat(r),o.add(h,"=".concat(c)),e.n=6,t.sync();case 6:I?(I.headerRow=r,I.sheetName=n.name):I={dataRange:"",headerRow:r,snColumn:0,amtColumn:0,sheetName:n.name},q(),k("已设置标题行: 第 ".concat(r," 行"));case 7:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置标题行时出错:",t),k("设置标题行失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),O.apply(this,arguments)}function D(){return D=f(i().m(function e(t,n){var a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(a){var r,o,c,l,s,u,d,f,p,h;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return(r=a.workbook.worksheets.getActiveWorksheet()).load("name"),(o=a.workbook.getSelectedRange()).load("address"),e.n=1,a.sync();case 1:return(c=o.getEntireColumn()).load("columnIndex"),e.n=2,a.sync();case 2:return l=c.columnIndex,s=v(l),u=a.workbook.names,e.p=3,u.getItem(t).delete(),e.n=4,a.sync();case 4:e.n=6;break;case 5:e.p=5,e.v;case 6:return d="=".concat(r.name,"!$").concat(s,":$").concat(s),u.add(t,d),e.n=7,a.sync();case 7:return(f=u.getItem(t)).load("name, formula"),(p=f.getRange()).load("columnIndex, address"),e.n=8,a.sync();case 8:(h=p.columnIndex)!==l&&console.warn("警告: NamedItem 列索引不匹配！期望: ".concat(l,", 实际: ").concat(h)),I?(t===m?I.snColumn=l:t===g&&(I.amtColumn=l),I.sheetName=r.name):I={dataRange:"",headerRow:0,snColumn:t===m?l:0,amtColumn:t===g?l:0,sheetName:r.name},k("成功设置".concat(n,"为第 ").concat(l+1," 列 (").concat(s,")，验证列索引: ").concat(h+1)),q();case 9:return e.a(2)}},e,null,[[3,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,a=e.v,console.error("设置列配置时出错:",a),k("设置".concat(n,"失败: ").concat(a.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),D.apply(this,arguments)}function H(){return H=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,l,s,u,d,f,g,p,h,y,b,w,x,E,R,V,N,B,L,T,z,j,F,O,D,H,P,_,M,U,W,G,K,J,Z,Y,Q,X,ee,te,ne,ae,re,oe,ce,le,se;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return(n=t.workbook.worksheets.getActiveWorksheet()).load("name"),(a=t.workbook.getSelectedRange()).load("address, columnIndex"),e.n=1,t.sync();case 1:return r=a.columnIndex,o=v(r),(l=n.getUsedRange()).load("rowCount, rowIndex, columnCount, address"),e.n=2,t.sync();case 2:return s=l.rowIndex,u=l.rowCount,d=l.columnCount,f=[],console.log("开始检查列 ".concat(o," 的合并单元格，范围: 行").concat(s+1,"到").concat(s+u)),(g=n.getRangeByIndexes(s,r,u,1)).load("values, address"),e.n=3,t.sync();case 3:p=g.values,console.log("读取到 ".concat(p.length," 个单元格值")),h=0;case 4:if(!(h<u)){e.n=23;break}return y=s+h,(b=n.getCell(y,r)).getExtendedRange(Excel.KeyboardDirection.down).load("rowCount, address, rowIndex"),b.load("address, rowIndex, text"),e.n=5,t.sync();case 5:return w=1,x=b.address,e.p=6,(E=b.getMergedAreasOrNullObject()).load("isNullObject"),e.n=7,t.sync();case 7:if(E.isNullObject){e.n=13;break}return E.load("address, areas"),e.n=8,t.sync();case 8:if(!E.areas||!E.areas.items){e.n=13;break}return(R=E.areas).load("items"),e.n=9,t.sync();case 9:V=0;case 10:if(!(V<R.items.length)){e.n=13;break}return(N=R.items[V]).load("rowCount, address, rowIndex, columnIndex"),e.n=11,t.sync();case 11:if(!(N.rowCount>1&&N.columnIndex===r)){e.n=12;break}return w=N.rowCount,x=N.address,e.a(3,13);case 12:V++,e.n=10;break;case 13:e.n=15;break;case 14:e.p=14,se=e.v,console.log("检查单元格 ".concat(b.address," 时出错:"),se);case 15:if(!(1===w&&h<u-1)){e.n=22;break}B=0,L=h+1;case 16:if(!(L<u)){e.n=19;break}if(null!==p[L][0]){e.n=17;break}B++,e.n=18;break;case 17:return e.a(3,19);case 18:L++,e.n=16;break;case 19:if(!(B>0)){e.n=22;break}return(T=n.getRangeByIndexes(y,r,B+1,1)).load("address, rowCount"),e.n=20,t.sync();case 20:return(z=T.getMergedAreasOrNullObject()).load("isNullObject, address, areaCount"),e.n=21,t.sync();case 21:!z.isNullObject&&z.areaCount>0?(j=z.address)&&j.includes(":")&&(console.log("通过空值检测发现可能的合并区域: ".concat(j)),w=B+1,x=T.address):B>0&&(console.log("发现连续 ".concat(B+1," 个可能合并的单元格（基于空值）: 行").concat(y+1)),w=B+1,x=T.address);case 22:w>1?(console.log("确认合并单元格: ".concat(x,", 跨").concat(w,"行")),f.push({address:x,startRow:y,endRow:y+w-1,columnIndex:r}),h+=w):h++,e.n=4;break;case 23:if(console.log("最终检测到 ".concat(f.length," 个合并单元格区域")),!(f.length>0)){e.n=39;break}return k("检测到 ".concat(f.length," 个合并单元格区域"),!1),e.n=24,$("在第 ".concat(r+1," 列 (").concat(o,") 中检测到 ").concat(f.length," 个合并单元格区域。\n\n是否将这些合并单元格用黄色背景标注？"));case 24:if(!e.v){e.n=26;break}F=c(f);try{for(F.s();!(O=F.n()).done;)D=O.value,n.getRange(D.address).format.fill.color="#FFFF00"}catch(e){F.e(e)}finally{F.f()}return e.n=25,t.sync();case 25:k("已标注 ".concat(f.length," 个合并单元格区域"));case 26:return e.n=27,$("是否需要拆分合并单元格并合并行数据？\n\n操作说明：\n• 取消单元格合并\n• 相同内容保留其一\n• 不同内容换行拼接到第一行\n• 删除多余行\n• 用浅灰色背景标注处理过的行");case 27:if(!e.v){e.n=39;break}S("处理合并单元格","正在处理 ".concat(f.length," 个合并区域，请耐心等待...")),H=f.sort(function(e,t){return t.startRow-e.startRow}),P=0,_=[],M=H.length,U=0;case 28:if(!(U<H.length)){e.n=38;break}if(W=H[U],!((G=W.endRow-W.startRow+1)<2)){e.n=29;break}return e.a(3,37);case 29:return C(U+1,M,"处理第 ".concat(U+1,"/").concat(M," 个区域: ").concat(W.address)),console.log("处理合并区域: ".concat(W.address,", 行数: ").concat(G)),n.getRange(W.address).unmerge(),e.n=30,t.sync();case 30:return K=W.startRow,(J=n.getRangeByIndexes(K,0,1,d)).load("values"),e.n=31,t.sync();case 31:Z=J.values[0].slice(),Y=1;case 32:if(!(Y<G)){e.n=35;break}return Q=K+Y,(X=n.getRangeByIndexes(Q,0,1,d)).load("values"),e.n=33,t.sync();case 33:for(ee=X.values[0],te=0;te<d;te++)ne=String(Z[te]||"").trim(),(ae=String(ee[te]||"").trim())&&ae!==ne&&(Z[te]=ne?ne+"\n"+ae:ae);case 34:Y++,e.n=32;break;case 35:return J.values=[Z],J.format.wrapText=!0,J.format.fill.color="#F5F5F5",e.n=36,t.sync();case 36:for(_.push(K),re=G-1;re>0;re--)n.getRangeByIndexes(K+re,0,1,d).delete(Excel.DeleteShiftDirection.up),P++;return e.n=37,t.sync();case 37:U++,e.n=28;break;case 38:A(),k("已拆分并合并 ".concat(f.length," 个区域的行数据，删除了 ").concat(P," 行"));case 39:return oe=t.workbook.names,e.p=40,oe.getItem(m).delete(),e.n=41,t.sync();case 41:e.n=43;break;case 42:e.p=42,e.v;case 43:return ce="='".concat(n.name,"'!$").concat(o,":$").concat(o),oe.add(m,ce),e.n=44,t.sync();case 44:I?(I.snColumn=r,I.sheetName=n.name):I={dataRange:"",headerRow:0,snColumn:r,amtColumn:0,sheetName:n.name},le=f.length>0?" (已处理 ".concat(f.length," 个合并区域)"):"",k("成功设置 S/N 列为第 ".concat(r+1," 列 (").concat(o,")").concat(le)),q();case 45:return e.a(2)}},e,null,[[40,42],[6,14]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置SN列时出错:",t),k("设置 S/N 列失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),H.apply(this,arguments)}function q(){var e=document.getElementById("data-range-info");e&&(I&&I.dataRange?(e.textContent=I.dataRange,e.className="step-value clickable",e.title="点击跳转到主报表"):(e.textContent="未配置",e.className="step-value not-configured",e.title=""));var t=document.getElementById("header-row-info");t&&(I&&I.headerRow>0?(t.textContent="第 ".concat(I.headerRow," 行"),t.className="step-value"):(t.textContent="未配置",t.className="step-value not-configured"));var n=document.getElementById("sn-col-info");if(n)if(I&&I.snColumn>=0){var a=v(I.snColumn);n.textContent="第 ".concat(I.snColumn+1," 列 (").concat(a,")"),n.className="step-value"}else n.textContent="未配置",n.className="step-value not-configured";var r=document.getElementById("amt-col-info");if(r)if(I&&I.amtColumn>=0){var o=v(I.amtColumn);r.textContent="第 ".concat(I.amtColumn+1," 列 (").concat(o,")"),r.className="step-value"}else r.textContent="未配置",r.className="step-value not-configured";var c=document.getElementById("btn-enable-filter");if(c){var l=I&&I.dataRange&&I.headerRow>0&&I.snColumn>=0&&I.amtColumn>=0;c.disabled=!l}}function P(){var e,t=document.getElementById("reports-table-body");if(t){var n="";I&&I.sheetName&&(n+='\n      <tr class="main-report-row">\n        <td>\n          <span class="main-report-link" title="点击跳转到主报表">\n            <i class="ms-Icon ms-Icon--Home" style="margin-right: 4px; font-size: 10px;"></i>'.concat(I.sheetName,'\n          </span>\n        </td>\n        <td><span class="main-report-badge">主报表</span></td>\n        <td></td>\n      </tr>\n    ')),0!==w.length||null!==(e=I)&&void 0!==e&&e.sheetName?(n+=w.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return'\n      <tr>\n        <td>\n          <span class="report-name-display" data-index="'.concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="点击跳转，双击修改名称">').concat(e.sheetName,'</span>\n          <div class="report-name-edit-container" style="display: none;">\n            <input type="text" class="report-name-input" data-index="').concat(t,'" value="').concat(e.sheetName,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n        </td>\n        <td>').concat(n,'</td>\n        <td>\n          <button class="icon-button-small danger" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="删除报表">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </td>\n      </tr>\n    ')}).join(""),t.innerHTML=n,t.querySelectorAll(".main-report-link").forEach(function(e){e.addEventListener("click",function(){ie()})}),t.querySelectorAll(".report-name-display").forEach(function(e){e.addEventListener("click",function(e){var t=e.target.getAttribute("data-sheet-name");t&&function(e){U.apply(this,arguments)}(t)}),e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container"),o=null==r?void 0:r.querySelector(".report-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),t.querySelectorAll(".report-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){M.apply(this,arguments)}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;_(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){_(n)},200)})}),t.querySelectorAll(".icon-button-small.danger").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){W.apply(this,arguments)}(n,a)})})):t.innerHTML='<tr><td colspan="3" class="no-reports">暂无报表</td></tr>'}}function _(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function M(){return M=f(i().m(function e(t,n){var a,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=w.length)){e.n=1;break}return e.a(2);case 1:if(a=w[t].sheetName,(n=n.trim())&&n!==a){e.n=2;break}return _(t),e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=f(i().m(function e(r){return i().w(function(e){for(;;)switch(e.n){case 0:return r.workbook.worksheets.getItem(a).name=n,e.n=1,r.sync();case 1:w[t].sheetName=n,P(),k("报表名称已修改为: ".concat(n));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,r=e.v,console.error("修改报表名称失败:",r),k("修改名称失败: ".concat(r.message),!0),_(t);case 5:return e.a(2)}},e,null,[[2,4]])})),M.apply(this,arguments)}function U(){return U=f(i().m(function e(t){return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(n){return i().w(function(e){for(;;)switch(e.n){case 0:return n.workbook.worksheets.getItem(t).activate(),e.n=1,n.sync();case 1:k("已跳转到报表: ".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,e.v,k('跳转失败: 找不到工作表 "'.concat(t,'"'),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),U.apply(this,arguments)}function $(e){return new Promise(function(t){var n=document.getElementById("confirm-dialog"),a=document.getElementById("confirm-dialog-message"),r=document.getElementById("confirm-dialog-ok"),o=document.getElementById("confirm-dialog-cancel");if(n&&a&&r&&o){a.textContent=e,n.classList.add("show");var c=function(){n.classList.remove("show"),r.removeEventListener("click",l),o.removeEventListener("click",s)},l=function(){c(),t(!0)},s=function(){c(),t(!1)};r.addEventListener("click",l),o.addEventListener("click",s)}else t(!1)})}function W(){return W=f(i().m(function e(t,n){var a;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,$('确定要删除报表 "'.concat(n,'" 吗？此操作不可恢复。'));case 1:if(e.v){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=f(i().m(function e(a){var r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=a.workbook,e.p=1,r.worksheets.getItem(n).delete(),e.n=2,a.sync();case 2:w.splice(t,1),P(),k("已删除报表: ".concat(n)),e.n=4;break;case 3:e.p=3,e.v,w.splice(t,1),P(),k('报表 "'.concat(n,'" 不存在，已从列表中移除'));case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,a=e.v,k("删除失败: ".concat(a.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),W.apply(this,arguments)}function G(e,t,n){var a={sheetName:e,createTime:(new Date).toISOString(),rowCount:t,totalAmount:n};w.unshift(a),P()}function K(){var e=document.getElementById("filter-conditions-list");e&&(0!==x.length?(e.innerHTML=x.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=e.filterSettings.map(function(e){return e.headerText}).join(", ");return'\n      <div class="filter-condition-item">\n        <div class="filter-condition-info">\n          <span class="filter-name-display" data-index="'.concat(t,'" title="双击修改名称 | ').concat(a,'">').concat(e.name,'</span>\n          <div class="filter-name-edit-container" style="display: none;">\n            <input type="text" class="filter-name-input" data-index="').concat(t,'" value="').concat(e.name,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n          <span class="filter-condition-time">').concat(n,'</span>\n        </div>\n        <div class="filter-condition-actions">\n          <button class="icon-button-small apply-filter-btn" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="应用此筛选条件">\n            <i class="ms-Icon ms-Icon--Play"></i>\n          </button>\n          <button class="icon-button-small danger delete-filter-btn" data-index="').concat(t,'" title="删除此筛选条件">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </div>\n      </div>\n    ')}).join(""),e.querySelectorAll(".filter-name-display").forEach(function(e){e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container"),o=null==r?void 0:r.querySelector(".filter-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),e.querySelectorAll(".filter-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){if(!(e<0||e>=x.length)){t=t.trim();var n=x[e].name;t&&t!==n?(x[e].name=t,K(),k("筛选条件名称已修改为: ".concat(t))):J(e)}}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;J(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){J(n)},200)})}),e.querySelectorAll(".apply-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){Z.apply(this,arguments)}(n,a)})}),e.querySelectorAll(".delete-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t,n=e.currentTarget;(t=parseInt(n.getAttribute("data-index")||"0"))>=0&&t<x.length&&(x.splice(t,1),K(),k("已删除筛选条件"))})})):e.innerHTML='<div class="no-filters">暂无保存的筛选条件</div>')}function J(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function Z(){return Z=f(i().m(function e(t,a){var r,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=x.length)){e.n=1;break}return k("筛选条件不存在",!0),e.a(2);case 1:return r=x[t],e.p=2,e.n=3,Excel.run(function(){var e=f(i().m(function e(t){var a,o,l,s,u,d,f,m,g,p,h,y,b,w,x,S,C,A,R,V,N,B,L,T,z,j,F,O,D,H,q;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook,(o=a.worksheets.getItem(r.config.sheetName)).activate(),o.load("name"),(l=o.getUsedRange()).load("values, rowCount, columnCount, address, rowIndex"),e.n=1,t.sync();case 1:if(l.values&&0!==l.values.length){e.n=2;break}return k("工作表没有数据",!0),e.a(2);case 2:s=l.rowIndex+1,u=s+l.rowCount-1,I={dataRange:l.address,headerRow:s,snColumn:r.config.snColumn,amtColumn:r.config.amtColumn,sheetName:o.name},d=l.values[0],E=[],f=i().m(function e(t){var n,a,o,c,s,u,f,m;return i().w(function(e){for(;;)switch(e.n){case 0:for(n=d[t]?String(d[t]):v(t),a=new Set,o=1;o<l.values.length;o++)c=l.values[o][t],""!==(s=null!=c?String(c):"")&&a.add(s);u=Array.from(a).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),f=r.filterSettings.find(function(e){return e.columnIndex===t}),m=f&&f.isFiltered?new Set(f.filterValues.filter(function(e){return a.has(e)})):new Set(u),E.push({columnIndex:t,headerText:n,allValues:u,selectedValues:m});case 1:return e.a(2)}},e)}),m=0;case 3:if(!(m<l.columnCount)){e.n=5;break}return e.d(n(f(m)),4);case 4:m++,e.n=3;break;case 5:for(te(),g=document.getElementById("btn-apply-filter"),p=document.getElementById("btn-clear-filter"),h=document.getElementById("btn-save-filter"),y=document.getElementById("btn-generate"),b=document.getElementById("btn-reset-filter"),g&&(g.disabled=!1),p&&(p.disabled=!1),h&&(h.disabled=!1),y&&(y.disabled=!1),b&&(b.disabled=!1),w=s+1;w<=u;w++)o.getRange("".concat(w,":").concat(w)).rowHidden=!1;return e.n=6,t.sync();case 6:for(x=[],S=0,C=E;S<C.length;S++)(A=C[S]).selectedValues.size<A.allValues.length&&A.selectedValues.size>0&&x.push({colIdx:A.columnIndex,allowedValues:A.selectedValues,headerText:A.headerText});if(0!==x.length){e.n=7;break}return Y([]),k("已加载筛选条件到面板，当前无筛选"),e.a(2);case 7:R=0,V=0,N=1;case 8:if(!(N<l.values.length)){e.n=17;break}B=l.values[N],L=s+N,T=!1,z=c(x),e.p=9,z.s();case 10:if((j=z.n()).done){e.n=12;break}if(!((F=j.value).colIdx<B.length)){e.n=11;break}if(O=B[F.colIdx],D=null!=O?String(O):"",F.allowedValues.has(D)){e.n=11;break}return T=!0,e.a(3,12);case 11:e.n=10;break;case 12:e.n=14;break;case 13:e.p=13,q=e.v,z.e(q);case 14:return e.p=14,z.f(),e.f(14);case 15:T?(o.getRange("".concat(L,":").concat(L)).rowHidden=!0,R++):V++;case 16:N++,e.n=8;break;case 17:return e.n=18,t.sync();case 18:Y(x.map(function(e){return{columnIndex:e.colIdx,columnName:v(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),H=x.map(function(e){return"".concat(e.headerText,"(").concat(e.allowedValues.size,"项)")}).join(", "),k("已应用筛选条件: ".concat(H," | 可见").concat(V,"行, 隐藏").concat(R,"行"));case 19:return e.a(2)}},e,null,[[9,13,14,15]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,o=e.v,console.error("应用筛选条件时出错:",o),R("应用筛选条件失败: ".concat(o.message)),k("应用筛选条件失败: ".concat(o.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),Z.apply(this,arguments)}function Y(e){var t=document.getElementById("current-filter-display");if(t){var n=e.filter(function(e){return e.isFiltered});0!==n.length?t.innerHTML='\n    <div class="current-filter-title">当前应用的筛选条件：</div>\n    <div class="current-filter-items">\n      '.concat(n.map(function(e){return'\n        <div class="current-filter-item">\n          <span class="filter-field">'.concat(e.headerText,'</span>\n          <span class="filter-separator">：</span>\n          <span class="filter-value">').concat(e.filterValues.join(", "),"</span>\n        </div>\n      ")}).join(""),"\n    </div>\n  "):t.innerHTML='<div class="no-filters">当前未应用筛选条件</div>'}}function Q(){var e=document.getElementById("current-filter-display");if(e){for(var t=[],n=0,a=E;n<a.length;n++){var r=a[n];if(r.selectedValues.size<r.allValues.length&&r.selectedValues.size>0){var o=Array.from(r.selectedValues),c=void 0;o.length<=5?c=o:(c=o.slice(0,5)).push("... (共".concat(o.length,"项)")),t.push({columnIndex:r.columnIndex,columnName:v(r.columnIndex),headerText:r.headerText,filterType:"values",filterValues:c,isFiltered:!0})}}t.length>0?Y(t):E.length>0?e.innerHTML='<div class="no-filters">当前未应用筛选条件（所有字段均为全选）</div>':e.innerHTML='<div class="no-filters">请先点击"启用筛选"加载字段</div>'}}function X(){return X=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,c,l,s,u,d,f,m,g,p,h,y,b,w,x;return i().w(function(e){for(;;)switch(e.n){case 0:return r=t.workbook,(o=r.worksheets.getActiveWorksheet()).load("name"),(c=o.getUsedRange()).load("values, rowCount, columnCount, address"),e.n=1,t.sync();case 1:if(c.values&&!(c.values.length<2)){e.n=2;break}return k("当前工作表数据不足",!0),e.a(2);case 2:for(l=c.values[0],I={dataRange:c.address,headerRow:1,snColumn:(null===(n=I)||void 0===n?void 0:n.snColumn)||0,amtColumn:(null===(a=I)||void 0===a?void 0:a.amtColumn)||0,sheetName:o.name},E=[],s=0;s<c.columnCount;s++){for(u=l[s]?String(l[s]):v(s),d=new Set,f=1;f<c.values.length;f++)m=c.values[f][s],""!==(g=null!=m?String(m):"")&&d.add(g);p=Array.from(d).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),E.push({columnIndex:s,headerText:u,allValues:p,selectedValues:new Set(p)})}te(),h=document.getElementById("btn-apply-filter"),y=document.getElementById("btn-clear-filter"),b=document.getElementById("btn-save-filter"),w=document.getElementById("btn-generate"),x=document.getElementById("btn-reset-filter"),h&&(h.disabled=!1),y&&(y.disabled=!1),b&&(b.disabled=!1),w&&(w.disabled=!1),x&&(x.disabled=!1),q(),k("已加载 ".concat(E.length," 个字段的筛选选项"));case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载筛选面板时出错:",t),k("加载筛选面板失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),X.apply(this,arguments)}var ee=-1;function te(){var e=document.getElementById("filter-panel");if(e)if(0!==E.length){for(var t='<div class="filter-tags-container">',n=0;n<E.length;n++){var a=E[n],r=a.selectedValues.size,o=a.allValues.length,c=r<o,l="filter-tag";c&&(l+=" filtered"),n===ee&&(l+=" active"),t+='\n      <div class="'.concat(l,'" data-field-index="').concat(n,'">\n        <span class="filter-tag-name">').concat(ne(a.headerText),'</span>\n        <span class="filter-tag-count">').concat(c?r+"/":"").concat(o,"</span>\n      </div>\n    ")}t+="</div>";var s="";if(ee>=0&&ee<E.length){var i=E[ee],u="filter-field-".concat(ee);s='\n      <div class="filter-dropdown show" data-field-index="'.concat(ee,'">\n        <div class="filter-dropdown-header">\n          <span class="filter-dropdown-title">').concat(ne(i.headerText),' 筛选</span>\n          <button class="filter-dropdown-close" id="btn-close-dropdown">收起</button>\n        </div>\n        <input type="text" class="filter-field-search" placeholder="搜索选项..." \n               id="').concat(u,'-search" data-field-index="').concat(ee,'">\n        <div class="filter-options-container" id="').concat(u,'-options">\n    ');for(var d=0;d<i.allValues.length;d++){var f=i.allValues[d],m=i.selectedValues.has(f),g=f.length>40?f.substring(0,40)+"...":f;s+='\n        <div class="filter-option '.concat(m?"selected":"",'" \n             data-field-index="').concat(ee,'" data-value-index="').concat(d,'" data-value="').concat(ne(f),'">\n          <input type="checkbox" ').concat(m?"checked":"",' \n                 id="').concat(u,"-opt-").concat(d,'" data-field-index="').concat(ee,'" data-value="').concat(ne(f),'">\n          <span class="filter-option-label" title="').concat(ne(f),'">').concat(ne(g),"</span>\n        </div>\n      ")}s+='\n        </div>\n        <div class="filter-select-actions" id="'.concat(u,'-actions">\n          <button class="filter-select-action" data-field-index="').concat(ee,'" data-action="all">全选</button>\n          <button class="filter-select-action" data-field-index="').concat(ee,'" data-action="none">全不选</button>\n          <button class="filter-select-action" data-field-index="').concat(ee,'" data-action="invert">反选</button>\n        </div>\n        <div class="filter-search-hint" id="').concat(u,'-search-hint" style="display: none;">\n          <i class="ms-Icon ms-Icon--Info" aria-hidden="true"></i>\n          <span>以上操作仅针对当前搜索结果</span>\n        </div>\n      </div>\n    ')}e.innerHTML=t+s}else e.innerHTML='<div class="filter-panel-hint">请先点击"启用筛选"加载字段</div>'}function ne(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}var ae=!1;function re(e){var t=E[e];if(t){var n=document.querySelector('.filter-tag[data-field-index="'.concat(e,'"]'));if(n){var a=t.selectedValues.size,r=t.allValues.length,o=a<r;n.classList.toggle("filtered",o);var c=n.querySelector(".filter-tag-count");c&&(c.textContent=o?"".concat(a,"/").concat(r):"".concat(r))}}}function oe(){return oe=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(0!==E.length){e.n=1;break}return k("请先加载筛选面板",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,l,s,u,d,f,m,g,p,h,y,b,w,x,S,C,A,V,L,T;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.workbook,(a=I?n.worksheets.getItem(I.sheetName):n.worksheets.getActiveWorksheet()).activate(),(r=a.getUsedRange()).load("values, rowCount, rowIndex"),e.n=1,t.sync();case 1:if(r.values&&0!==r.values.length){e.n=2;break}return k("工作表没有数据",!0),e.a(2);case 2:o=r.rowIndex+1,l=o+r.rowCount-1,s=[],u=c(E);try{for(u.s();!(d=u.n()).done;)(f=d.value).selectedValues.size<f.allValues.length&&f.selectedValues.size>0&&s.push({colIdx:f.columnIndex,allowedValues:f.selectedValues,headerText:f.headerText})}catch(e){u.e(e)}finally{u.f()}for(m=o+1;m<=l;m++)a.getRange("".concat(m,":").concat(m)).rowHidden=!1;return e.n=3,t.sync();case 3:if(0!==s.length){e.n=4;break}return Y([]),k("已清除所有筛选，显示全部数据"),e.a(2);case 4:g=0,p=0,h=1;case 5:if(!(h<r.values.length)){e.n=14;break}y=r.values[h],b=o+h,w=!1,x=c(s),e.p=6,x.s();case 7:if((S=x.n()).done){e.n=9;break}if(!((C=S.value).colIdx<y.length)){e.n=8;break}if(A=y[C.colIdx],V=null!=A?String(A):"",C.allowedValues.has(V)){e.n=8;break}return w=!0,e.a(3,9);case 8:e.n=7;break;case 9:e.n=11;break;case 10:e.p=10,T=e.v,x.e(T);case 11:return e.p=11,x.f(),e.f(11);case 12:w?(a.getRange("".concat(b,":").concat(b)).rowHidden=!0,g++):p++;case 13:h++,e.n=5;break;case 14:return e.n=15,t.sync();case 15:return Y(s.map(function(e){return{columnIndex:e.colIdx,columnName:v(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),N(),e.n=16,B();case 16:L=s.map(function(e){var t=e.allowedValues.size;return"".concat(e.headerText,"(").concat(t,"项)")}).join(", "),k("已应用筛选: ".concat(L," | 可见").concat(p,"行, 隐藏").concat(g,"行")),R("应用筛选: ".concat(L));case 17:return e.a(2)}},e,null,[[6,10,11,12]])}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("应用筛选时出错:",t),k("应用筛选失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),oe.apply(this,arguments)}function ce(){return ce=f(i().m(function e(){var t,n,a,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:t=c(E);try{for(t.s();!(n=t.n()).done;)(a=n.value).selectedValues=new Set(a.allValues)}catch(e){t.e(e)}finally{t.f()}return te(),e.p=1,e.n=2,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,c;return i().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,a=I?n.worksheets.getItem(I.sheetName):n.worksheets.getActiveWorksheet(),(r=a.getUsedRange()).load("rowCount"),e.n=1,t.sync();case 1:for(o=2;o<=r.rowCount;o++)a.getRange("".concat(o,":").concat(o)).rowHidden=!1;return e.n=2,t.sync();case 2:Y([]),(c=document.getElementById("filter-text-container"))&&(c.style.display="none"),k("已清除所有筛选");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,r=e.v,console.error("清除筛选时出错:",r),k("清除筛选失败: ".concat(r.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),ce.apply(this,arguments)}function le(){return se.apply(this,arguments)}function se(){return(se=f(i().m(function e(){var t,n,a,o,l,s,u;return i().w(function(e){for(;;)switch(e.n){case 0:n=[],a=c(E);try{for(a.s();!(o=a.n()).done;)(l=o.value).selectedValues.size<l.allValues.length&&l.selectedValues.size>0&&(n.push({columnIndex:l.columnIndex,columnName:v(l.columnIndex),headerText:l.headerText,filterType:"values",filterValues:Array.from(l.selectedValues),isFiltered:!0}),R("筛选条件 - ".concat(l.headerText,": ").concat(l.selectedValues.size,"/").concat(l.allValues.length,"项")))}catch(e){a.e(e)}finally{a.f()}if(0!==n.length){e.n=1;break}return R("没有筛选条件需要保存"),e.a(2);case 1:s={id:"filter_".concat(Date.now()),name:"筛选条件_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(t=I)||void 0===t?void 0:t.sheetName)||"未知",filterSettings:n,config:I?r({},I):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}},x.unshift(s),K(),Q(),u=n.length,R("已保存筛选条件: ".concat(u," 列有筛选"));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function ie(){return ue.apply(this,arguments)}function ue(){return ue=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(I&&I.sheetName){e.n=1;break}return k("未配置主报表",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=f(i().m(function e(t){var n,a;return i().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,(a=n.worksheets.getItem(I.sheetName)).activate(),a.getRange("A1").select(),e.n=1,t.sync();case 1:k("已跳转到主报表: ".concat(I.sheetName));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("跳转到主报表失败:",t),k("跳转失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),ue.apply(this,arguments)}function de(){return de=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(I&&I.sheetName){e.n=1;break}return k("未配置主报表",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,l,s,u,d,f,m;return i().w(function(e){for(;;)switch(e.n){case 0:return n=t.workbook,(a=n.worksheets.getItem(I.sheetName)).activate(),(r=a.getUsedRange()).load("rowCount, rowIndex"),e.n=1,t.sync();case 1:for(o=r.rowIndex+1,l=o+r.rowCount-1,s=o+1;s<=l;s++)a.getRange("".concat(s,":").concat(s)).rowHidden=!1;return a.getRange("A1").select(),e.n=2,t.sync();case 2:u=c(E);try{for(u.s();!(d=u.n()).done;)(f=d.value).selectedValues=new Set(f.allValues)}catch(e){u.e(e)}finally{u.f()}ee=-1,te(),Q(),(m=document.getElementById("filter-text-container"))&&(m.style.display="none"),k("已重置筛选并跳转到主报表");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("重置筛选失败:",t),k("重置失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),de.apply(this,arguments)}function fe(){return fe=f(i().m(function e(){var n;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(n){var a,r,o,l,s,u,d,f,p,h,w,x,S,C,A,V,N,B,L,T,F,O,D,H,q,P,_,M,U,$,W,K,J,Z,Y,Q,X,ee,te,ne,ae,re,oe,ce,se,ie,ue,de,fe,me,ge,pe,he,ve,ye,be,we,xe,Ie,Ee,ke,Se,Ce,Ae,Re,Ve,Ne,Be,Le,Te,ze,je,Fe,Oe,De,He,qe,Pe,_e,Me;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=n.workbook,(o=r.worksheets.getActiveWorksheet()).load("name"),l=null,s=null,u="",e.p=1,(d=r.names.getItem(m)).load("name, formula"),e.n=2,n.sync();case 2:return u=o.name,(f=d.getRange()).load("columnIndex, address, columnCount"),e.n=3,n.sync();case 3:p=f.columnIndex,h=b(d.formula),w=null,h&&(w=y(h)),l=null!==w?w:p,R("S/N 列 NamedItem: ".concat(d.name)),R("  公式: ".concat(d.formula)),R("  地址: ".concat(f.address)),R("  从 Range 获取列索引: ".concat(p," (列 ").concat(v(p),")")),h&&R("  从公式解析列名: ".concat(h,", 列索引: ").concat(w)),R("  最终使用列索引: ".concat(l," (列 ").concat(v(l),")")),e.n=5;break;case 4:return e.p=4,e.v,k('错误: 未配置 S/N 列，请先点击"设为 S/N 列"按钮',!0),e.a(2);case 5:return e.p=5,(x=r.names.getItem(g)).load("name, formula"),e.n=6,n.sync();case 6:return(S=x.getRange()).load("columnIndex, address, columnCount"),e.n=7,n.sync();case 7:C=S.columnIndex,A=b(x.formula),V=null,A&&(V=y(A)),s=null!==V?V:C,R("金额列 NamedItem: ".concat(x.name)),R("  公式: ".concat(x.formula)),R("  地址: ".concat(S.address)),R("  从 Range 获取列索引: ".concat(C," (列 ").concat(v(C),")")),A&&R("  从公式解析列名: ".concat(A,", 列索引: ").concat(V)),R("  最终使用列索引: ".concat(s," (列 ").concat(v(s),")")),e.n=9;break;case 8:return e.p=8,e.v,k('错误: 未配置金额列，请先点击"设为金额列"按钮',!0),e.a(2);case 9:if(N=o.getUsedRange()){e.n=10;break}return k("错误: 无法获取工作表使用范围",!0),e.a(2);case 10:return N.load("rowCount, columnCount, address, values"),B=[],e.n=11,n.sync();case 11:if(0!==N.rowCount&&0!==N.columnCount){e.n=12;break}return k("错误: 当前工作表没有数据",!0),e.a(2);case 12:for(L=N.rowCount,T=N.columnCount,F=1;F<=L;F++)(O=o.getRange("".concat(F,":").concat(F))).load("rowHidden"),B.push(O);return e.n=13,n.sync();case 13:if(N.values&&0!==N.values.length){e.n=14;break}return k("错误: 无法读取工作表数据 (行数: ".concat(L,", 列数: ").concat(T,")"),!0),e.a(2);case 14:for(z(),R("开始处理数据..."),R("S/N 列索引: ".concat(l,", 金额列索引: ").concat(s)),l===s&&R("警告: S/N 列和金额列的索引相同！这可能导致错误。"),D=[],H=function(e){return e&&Array.isArray(e)?e.length===T?e:e.length<T?[].concat(t(e),t(new Array(T-e.length).fill(""))):e.slice(0,T):new Array(T).fill("")},N.values.length>0&&N.values[0]&&D.push(H(N.values[0])),q=1;q<L&&q<B.length&&q<N.values.length;q++)(P=B[q])&&!P.rowHidden&&(_=N.values[q])&&Array.isArray(_)&&D.push(H(_));if(0!=(M=D.length-1)){e.n=15;break}return k("筛选后没有符合条件的数据行，请调整筛选条件后重试。",!0),e.a(2);case 15:for(R("筛选完成，可见数据行数: ".concat(M)),U=0,$=[],W=1;W<D.length;W++)K=D[W],J=W+1,K&&Array.isArray(K)&&null!==s&&s>=0&&s<K.length?(Z=K[s],Y=null!==l&&l>=0&&l<K.length?K[l]:"N/A",null!=Z&&""!==Z?(Q=j(Z),U+=Q,$.push(Q),X="string"==typeof Z?'"'.concat(Z,'"'):String(Z),R("Row ".concat(J,": SN列[").concat(l,"]=").concat(Y,", 金额列[").concat(s,"]=").concat(X," -> Clean=").concat(Q.toFixed(2)))):R("Row ".concat(J,": SN列[").concat(l,"]=").concat(Y,", 金额列[").concat(s,"]=空"))):R("Row ".concat(J,": 警告 - 金额列索引 ").concat(s," 超出数据范围 (数据长度: ").concat(K?K.length:0,")"));R("--- 汇总 ---"),R("总金额: ".concat(U.toFixed(2))),R("金额明细: [".concat($.map(function(e){return e.toFixed(2)}).join(", "),"]")),ee=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19),te="报表_".concat(ee),e.p=16,ne=r.worksheets.add(te),e.n=22;break;case 17:e.p=17,e.v,ae=1;case 18:return e.p=19,ne=r.worksheets.add("".concat(te,"_").concat(ae)),e.a(3,22);case 20:e.p=20,e.v,ae++;case 21:e.n=18;break;case 22:ne.load("name"),re="无筛选条件",oe=[];try{ce=c(E);try{for(ce.s();!(se=ce.n()).done;)(ie=se.value).selectedValues.size<ie.allValues.length&&ie.selectedValues.size>0&&(ue=Array.from(ie.selectedValues),void 0,de=ue.length<=5?ue.join("; "):ue.slice(0,5).join("; ")+"... (共".concat(ue.length,"项)"),oe.push({fieldName:ie.headerText,values:de}),R("筛选条件 - ".concat(ie.headerText,": ").concat(ue.length,"/").concat(ie.allValues.length,"项")))}catch(e){ce.e(e)}finally{ce.f()}if(oe.length>0)re=oe.map(function(e){return"【".concat(e.fieldName,"】：").concat(e.values)}).join("\n"),R("筛选条件: ".concat(re));else{for(fe=0,me=1;me<B.length;me++)B[me]&&B[me].rowHidden&&fe++;fe>0?(re="已筛选 (隐藏".concat(fe,"行)"),R("有".concat(fe,"行被隐藏"))):R("未检测到筛选条件")}}catch(e){console.warn("获取筛选条件失败:",e),R("获取筛选条件失败: ".concat(e.message))}if(ge=oe.length>0?oe.length:1,he=(pe=4+ge+1)+1,(ve=ne.getRange("A1:E".concat(pe))).format.verticalAlignment=Excel.VerticalAlignment.center,ve.format.horizontalAlignment=Excel.HorizontalAlignment.left,ve.format.fill.color="#F5F5F5",ve.format.font.name="Arial",ve.format.font.size=11,ve.format.font.color="#323130",ye=[["报表 Dashboard","","","",""],["总条数",M.toString(),"","源表名称",u],["总金额",U.toFixed(2),"","生成时间",(new Date).toLocaleString("zh-CN")]],ne.getRange("A1:E3").values=ye,(be=ne.getRange("A1:E1")).merge(),be.format.font.size=14,be.format.font.bold=!0,be.format.font.color="#0078d4",be.format.horizontalAlignment=Excel.HorizontalAlignment.center,(we=ne.getRange("A2:A3")).format.font.bold=!0,we.format.font.color="#323130",(xe=ne.getRange("B2:B3")).format.font.color="#0078d4",xe.format.font.bold=!0,ne.getRange("D2:D3").format.font.bold=!0,ne.getRange("E2:E3").format.font.color="#323130",Ie=ne.getRange("E2"),Ee=(null===(a=I)||void 0===a?void 0:a.headerRow)||1,ke="'".concat(u,"'!A").concat(Ee),Ie.hyperlink={address:"",documentReference:ke,screenTip:"点击返回原表: ".concat(u),textToDisplay:u},Ie.format.font.color="#0078d4",Ie.format.font.underline=Excel.RangeUnderlineStyle.single,oe.length>0)for(Se=0;Se<oe.length;Se++)Ce=4+Se,Ae=oe[Se],ne.getRange("A".concat(Ce,":E").concat(Ce)).values=0===Se?[["筛选条件","【".concat(Ae.fieldName,"】"),Ae.values,"",""]]:[["","【".concat(Ae.fieldName,"】"),Ae.values,"",""]],(Re=ne.getRange("A".concat(Ce))).format.font.bold=!0,Re.format.font.color="#323130",(Ve=ne.getRange("B".concat(Ce))).format.font.color="#0d47a1",Ve.format.font.bold=!0,(Ne=ne.getRange("C".concat(Ce))).format.font.color="#323130",Ne.format.wrapText=!0;else ne.getRange("A4:E4").values=[["筛选条件","无筛选条件","","",""]],(Be=ne.getRange("A4")).format.font.bold=!0,Be.format.font.color="#323130",(Le=ne.getRange("B4")).format.font.color="#a19f9d",Le.format.font.italic=!0;return ve.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("EdgeTop").color="#D1D1D1",ve.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("EdgeBottom").color="#D1D1D1",ve.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("EdgeLeft").color="#D1D1D1",ve.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("EdgeRight").color="#D1D1D1",ve.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("InsideHorizontal").color="#E1E1E1",ve.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,ve.format.borders.getItem("InsideVertical").color="#E1E1E1",e.n=23,n.sync();case 23:if(!(D.length>0)){e.n=27;break}for(Te=v(T-1),R("准备写入数据..."),R("目标范围: A".concat(he,":").concat(Te).concat(he+D.length-1)),R("filteredRows.length = ".concat(D.length)),R("columnCount = ".concat(T)),ze=0;ze<D.length;ze++)(je=D[ze]?D[ze].length:0)!==T&&R("警告: 第 ".concat(ze," 行列数 (").concat(je,") 与 columnCount (").concat(T,") 不匹配"));Fe=D.length,Oe=T,R("目标区域: ".concat(Fe," 行 x ").concat(Oe," 列")),De=ne.getRange("A".concat(he,":").concat(Te).concat(he+D.length-1)),e.p=24,De.values=D,e.n=26;break;case 25:throw e.p=25,Me=e.v,R("写入数据失败: ".concat(Me.message)),R("第一行数据: ".concat(JSON.stringify(D[0]))),D.length>1&&R("第二行数据: ".concat(JSON.stringify(D[1]))),Me;case 26:if(De.format.font.name="Arial",De.format.font.size=11,De.format.font.color="#323130",De.format.verticalAlignment=Excel.VerticalAlignment.center,De.format.horizontalAlignment=Excel.HorizontalAlignment.left,(He=ne.getRange("A".concat(he,":").concat(Te).concat(he))).format.fill.color="#0078d4",He.format.font.bold=!0,He.format.font.color="#FFFFFF",He.format.font.size=11,He.format.font.name="Arial",He.format.horizontalAlignment=Excel.HorizontalAlignment.center,He.format.verticalAlignment=Excel.VerticalAlignment.center,He.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,He.format.borders.getItem("EdgeTop").color="#005a9e",He.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,He.format.borders.getItem("EdgeBottom").color="#005a9e",He.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,He.format.borders.getItem("EdgeLeft").color="#005a9e",He.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,He.format.borders.getItem("EdgeRight").color="#005a9e",D.length>1)for((qe=ne.getRange("A".concat(he+1,":").concat(Te).concat(he+D.length-1))).format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("EdgeTop").color="#E1E1E1",qe.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("EdgeBottom").color="#E1E1E1",qe.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("EdgeLeft").color="#E1E1E1",qe.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("EdgeRight").color="#E1E1E1",qe.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("InsideHorizontal").color="#F0F0F0",qe.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,qe.format.borders.getItem("InsideVertical").color="#F0F0F0",_e=Pe=he+1;_e<=he+D.length-1;_e++)ne.getRange("A".concat(_e,":").concat(Te).concat(_e)).format.fill.color=(_e-Pe)%2==0?"#FAFAFA":"#FFFFFF";case 27:return ne.getUsedRange().format.autofitColumns(),ne.getUsedRange().format.rowHeight=20,ne.getRange("1:".concat(pe)).format.rowHeight=22,ne.activate(),e.n=28,n.sync();case 28:return G(ne.name,M,U),e.n=29,le();case 29:k("报表生成成功！共 ".concat(M," 条记录，总金额: ").concat(U.toFixed(2)));case 30:return e.a(2)}},e,null,[[24,25],[19,20],[16,17],[5,8],[1,4]])}));return function(t){return e.apply(this,arguments)}}());case 1:return N(),e.n=2,B();case 2:e.n=4;break;case 3:e.p=3,n=e.v,console.error("生成报表时出错:",n),k("生成报表失败: ".concat(n.message),!0);case 4:return e.a(2)}},e,null,[[0,3]])})),fe.apply(this,arguments)}function me(){return me=f(i().m(function e(){var t;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=f(i().m(function e(t){var n,a,r,o,c,l,s,u,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.workbook,e.p=1,(a=n.names.getItem(p)).load("formula"),e.n=2,t.sync();case 2:(r=a.formula.match(/=([^!]+)!([^$]+)/))&&(I?(I.dataRange=a.formula.replace(/^=/,""),I.sheetName=r[1]):I={dataRange:a.formula.replace(/^=/,""),headerRow:0,snColumn:0,amtColumn:0,sheetName:r[1]}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.p=4,(o=n.names.getItem(h)).load("formula"),e.n=5,t.sync();case 5:(c=o.formula.match(/:(\d+):/))&&I&&(I.headerRow=parseInt(c[1])),e.n=7;break;case 6:e.p=6,e.v;case 7:return e.p=7,l=n.names.getItem(m),(s=l.getRange()).load("columnIndex"),e.n=8,t.sync();case 8:I&&(I.snColumn=s.columnIndex),e.n=10;break;case 9:e.p=9,e.v;case 10:return e.p=10,u=n.names.getItem(g),(d=u.getRange()).load("columnIndex"),e.n=11,t.sync();case 11:I&&(I.amtColumn=d.columnIndex),e.n=13;break;case 12:e.p=12,e.v;case 13:return e.a(2)}},e,null,[[10,12],[7,9],[4,6],[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载主报表配置时出错:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),me.apply(this,arguments)}Office.onReady(function(e){var t,n,a,o,l,s,u,d,m,p,h,y,b;e.host===Office.HostType.Excel&&(null===(t=document.getElementById("btn-set-data-range"))||void 0===t||t.addEventListener("click",function(){!function(){F.apply(this,arguments)}()}),null===(n=document.getElementById("btn-set-header-row"))||void 0===n||n.addEventListener("click",function(){!function(){O.apply(this,arguments)}()}),null===(a=document.getElementById("btn-set-sn"))||void 0===a||a.addEventListener("click",function(){!function(){H.apply(this,arguments)}()}),null===(o=document.getElementById("btn-set-amt"))||void 0===o||o.addEventListener("click",function(){!function(e,t){D.apply(this,arguments)}(g,"金额列")}),null===(l=document.getElementById("btn-enable-filter"))||void 0===l||l.addEventListener("click",function(){!function(){X.apply(this,arguments)}()}),null===(s=document.getElementById("btn-generate"))||void 0===s||s.addEventListener("click",function(){!function(){fe.apply(this,arguments)}()}),null===(u=document.getElementById("btn-apply-filter"))||void 0===u||u.addEventListener("click",function(){!function(){oe.apply(this,arguments)}()}),null===(d=document.getElementById("btn-clear-filter"))||void 0===d||d.addEventListener("click",function(){!function(){ce.apply(this,arguments)}()}),null===(m=document.getElementById("btn-save-filter"))||void 0===m||m.addEventListener("click",function(){!function(){var e;if(0!==E.length){for(var t=[],n=0,a=E;n<a.length;n++){var o=a[n];o.selectedValues.size<o.allValues.length&&o.selectedValues.size>0&&t.push({columnIndex:o.columnIndex,columnName:v(o.columnIndex),headerText:o.headerText,filterType:"values",filterValues:Array.from(o.selectedValues),isFiltered:!0})}if(0!==t.length){var c={id:"filter_".concat(Date.now()),name:"筛选_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(e=I)||void 0===e?void 0:e.sheetName)||"未知",filterSettings:t,config:I?r({},I):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}};x.unshift(c),K();var l=t.map(function(e){return"".concat(e.headerText,"(").concat(e.filterValues.length,"项)")}).join(", ");k("已保存筛选条件: ".concat(l))}else k("没有需要保存的筛选条件（所有字段都是全选状态）",!0)}else k("请先加载筛选面板",!0)}()}),null===(p=document.getElementById("btn-reset-filter"))||void 0===p||p.addEventListener("click",function(){!function(){de.apply(this,arguments)}()}),null===(h=document.getElementById("data-range-info"))||void 0===h||h.addEventListener("click",function(){ie()}),(b=document.getElementById("filter-panel"))&&!ae&&(ae=!0,console.log("[筛选面板] 绑定事件委托"),b.addEventListener("click",function(e){var t=e.target,n=t.closest(".filter-tag");if(n){var a=parseInt(n.getAttribute("data-field-index")||"-1",10);return ee=a===ee?-1:a,void te()}if("btn-close-dropdown"===t.id||t.closest("#btn-close-dropdown"))return ee=-1,void te();var r=t.closest(".filter-select-action");if(r){e.preventDefault(),e.stopPropagation();var o=parseInt(r.getAttribute("data-field-index")||"0",10),l=r.getAttribute("data-action");if(console.log("[筛选操作] action=".concat(l,", fieldIndex=").concat(o)),o>=0&&o<E.length){var s=E[o],i=document.getElementById("filter-field-".concat(o,"-search")),u=i?i.value.trim():"",d=u.length>0;if(console.log("[筛选操作] isSearchMode=".concat(d,', searchText="').concat(u,'"')),console.log("[筛选操作] 操作前 selectedValues.size=".concat(s.selectedValues.size,", allValues.length=").concat(s.allValues.length)),d){var f=document.getElementById("filter-field-".concat(o,"-options")),m=[];if(f&&f.querySelectorAll(".filter-option:not(.hidden)").forEach(function(e){var t=e.getAttribute("data-value-index"),n=null!==t?parseInt(t,10):-1,a=n>=0&&n<s.allValues.length?s.allValues[n]:e.getAttribute("data-value")||"";m.push(a)}),console.log("[筛选操作] 搜索模式，可见选项数: ".concat(m.length)),"all"===l){var g,p=c(m);try{for(p.s();!(g=p.n()).done;){var h=g.value;s.selectedValues.add(h)}}catch(e){p.e(e)}finally{p.f()}}else if("none"===l){var v,y=c(m);try{for(y.s();!(v=y.n()).done;){var b=v.value;s.selectedValues.delete(b)}}catch(e){y.e(e)}finally{y.f()}}else if("invert"===l){var w,x=c(m);try{for(x.s();!(w=x.n()).done;){var I=w.value;s.selectedValues.has(I)?s.selectedValues.delete(I):s.selectedValues.add(I)}}catch(e){x.e(e)}finally{x.f()}}}else if(console.log("[筛选操作] 非搜索模式，操作所有 ".concat(s.allValues.length," 个选项")),"all"===l)s.selectedValues=new Set(s.allValues);else if("none"===l)s.selectedValues=new Set;else if("invert"===l){var k,S=new Set,C=c(s.allValues);try{for(C.s();!(k=C.n()).done;){var A=k.value;s.selectedValues.has(A)||S.add(A)}}catch(e){C.e(e)}finally{C.f()}console.log("[筛选操作] 反选：之前选中 ".concat(s.selectedValues.size," 个，反选后应选中 ").concat(S.size," 个")),s.selectedValues=S}console.log("[筛选操作] 操作后 selectedValues.size=".concat(s.selectedValues.size)),function(e){var t=E[e],n=document.getElementById("filter-field-".concat(e,"-options"));if(n&&t){var a=n.querySelectorAll(".filter-option");a.forEach(function(e){var n=e.getAttribute("data-value-index"),a=null!==n?parseInt(n,10):-1,r=a>=0&&a<t.allValues.length?t.allValues[a]:e.getAttribute("data-value")||"",o=t.selectedValues.has(r),c=e.querySelector("input[type='checkbox']");c&&(c.checked=o),e.classList.toggle("selected",o)}),console.log("[updateFieldOptions] fieldIndex=".concat(e,", 更新了 ").concat(a.length," 个选项"))}}(o),re(o)}}else{var R=t.closest(".filter-option");if(R&&"INPUT"!==t.tagName){var V=parseInt(R.getAttribute("data-field-index")||"0",10),N=R.querySelector("input[type='checkbox']");if(V>=0&&V<E.length&&N){var B=E[V],L=R.getAttribute("data-value-index"),T=null!==L?parseInt(L,10):-1,z=T>=0&&T<B.allValues.length?B.allValues[T]:R.getAttribute("data-value")||"",j=!N.checked;N.checked=j,j?B.selectedValues.add(z):B.selectedValues.delete(z),R.classList.toggle("selected",j),re(V)}}}}),b.addEventListener("input",function(e){var t=e.target;t.classList.contains("filter-field-search")&&function(e,t){var n=document.getElementById("filter-field-".concat(e,"-options")),a=document.getElementById("filter-field-".concat(e,"-actions")),r=document.getElementById("filter-field-".concat(e,"-search-hint"));if(n){var o=n.querySelectorAll(".filter-option"),c=t.toLowerCase().trim(),l=c.length>0,s=0;if(o.forEach(function(e){var t=(e.getAttribute("data-value")||"").toLowerCase().includes(c);e.classList.toggle("hidden",!t),t&&s++}),a&&a.classList.toggle("search-mode",l),r){r.style.display=l?"flex":"none";var i=r.querySelector("span");i&&l&&(i.textContent="以上操作仅针对当前搜索结果（".concat(s," 项）"))}}}(parseInt(t.getAttribute("data-field-index")||"0",10),t.value)}),b.addEventListener("change",function(e){var t=e.target;if("checkbox"===t.type&&t.closest(".filter-option")){var n=parseInt(t.getAttribute("data-field-index")||"0",10);if(n>=0&&n<E.length){var a=E[n],r=t.closest(".filter-option"),o=t.getAttribute("data-value")||"";if(r){var c=r.getAttribute("data-value-index"),l=null!==c?parseInt(c,10):-1;l>=0&&l<a.allValues.length&&(o=a.allValues[l])}t.checked?a.selectedValues.add(o):a.selectedValues.delete(o),r&&r.classList.toggle("selected",t.checked),re(n)}}})),(y=document.getElementById("filter-text-content"))&&y.addEventListener("click",f(i().m(function e(){return i().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,B();case 1:return e.a(2)}},e)}))),function(){return me.apply(this,arguments)}().then(function(){q(),P(),K()}),console.log("Excel Add-in 初始化完成"))})}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map