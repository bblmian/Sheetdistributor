/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={58394:function(e,t,n){"use strict";e.exports=n.p+"4ca82a402310b021bb5c.css"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function n(){var e,t,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",c=r.toStringTag||"@@toStringTag";function l(n,r,o,c){var l=r&&r.prototype instanceof i?r:i,u=Object.create(l.prototype);return a(u,"_invoke",function(n,a,r){var o,c,l,i=0,u=r||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return o=t,c=0,l=e,f.n=n,s}};function m(n,a){for(c=n,l=a,t=0;!d&&i&&!r&&t<u.length;t++){var r,o=u[t],m=f.p,g=o[2];n>3?(r=g===a)&&(l=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=m&&((r=n<2&&m<o[1])?(c=0,f.v=a,f.n=o[1]):m<g&&(r=n<3||o[0]>a||a>g)&&(o[4]=n,o[5]=a,f.n=g,c=0))}if(r||n>1)return s;throw d=!0,a}return function(r,u,g){if(i>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,g),c=u,l=g;(t=c<2?e:l)||!d;){o||(c?c<3?(c>1&&(f.n=-1),m(c,l)):f.n=l:f.v=l);try{if(i=2,o){if(c||(r="next"),t=o[r]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),c=1);o=e}else if((t=(d=f.n<0)?l:n.call(a,f))!==s)break}catch(t){o=e,c=1,l=t}finally{i=1}}return{value:t,done:d}}}(n,o,c),!0),u}var s={};function i(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][o]?t(t([][o]())):(a(t={},o,function(){return this}),t),m=d.prototype=i.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,a(m,"constructor",d),a(d,"constructor",u),u.displayName="GeneratorFunction",a(d,c,"GeneratorFunction"),a(m),a(m,c,"Generator"),a(m,o,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:l,m:g}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function c(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(c("next",0),c("throw",1),c("return",2))},a(e,t,n,r)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(t,n,a){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function i(e,t,n,a,r,o,c){try{var l=e[o](c),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,l,"next",e)}function l(e){i(o,a,r,c,l,"throw",e)}c(void 0)})}}var d="Wiz_Cfg_SN_Col",f="Wiz_Cfg_Amt_Col",m="Wiz_Cfg_Data_Range",g="Wiz_Cfg_Header_Row";function p(e){for(var t="",n=e;n>=0;)t=String.fromCharCode(65+n%26)+t,n=Math.floor(n/26)-1;return t}function v(e){var t=0;e=e.toUpperCase();for(var n=0;n<e.length;n++)t=26*t+(e.charCodeAt(n)-64);return t-1}function h(e){var t=e.match(/![\$]?([A-Z]+)[\$]?:[\$]?[A-Z]+/i);return t&&t[1]?t[1].toUpperCase():null}var y=[],b=[],w=null,I=[];function x(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("message-area");n&&(n.textContent=e,n.className=t?"message-area error":"message-area success"),console.log(e)}function E(e,t){var n=document.getElementById("progress-overlay"),a=document.getElementById("progress-title"),r=document.getElementById("progress-message"),o=document.getElementById("progress-bar"),c=document.getElementById("progress-detail");n&&a&&r&&o&&c&&(a.textContent=e,r.textContent=t,o.style.width="0%",c.textContent="",n.classList.add("show"))}function k(e,t,n){var a=document.getElementById("progress-bar"),r=document.getElementById("progress-detail");if(a&&r){var o=t>0?Math.round(e/t*100):0;a.style.width="".concat(o,"%"),r.textContent=n||"".concat(e," / ").concat(t)}}function S(){var e=document.getElementById("progress-overlay");e&&e.classList.remove("show")}function C(e){var t=document.getElementById("debug-log");if(t){var n=document.createElement("div");n.textContent=e,n.style.marginBottom="2px",t.appendChild(n),t.scrollTop=t.scrollHeight}console.log(e)}function R(){var e=document.getElementById("debug-log");e&&(e.innerHTML="")}function A(e){if(null==e||""===e)return 0;if("number"==typeof e)return isNaN(e)?0:e;var t=String(e).trim();if(""===t)return 0;var n=(t=(t=(t=(t=t.replace(/RMB|CNY|USD|EUR|GBP/gi,"")).replace(/[¥$€£￥]/g,"")).replace(/[,，]/g,"")).replace(/\s+/g,"")).startsWith("-");n&&(t=t.substring(1));var a=(t=t.replace(/[^\d.]/g,"")).indexOf(".");-1!==a&&(t=t.substring(0,a+1)+t.substring(a+1).replace(/\./g,""));var r=parseFloat(t);return isNaN(r)?0:n?-r:r}function N(){return N=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,l,s,i,u,d,f,g,v,h,y,b,I;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if((a=t.workbook.worksheets.getActiveWorksheet()).load("name"),r=t.workbook.getSelectedRange()){e.n=1;break}return x("请先选择一个数据区域",!0),e.a(2);case 1:return r.load("address, rowIndex, columnIndex, rowCount, columnCount"),e.n=2,t.sync();case 2:return(o=r.address).includes("!")&&(c=o.split("!")).length>1&&(c[0].replace(/^'|'$/g,""),o=c[1]),o.includes("$")||(l=r.rowIndex+1,s=r.columnIndex,i=l+r.rowCount-1,u=s+r.columnCount-1,d=p(s),f=p(u),o="$".concat(d,"$").concat(l,":$").concat(f,"$").concat(i)),g=a.name,v=g.includes(" ")||g.includes("-")||g.includes("'")?"'".concat(g.replace(/'/g,"''"),"'"):g,h="".concat(v,"!").concat(o),y=t.workbook.names,e.p=3,y.getItem(m).delete(),e.n=4,t.sync();case 4:e.n=6;break;case 5:e.p=5,e.v;case 6:return b="=".concat(h),C("创建 NamedItem: ".concat(m)),C("公式: ".concat(b)),C("地址: ".concat(h)),e.p=7,y.add(m,b),e.n=8,t.sync();case 8:e.n=10;break;case 9:throw e.p=9,I=e.v,console.error("创建 NamedItem 失败:",I),C("错误: ".concat(I.message)),I;case 10:w?(w.dataRange=h,w.sheetName=g):w={dataRange:h,headerRow:0,snColumn:0,amtColumn:0,sheetName:g},V(),x("已设置数据区域: ".concat(o));case 11:return e.a(2)}},e,null,[[7,9],[3,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置数据区域时出错:",t),x("设置数据区域失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),N.apply(this,arguments)}function B(){return B=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,l;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return(a=t.workbook.worksheets.getActiveWorksheet()).load("name"),(r=t.workbook.getSelectedRange()).load("rowIndex"),e.n=1,t.sync();case 1:return o=r.rowIndex+1,c=t.workbook.names,e.p=2,c.getItem(g).delete(),e.n=3,t.sync();case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return l="".concat(a.name,"!").concat(o,":").concat(o),c.add(g,"=".concat(l)),e.n=6,t.sync();case 6:w?(w.headerRow=o,w.sheetName=a.name):w={dataRange:"",headerRow:o,snColumn:0,amtColumn:0,sheetName:a.name},V(),x("已设置标题行: 第 ".concat(o," 行"));case 7:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置标题行时出错:",t),x("设置标题行失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),B.apply(this,arguments)}function L(){return L=u(n().m(function e(t,a){var r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(r){var o,c,l,s,i,u,m,g,v,h;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return(o=r.workbook.worksheets.getActiveWorksheet()).load("name"),(c=r.workbook.getSelectedRange()).load("address"),e.n=1,r.sync();case 1:return(l=c.getEntireColumn()).load("columnIndex"),e.n=2,r.sync();case 2:return s=l.columnIndex,i=p(s),u=r.workbook.names,e.p=3,u.getItem(t).delete(),e.n=4,r.sync();case 4:e.n=6;break;case 5:e.p=5,e.v;case 6:return m="=".concat(o.name,"!$").concat(i,":$").concat(i),u.add(t,m),e.n=7,r.sync();case 7:return(g=u.getItem(t)).load("name, formula"),(v=g.getRange()).load("columnIndex, address"),e.n=8,r.sync();case 8:(h=v.columnIndex)!==s&&console.warn("警告: NamedItem 列索引不匹配！期望: ".concat(s,", 实际: ").concat(h)),w?(t===d?w.snColumn=s:t===f&&(w.amtColumn=s),w.sheetName=o.name):w={dataRange:"",headerRow:0,snColumn:t===d?s:0,amtColumn:t===f?s:0,sheetName:o.name},x("成功设置".concat(a,"为第 ").concat(s+1," 列 (").concat(i,")，验证列索引: ").concat(h+1)),V();case 9:return e.a(2)}},e,null,[[3,5]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,r=e.v,console.error("设置列配置时出错:",r),x("设置".concat(a,"失败: ").concat(r.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),L.apply(this,arguments)}function T(){return T=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,s,i,u,f,m,g,v,h,y,b,I,C,R,A,N,B,L,T,F,j,O,z,H,q,_,P,$,M,U,W,G,K,Z,Y,J,Q,X,ee,te,ne,ae,re,oe,ce,le,se;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return(a=t.workbook.worksheets.getActiveWorksheet()).load("name"),(r=t.workbook.getSelectedRange()).load("address, columnIndex"),e.n=1,t.sync();case 1:return o=r.columnIndex,c=p(o),(s=a.getUsedRange()).load("rowCount, rowIndex, columnCount, address"),e.n=2,t.sync();case 2:return i=s.rowIndex,u=s.rowCount,f=s.columnCount,m=[],console.log("开始检查列 ".concat(c," 的合并单元格，范围: 行").concat(i+1,"到").concat(i+u)),(g=a.getRangeByIndexes(i,o,u,1)).load("values, address"),e.n=3,t.sync();case 3:v=g.values,console.log("读取到 ".concat(v.length," 个单元格值")),h=0;case 4:if(!(h<u)){e.n=23;break}return y=i+h,(b=a.getCell(y,o)).getExtendedRange(Excel.KeyboardDirection.down).load("rowCount, address, rowIndex"),b.load("address, rowIndex, text"),e.n=5,t.sync();case 5:return I=1,C=b.address,e.p=6,(R=b.getMergedAreasOrNullObject()).load("isNullObject"),e.n=7,t.sync();case 7:if(R.isNullObject){e.n=13;break}return R.load("address, areas"),e.n=8,t.sync();case 8:if(!R.areas||!R.areas.items){e.n=13;break}return(A=R.areas).load("items"),e.n=9,t.sync();case 9:N=0;case 10:if(!(N<A.items.length)){e.n=13;break}return(B=A.items[N]).load("rowCount, address, rowIndex, columnIndex"),e.n=11,t.sync();case 11:if(!(B.rowCount>1&&B.columnIndex===o)){e.n=12;break}return I=B.rowCount,C=B.address,e.a(3,13);case 12:N++,e.n=10;break;case 13:e.n=15;break;case 14:e.p=14,se=e.v,console.log("检查单元格 ".concat(b.address," 时出错:"),se);case 15:if(!(1===I&&h<u-1)){e.n=22;break}L=0,T=h+1;case 16:if(!(T<u)){e.n=19;break}if(null!==v[T][0]){e.n=17;break}L++,e.n=18;break;case 17:return e.a(3,19);case 18:T++,e.n=16;break;case 19:if(!(L>0)){e.n=22;break}return(F=a.getRangeByIndexes(y,o,L+1,1)).load("address, rowCount"),e.n=20,t.sync();case 20:return(j=F.getMergedAreasOrNullObject()).load("isNullObject, address, areaCount"),e.n=21,t.sync();case 21:!j.isNullObject&&j.areaCount>0?(O=j.address)&&O.includes(":")&&(console.log("通过空值检测发现可能的合并区域: ".concat(O)),I=L+1,C=F.address):L>0&&(console.log("发现连续 ".concat(L+1," 个可能合并的单元格（基于空值）: 行").concat(y+1)),I=L+1,C=F.address);case 22:I>1?(console.log("确认合并单元格: ".concat(C,", 跨").concat(I,"行")),m.push({address:C,startRow:y,endRow:y+I-1,columnIndex:o}),h+=I):h++,e.n=4;break;case 23:if(console.log("最终检测到 ".concat(m.length," 个合并单元格区域")),!(m.length>0)){e.n=39;break}return x("检测到 ".concat(m.length," 个合并单元格区域"),!1),e.n=24,D("在第 ".concat(o+1," 列 (").concat(c,") 中检测到 ").concat(m.length," 个合并单元格区域。\n\n是否将这些合并单元格用黄色背景标注？"));case 24:if(!e.v){e.n=26;break}z=l(m);try{for(z.s();!(H=z.n()).done;)q=H.value,a.getRange(q.address).format.fill.color="#FFFF00"}catch(e){z.e(e)}finally{z.f()}return e.n=25,t.sync();case 25:x("已标注 ".concat(m.length," 个合并单元格区域"));case 26:return e.n=27,D("是否需要拆分合并单元格并合并行数据？\n\n操作说明：\n• 取消单元格合并\n• 相同内容保留其一\n• 不同内容换行拼接到第一行\n• 删除多余行\n• 用浅灰色背景标注处理过的行");case 27:if(!e.v){e.n=39;break}E("处理合并单元格","正在处理 ".concat(m.length," 个合并区域，请耐心等待...")),_=m.sort(function(e,t){return t.startRow-e.startRow}),P=0,$=[],M=_.length,U=0;case 28:if(!(U<_.length)){e.n=38;break}if(W=_[U],!((G=W.endRow-W.startRow+1)<2)){e.n=29;break}return e.a(3,37);case 29:return k(U+1,M,"处理第 ".concat(U+1,"/").concat(M," 个区域: ").concat(W.address)),console.log("处理合并区域: ".concat(W.address,", 行数: ").concat(G)),a.getRange(W.address).unmerge(),e.n=30,t.sync();case 30:return K=W.startRow,(Z=a.getRangeByIndexes(K,0,1,f)).load("values"),e.n=31,t.sync();case 31:Y=Z.values[0].slice(),J=1;case 32:if(!(J<G)){e.n=35;break}return Q=K+J,(X=a.getRangeByIndexes(Q,0,1,f)).load("values"),e.n=33,t.sync();case 33:for(ee=X.values[0],te=0;te<f;te++)ne=String(Y[te]||"").trim(),(ae=String(ee[te]||"").trim())&&ae!==ne&&(Y[te]=ne?ne+"\n"+ae:ae);case 34:J++,e.n=32;break;case 35:return Z.values=[Y],Z.format.wrapText=!0,Z.format.fill.color="#F5F5F5",e.n=36,t.sync();case 36:for($.push(K),re=G-1;re>0;re--)a.getRangeByIndexes(K+re,0,1,f).delete(Excel.DeleteShiftDirection.up),P++;return e.n=37,t.sync();case 37:U++,e.n=28;break;case 38:S(),x("已拆分并合并 ".concat(m.length," 个区域的行数据，删除了 ").concat(P," 行"));case 39:return oe=t.workbook.names,e.p=40,oe.getItem(d).delete(),e.n=41,t.sync();case 41:e.n=43;break;case 42:e.p=42,e.v;case 43:return ce="='".concat(a.name,"'!$").concat(c,":$").concat(c),oe.add(d,ce),e.n=44,t.sync();case 44:w?(w.snColumn=o,w.sheetName=a.name):w={dataRange:"",headerRow:0,snColumn:o,amtColumn:0,sheetName:a.name},le=m.length>0?" (已处理 ".concat(m.length," 个合并区域)"):"",x("成功设置 S/N 列为第 ".concat(o+1," 列 (").concat(c,")").concat(le)),V();case 45:return e.a(2)}},e,null,[[40,42],[6,14]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("设置SN列时出错:",t),x("设置 S/N 列失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),T.apply(this,arguments)}function V(){var e=document.getElementById("data-range-info");e&&(w&&w.dataRange?(e.textContent=w.dataRange,e.className="step-value clickable",e.title="点击跳转到主报表"):(e.textContent="未配置",e.className="step-value not-configured",e.title=""));var t=document.getElementById("header-row-info");t&&(w&&w.headerRow>0?(t.textContent="第 ".concat(w.headerRow," 行"),t.className="step-value"):(t.textContent="未配置",t.className="step-value not-configured"));var n=document.getElementById("sn-col-info");if(n)if(w&&w.snColumn>=0){var a=p(w.snColumn);n.textContent="第 ".concat(w.snColumn+1," 列 (").concat(a,")"),n.className="step-value"}else n.textContent="未配置",n.className="step-value not-configured";var r=document.getElementById("amt-col-info");if(r)if(w&&w.amtColumn>=0){var o=p(w.amtColumn);r.textContent="第 ".concat(w.amtColumn+1," 列 (").concat(o,")"),r.className="step-value"}else r.textContent="未配置",r.className="step-value not-configured";var c=document.getElementById("btn-enable-filter");if(c){var l=w&&w.dataRange&&w.headerRow>0&&w.snColumn>=0&&w.amtColumn>=0;c.disabled=!l}}function F(){var e,t=document.getElementById("reports-table-body");if(t){var n="";w&&w.sheetName&&(n+='\n      <tr class="main-report-row">\n        <td>\n          <span class="main-report-link" title="点击跳转到主报表">\n            <i class="ms-Icon ms-Icon--Home" style="margin-right: 4px; font-size: 10px;"></i>'.concat(w.sheetName,'\n          </span>\n        </td>\n        <td><span class="main-report-badge">主报表</span></td>\n        <td></td>\n      </tr>\n    ')),0!==y.length||null!==(e=w)&&void 0!==e&&e.sheetName?(n+=y.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return'\n      <tr>\n        <td>\n          <span class="report-name-display" data-index="'.concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="点击跳转，双击修改名称">').concat(e.sheetName,'</span>\n          <div class="report-name-edit-container" style="display: none;">\n            <input type="text" class="report-name-input" data-index="').concat(t,'" value="').concat(e.sheetName,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n        </td>\n        <td>').concat(n,'</td>\n        <td>\n          <button class="icon-button-small danger" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="删除报表">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </td>\n      </tr>\n    ')}).join(""),t.innerHTML=n,t.querySelectorAll(".main-report-link").forEach(function(e){e.addEventListener("click",function(){te()})}),t.querySelectorAll(".report-name-display").forEach(function(e){e.addEventListener("click",function(e){var t=e.target.getAttribute("data-sheet-name");t&&function(e){z.apply(this,arguments)}(t)}),e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container"),o=null==r?void 0:r.querySelector(".report-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),t.querySelectorAll(".report-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){O.apply(this,arguments)}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;j(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){j(n)},200)})}),t.querySelectorAll(".icon-button-small.danger").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){H.apply(this,arguments)}(n,a)})})):t.innerHTML='<tr><td colspan="3" class="no-reports">暂无报表</td></tr>'}}function j(e){var t,n=document.getElementById("reports-table-body");if(n){var a=n.querySelector('.report-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".report-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function O(){return O=u(n().m(function e(t,a){var r,o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<0||t>=y.length)){e.n=1;break}return e.a(2);case 1:if(r=y[t].sheetName,(a=a.trim())&&a!==r){e.n=2;break}return j(t),e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=u(n().m(function e(o){return n().w(function(e){for(;;)switch(e.n){case 0:return o.workbook.worksheets.getItem(r).name=a,e.n=1,o.sync();case 1:y[t].sheetName=a,F(),x("报表名称已修改为: ".concat(a));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,o=e.v,console.error("修改报表名称失败:",o),x("修改名称失败: ".concat(o.message),!0),j(t);case 5:return e.a(2)}},e,null,[[2,4]])})),O.apply(this,arguments)}function z(){return z=u(n().m(function e(t){return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(a){return n().w(function(e){for(;;)switch(e.n){case 0:return a.workbook.worksheets.getItem(t).activate(),e.n=1,a.sync();case 1:x("已跳转到报表: ".concat(t));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,e.v,x('跳转失败: 找不到工作表 "'.concat(t,'"'),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),z.apply(this,arguments)}function D(e){return new Promise(function(t){var n=document.getElementById("confirm-dialog"),a=document.getElementById("confirm-dialog-message"),r=document.getElementById("confirm-dialog-ok"),o=document.getElementById("confirm-dialog-cancel");if(n&&a&&r&&o){a.textContent=e,n.classList.add("show");var c=function(){n.classList.remove("show"),r.removeEventListener("click",l),o.removeEventListener("click",s)},l=function(){c(),t(!0)},s=function(){c(),t(!1)};r.addEventListener("click",l),o.addEventListener("click",s)}else t(!1)})}function H(){return H=u(n().m(function e(t,a){var r;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,D('确定要删除报表 "'.concat(a,'" 吗？此操作不可恢复。'));case 1:if(e.v){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,Excel.run(function(){var e=u(n().m(function e(r){var o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=r.workbook,e.p=1,o.worksheets.getItem(a).delete(),e.n=2,r.sync();case 2:y.splice(t,1),F(),x("已删除报表: ".concat(a)),e.n=4;break;case 3:e.p=3,e.v,y.splice(t,1),F(),x('报表 "'.concat(a,'" 不存在，已从列表中移除'));case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,r=e.v,x("删除失败: ".concat(r.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),H.apply(this,arguments)}function q(e,t,n){var a={sheetName:e,createTime:(new Date).toISOString(),rowCount:t,totalAmount:n};y.unshift(a),F()}function _(){var e=document.getElementById("filter-conditions-list");e&&(0!==b.length?(e.innerHTML=b.map(function(e,t){var n=new Date(e.createTime).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),a=e.filterSettings.map(function(e){return e.headerText}).join(", ");return'\n      <div class="filter-condition-item">\n        <div class="filter-condition-info">\n          <span class="filter-name-display" data-index="'.concat(t,'" title="双击修改名称 | ').concat(a,'">').concat(e.name,'</span>\n          <div class="filter-name-edit-container" style="display: none;">\n            <input type="text" class="filter-name-input" data-index="').concat(t,'" value="').concat(e.name,'">\n            <i class="ms-Icon ms-Icon--ReturnKey edit-hint-icon" title="按回车确认"></i>\n          </div>\n          <span class="filter-condition-time">').concat(n,'</span>\n        </div>\n        <div class="filter-condition-actions">\n          <button class="icon-button-small apply-filter-btn" data-index="').concat(t,'" data-sheet-name="').concat(e.sheetName,'" title="应用此筛选条件">\n            <i class="ms-Icon ms-Icon--Play"></i>\n          </button>\n          <button class="icon-button-small danger delete-filter-btn" data-index="').concat(t,'" title="删除此筛选条件">\n            <i class="ms-Icon ms-Icon--Delete"></i>\n          </button>\n        </div>\n      </div>\n    ')}).join(""),e.querySelectorAll(".filter-name-display").forEach(function(e){e.addEventListener("dblclick",function(e){var t=e.target;!function(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container"),o=null==r?void 0:r.querySelector(".filter-name-input");a&&r&&o&&(a.style.display="none",r.style.display="flex",o.focus(),o.select())}}(parseInt(t.getAttribute("data-index")||"0"))})}),e.querySelectorAll(".filter-name-input").forEach(function(e){e.addEventListener("keydown",function(e){var t=e;if("Enter"===t.key){var n=e.target;!function(e,t){if(!(e<0||e>=b.length)){t=t.trim();var n=b[e].name;t&&t!==n?(b[e].name=t,_(),x("筛选条件名称已修改为: ".concat(t))):P(e)}}(parseInt(n.getAttribute("data-index")||"0"),n.value)}else if("Escape"===t.key){var a=e.target;P(parseInt(a.getAttribute("data-index")||"0"))}}),e.addEventListener("blur",function(e){var t=e.target,n=parseInt(t.getAttribute("data-index")||"0");setTimeout(function(){P(n)},200)})}),e.querySelectorAll(".apply-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-index")||"0"),a=t.getAttribute("data-sheet-name");a&&function(e,t){$.apply(this,arguments)}(n,a)})}),e.querySelectorAll(".delete-filter-btn").forEach(function(e){e.addEventListener("click",function(e){var t,n=e.currentTarget;(t=parseInt(n.getAttribute("data-index")||"0"))>=0&&t<b.length&&(b.splice(t,1),_(),x("已删除筛选条件"))})})):e.innerHTML='<div class="no-filters">暂无保存的筛选条件</div>')}function P(e){var t,n=document.getElementById("filter-conditions-list");if(n){var a=n.querySelector('.filter-name-display[data-index="'.concat(e,'"]')),r=null==a||null===(t=a.parentElement)||void 0===t?void 0:t.querySelector(".filter-name-edit-container");a&&r&&(a.style.display="inline",r.style.display="none")}}function $(){return $=u(n().m(function e(a,r){var o,c;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(a<0||a>=b.length)){e.n=1;break}return x("筛选条件不存在",!0),e.a(2);case 1:return o=b[a],e.p=2,e.n=3,Excel.run(function(){var e=u(n().m(function e(a){var r,c,s,i,u,d,f,m,g,v,h,y,b,E,k,S,C,R,A,N,B,L,T,V,F,j,O,z,D,H,q;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=a.workbook,(c=r.worksheets.getItem(o.config.sheetName)).activate(),c.load("name"),(s=c.getUsedRange()).load("values, rowCount, columnCount, address, rowIndex"),e.n=1,a.sync();case 1:if(s.values&&0!==s.values.length){e.n=2;break}return x("工作表没有数据",!0),e.a(2);case 2:i=s.rowIndex+1,u=i+s.rowCount-1,w={dataRange:s.address,headerRow:i,snColumn:o.config.snColumn,amtColumn:o.config.amtColumn,sheetName:c.name},d=s.values[0],I=[],f=n().m(function e(t){var a,r,c,l,i,u,f,m;return n().w(function(e){for(;;)switch(e.n){case 0:for(a=d[t]?String(d[t]):p(t),r=new Set,c=1;c<s.values.length;c++)l=s.values[c][t],""!==(i=null!=l?String(l):"")&&r.add(i);u=Array.from(r).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),f=o.filterSettings.find(function(e){return e.columnIndex===t}),m=f&&f.isFiltered?new Set(f.filterValues.filter(function(e){return r.has(e)})):new Set(u),I.push({columnIndex:t,headerText:a,allValues:u,selectedValues:m});case 1:return e.a(2)}},e)}),m=0;case 3:if(!(m<s.columnCount)){e.n=5;break}return e.d(t(f(m)),4);case 4:m++,e.n=3;break;case 5:for(K(),g=document.getElementById("btn-apply-filter"),v=document.getElementById("btn-clear-filter"),h=document.getElementById("btn-save-filter"),y=document.getElementById("btn-generate"),b=document.getElementById("btn-reset-filter"),g&&(g.disabled=!1),v&&(v.disabled=!1),h&&(h.disabled=!1),y&&(y.disabled=!1),b&&(b.disabled=!1),E=i+1;E<=u;E++)c.getRange("".concat(E,":").concat(E)).rowHidden=!1;return e.n=6,a.sync();case 6:for(k=[],S=0,C=I;S<C.length;S++)(R=C[S]).selectedValues.size<R.allValues.length&&R.selectedValues.size>0&&k.push({colIdx:R.columnIndex,allowedValues:R.selectedValues,headerText:R.headerText});if(0!==k.length){e.n=7;break}return M([]),x("已加载筛选条件到面板，当前无筛选"),e.a(2);case 7:A=0,N=0,B=1;case 8:if(!(B<s.values.length)){e.n=17;break}L=s.values[B],T=i+B,V=!1,F=l(k),e.p=9,F.s();case 10:if((j=F.n()).done){e.n=12;break}if(!((O=j.value).colIdx<L.length)){e.n=11;break}if(z=L[O.colIdx],D=null!=z?String(z):"",O.allowedValues.has(D)){e.n=11;break}return V=!0,e.a(3,12);case 11:e.n=10;break;case 12:e.n=14;break;case 13:e.p=13,q=e.v,F.e(q);case 14:return e.p=14,F.f(),e.f(14);case 15:V?(c.getRange("".concat(T,":").concat(T)).rowHidden=!0,A++):N++;case 16:B++,e.n=8;break;case 17:return e.n=18,a.sync();case 18:M(k.map(function(e){return{columnIndex:e.colIdx,columnName:p(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),H=k.map(function(e){return"".concat(e.headerText,"(").concat(e.allowedValues.size,"项)")}).join(", "),x("已应用筛选条件: ".concat(H," | 可见").concat(N,"行, 隐藏").concat(A,"行"));case 19:return e.a(2)}},e,null,[[9,13,14,15]])}));return function(t){return e.apply(this,arguments)}}());case 3:e.n=5;break;case 4:e.p=4,c=e.v,console.error("应用筛选条件时出错:",c),C("应用筛选条件失败: ".concat(c.message)),x("应用筛选条件失败: ".concat(c.message),!0);case 5:return e.a(2)}},e,null,[[2,4]])})),$.apply(this,arguments)}function M(e){var t=document.getElementById("current-filter-display");if(t){var n=e.filter(function(e){return e.isFiltered});0!==n.length?t.innerHTML='\n    <div class="current-filter-title">当前应用的筛选条件：</div>\n    <div class="current-filter-items">\n      '.concat(n.map(function(e){return'\n        <div class="current-filter-item">\n          <span class="filter-field">'.concat(e.headerText,'</span>\n          <span class="filter-separator">：</span>\n          <span class="filter-value">').concat(e.filterValues.join(", "),"</span>\n        </div>\n      ")}).join(""),"\n    </div>\n  "):t.innerHTML='<div class="no-filters">当前未应用筛选条件</div>'}}function U(){var e=document.getElementById("current-filter-display");if(e){for(var t=[],n=0,a=I;n<a.length;n++){var r=a[n];if(r.selectedValues.size<r.allValues.length&&r.selectedValues.size>0){var o=Array.from(r.selectedValues),c=void 0;o.length<=5?c=o:(c=o.slice(0,5)).push("... (共".concat(o.length,"项)")),t.push({columnIndex:r.columnIndex,columnName:p(r.columnIndex),headerText:r.headerText,filterType:"values",filterValues:c,isFiltered:!0})}}t.length>0?M(t):I.length>0?e.innerHTML='<div class="no-filters">当前未应用筛选条件（所有字段均为全选）</div>':e.innerHTML='<div class="no-filters">请先点击"启用筛选"加载字段</div>'}}function W(){return W=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,l,s,i,u,d,f,m,g,v,h,y,b,E,k;return n().w(function(e){for(;;)switch(e.n){case 0:return o=t.workbook,(c=o.worksheets.getActiveWorksheet()).load("name"),(l=c.getUsedRange()).load("values, rowCount, columnCount, address"),e.n=1,t.sync();case 1:if(l.values&&!(l.values.length<2)){e.n=2;break}return x("当前工作表数据不足",!0),e.a(2);case 2:for(s=l.values[0],w={dataRange:l.address,headerRow:1,snColumn:(null===(a=w)||void 0===a?void 0:a.snColumn)||0,amtColumn:(null===(r=w)||void 0===r?void 0:r.amtColumn)||0,sheetName:c.name},I=[],i=0;i<l.columnCount;i++){for(u=s[i]?String(s[i]):p(i),d=new Set,f=1;f<l.values.length;f++)m=l.values[f][i],""!==(g=null!=m?String(m):"")&&d.add(g);v=Array.from(d).sort(function(e,t){return e.localeCompare(t,"zh-CN")}),I.push({columnIndex:i,headerText:u,allValues:v,selectedValues:new Set(v)})}K(),h=document.getElementById("btn-apply-filter"),y=document.getElementById("btn-clear-filter"),b=document.getElementById("btn-save-filter"),E=document.getElementById("btn-generate"),k=document.getElementById("btn-reset-filter"),h&&(h.disabled=!1),y&&(y.disabled=!1),b&&(b.disabled=!1),E&&(E.disabled=!1),k&&(k.disabled=!1),V(),x("已加载 ".concat(I.length," 个字段的筛选选项"));case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载筛选面板时出错:",t),x("加载筛选面板失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),W.apply(this,arguments)}var G=-1;function K(){var e=document.getElementById("filter-panel");if(e)if(0!==I.length){for(var t='<div class="filter-tags-container">',n=0;n<I.length;n++){var a=I[n],r=a.selectedValues.size,o=a.allValues.length,c=r<o,s="filter-tag";c&&(s+=" filtered"),n===G&&(s+=" active"),t+='\n      <div class="'.concat(s,'" data-field-index="').concat(n,'">\n        <span class="filter-tag-name">').concat(Z(a.headerText),'</span>\n        <span class="filter-tag-count">').concat(c?r+"/":"").concat(o,"</span>\n      </div>\n    ")}t+="</div>";var i="";if(G>=0&&G<I.length){var u=I[G],d="filter-field-".concat(G);i='\n      <div class="filter-dropdown show" data-field-index="'.concat(G,'">\n        <div class="filter-dropdown-header">\n          <span class="filter-dropdown-title">').concat(Z(u.headerText),' 筛选</span>\n          <button class="filter-dropdown-close" id="btn-close-dropdown">收起</button>\n        </div>\n        <input type="text" class="filter-field-search" placeholder="搜索选项..." \n               id="').concat(d,'-search" data-field-index="').concat(G,'">\n        <div class="filter-options-container" id="').concat(d,'-options">\n    ');for(var f=0;f<u.allValues.length;f++){var m=u.allValues[f],g=u.selectedValues.has(m),p=m.length>40?m.substring(0,40)+"...":m;i+='\n        <div class="filter-option '.concat(g?"selected":"",'" \n             data-field-index="').concat(G,'" data-value-index="').concat(f,'" data-value="').concat(Z(m),'">\n          <input type="checkbox" ').concat(g?"checked":"",' \n                 id="').concat(d,"-opt-").concat(f,'" data-field-index="').concat(G,'" data-value="').concat(Z(m),'">\n          <span class="filter-option-label" title="').concat(Z(m),'">').concat(Z(p),"</span>\n        </div>\n      ")}i+='\n        </div>\n        <div class="filter-select-actions">\n          <button class="filter-select-action" data-field-index="'.concat(G,'" data-action="all">全选</button>\n          <button class="filter-select-action" data-field-index="').concat(G,'" data-action="none">全不选</button>\n          <button class="filter-select-action" data-field-index="').concat(G,'" data-action="invert">反选</button>\n        </div>\n      </div>\n    ')}e.innerHTML=t+i,function(){var e=document.getElementById("filter-panel");if(e){e.querySelectorAll(".filter-tag").forEach(function(e){e.addEventListener("click",function(e){var t=e.currentTarget,n=parseInt(t.getAttribute("data-field-index")||"-1",10);G=n===G?-1:n,K()})});var t=document.getElementById("btn-close-dropdown");t&&t.addEventListener("click",function(){G=-1,K()}),e.querySelectorAll(".filter-field-search").forEach(function(e){e.addEventListener("input",function(e){var t=e.target;!function(e,t){var n=document.getElementById("filter-field-".concat(e,"-options"));if(n){var a=n.querySelectorAll(".filter-option"),r=t.toLowerCase();a.forEach(function(e){var t=(e.getAttribute("data-value")||"").toLowerCase().includes(r);e.classList.toggle("hidden",!t)})}}(parseInt(t.getAttribute("data-field-index")||"0",10),t.value)})}),e.addEventListener("change",function(e){var t=e.target;if("checkbox"===t.type){var n=parseInt(t.getAttribute("data-field-index")||"0",10),a=t.getAttribute("data-value")||"";if(n>=0&&n<I.length){var r=I[n];t.checked?r.selectedValues.add(a):r.selectedValues.delete(a);var o=t.closest(".filter-option");o&&o.classList.toggle("selected",t.checked),Y(n)}}}),e.addEventListener("click",function(e){var t=e.target;if(t.classList.contains("filter-select-action")){var n=parseInt(t.getAttribute("data-field-index")||"0",10),a=t.getAttribute("data-action");if(n>=0&&n<I.length){var r=I[n];if("all"===a)r.selectedValues=new Set(r.allValues);else if("none"===a)r.selectedValues=new Set;else if("invert"===a){var o,c=new Set,s=l(r.allValues);try{for(s.s();!(o=s.n()).done;){var i=o.value;r.selectedValues.has(i)||c.add(i)}}catch(e){s.e(e)}finally{s.f()}r.selectedValues=c}!function(e){var t=I[e],n=document.getElementById("filter-field-".concat(e,"-options"));n&&t&&n.querySelectorAll(".filter-option").forEach(function(e){var n=e.getAttribute("data-value")||"",a=t.selectedValues.has(n),r=e.querySelector("input[type='checkbox']");r&&(r.checked=a),e.classList.toggle("selected",a)})}(n),Y(n)}}})}}()}else e.innerHTML='<div class="filter-panel-hint">请先点击"启用筛选"加载字段</div>'}function Z(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function Y(e){var t=I[e];if(t){var n=document.querySelector('.filter-tag[data-field-index="'.concat(e,'"]'));if(n){var a=t.selectedValues.size,r=t.allValues.length,o=a<r;n.classList.toggle("filtered",o);var c=n.querySelector(".filter-tag-count");c&&(c.textContent=o?"".concat(a,"/").concat(r):"".concat(r))}}}function J(){return J=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(0!==I.length){e.n=1;break}return x("请先加载筛选面板",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,s,i,u,d,f,m,g,v,h,y,b,E,k,S,R,A,N,B,L;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook,(r=w?a.worksheets.getItem(w.sheetName):a.worksheets.getActiveWorksheet()).activate(),(o=r.getUsedRange()).load("values, rowCount, rowIndex"),e.n=1,t.sync();case 1:if(o.values&&0!==o.values.length){e.n=2;break}return x("工作表没有数据",!0),e.a(2);case 2:c=o.rowIndex+1,s=c+o.rowCount-1,i=[],u=l(I);try{for(u.s();!(d=u.n()).done;)(f=d.value).selectedValues.size<f.allValues.length&&f.selectedValues.size>0&&i.push({colIdx:f.columnIndex,allowedValues:f.selectedValues,headerText:f.headerText})}catch(e){u.e(e)}finally{u.f()}for(m=c+1;m<=s;m++)r.getRange("".concat(m,":").concat(m)).rowHidden=!1;return e.n=3,t.sync();case 3:if(0!==i.length){e.n=4;break}return M([]),x("已清除所有筛选，显示全部数据"),e.a(2);case 4:g=0,v=0,h=1;case 5:if(!(h<o.values.length)){e.n=14;break}y=o.values[h],b=c+h,E=!1,k=l(i),e.p=6,k.s();case 7:if((S=k.n()).done){e.n=9;break}if(!((R=S.value).colIdx<y.length)){e.n=8;break}if(A=y[R.colIdx],N=null!=A?String(A):"",R.allowedValues.has(N)){e.n=8;break}return E=!0,e.a(3,9);case 8:e.n=7;break;case 9:e.n=11;break;case 10:e.p=10,L=e.v,k.e(L);case 11:return e.p=11,k.f(),e.f(11);case 12:E?(r.getRange("".concat(b,":").concat(b)).rowHidden=!0,g++):v++;case 13:h++,e.n=5;break;case 14:return e.n=15,t.sync();case 15:M(i.map(function(e){return{columnIndex:e.colIdx,columnName:p(e.colIdx),headerText:e.headerText,filterType:"values",filterValues:Array.from(e.allowedValues),isFiltered:!0}})),B=i.map(function(e){var t=e.allowedValues.size;return"".concat(e.headerText,"(").concat(t,"项)")}).join(", "),x("已应用筛选: ".concat(B," | 可见").concat(v,"行, 隐藏").concat(g,"行")),C("应用筛选: ".concat(B));case 16:return e.a(2)}},e,null,[[6,10,11,12]])}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("应用筛选时出错:",t),x("应用筛选失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),J.apply(this,arguments)}function Q(){return Q=u(n().m(function e(){var t,a,r,o;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:t=l(I);try{for(t.s();!(a=t.n()).done;)(r=a.value).selectedValues=new Set(r.allValues)}catch(e){t.e(e)}finally{t.f()}return K(),e.p=1,e.n=2,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c;return n().w(function(e){for(;;)switch(e.n){case 0:return a=t.workbook,r=w?a.worksheets.getItem(w.sheetName):a.worksheets.getActiveWorksheet(),(o=r.getUsedRange()).load("rowCount"),e.n=1,t.sync();case 1:for(c=2;c<=o.rowCount;c++)r.getRange("".concat(c,":").concat(c)).rowHidden=!1;return e.n=2,t.sync();case 2:M([]),x("已清除所有筛选");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,o=e.v,console.error("清除筛选时出错:",o),x("清除筛选失败: ".concat(o.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),Q.apply(this,arguments)}function X(){return ee.apply(this,arguments)}function ee(){return(ee=u(n().m(function e(){var t,a,r,c,s,i,u;return n().w(function(e){for(;;)switch(e.n){case 0:a=[],r=l(I);try{for(r.s();!(c=r.n()).done;)(s=c.value).selectedValues.size<s.allValues.length&&s.selectedValues.size>0&&(a.push({columnIndex:s.columnIndex,columnName:p(s.columnIndex),headerText:s.headerText,filterType:"values",filterValues:Array.from(s.selectedValues),isFiltered:!0}),C("筛选条件 - ".concat(s.headerText,": ").concat(s.selectedValues.size,"/").concat(s.allValues.length,"项")))}catch(e){r.e(e)}finally{r.f()}if(0!==a.length){e.n=1;break}return C("没有筛选条件需要保存"),e.a(2);case 1:i={id:"filter_".concat(Date.now()),name:"筛选条件_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(t=w)||void 0===t?void 0:t.sheetName)||"未知",filterSettings:a,config:w?o({},w):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}},b.unshift(i),_(),U(),u=a.length,C("已保存筛选条件: ".concat(u," 列有筛选"));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return ne=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(w&&w.sheetName){e.n=1;break}return x("未配置主报表",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(n().m(function e(t){var a,r;return n().w(function(e){for(;;)switch(e.n){case 0:return a=t.workbook,(r=a.worksheets.getItem(w.sheetName)).activate(),r.getRange("A1").select(),e.n=1,t.sync();case 1:x("已跳转到主报表: ".concat(w.sheetName));case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("跳转到主报表失败:",t),x("跳转失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),ne.apply(this,arguments)}function ae(){return ae=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(w&&w.sheetName){e.n=1;break}return x("未配置主报表",!0),e.a(2);case 1:return e.p=1,e.n=2,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,s,i,u,d,f;return n().w(function(e){for(;;)switch(e.n){case 0:return a=t.workbook,(r=a.worksheets.getItem(w.sheetName)).activate(),(o=r.getUsedRange()).load("rowCount, rowIndex"),e.n=1,t.sync();case 1:for(c=o.rowIndex+1,s=c+o.rowCount-1,i=c+1;i<=s;i++)r.getRange("".concat(i,":").concat(i)).rowHidden=!1;return r.getRange("A1").select(),e.n=2,t.sync();case 2:u=l(I);try{for(u.s();!(d=u.n()).done;)(f=d.value).selectedValues=new Set(f.allValues)}catch(e){u.e(e)}finally{u.f()}G=-1,K(),U(),x("已重置筛选并跳转到主报表");case 3:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:e.n=4;break;case 3:e.p=3,t=e.v,console.error("重置筛选失败:",t),x("重置失败: ".concat(t.message),!0);case 4:return e.a(2)}},e,null,[[1,3]])})),ae.apply(this,arguments)}function re(){return re=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,s,i,u,m,g,y,b,w,E,k,S,N,B,L,T,V,F,j,O,z,D,H,_,P,$,M,U,W,G,K,Z,Y,J,Q,ee,te,ne,ae,re,oe,ce,le,se,ie,ue,de,fe,me,ge,pe,ve,he,ye,be,we,Ie;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook,(r=a.worksheets.getActiveWorksheet()).load("name"),o=null,c=null,s="",e.p=1,(i=a.names.getItem(d)).load("name, formula"),e.n=2,t.sync();case 2:return s=r.name,(u=i.getRange()).load("columnIndex, address, columnCount"),e.n=3,t.sync();case 3:m=u.columnIndex,g=h(i.formula),y=null,g&&(y=v(g)),o=null!==y?y:m,C("S/N 列 NamedItem: ".concat(i.name)),C("  公式: ".concat(i.formula)),C("  地址: ".concat(u.address)),C("  从 Range 获取列索引: ".concat(m," (列 ").concat(p(m),")")),g&&C("  从公式解析列名: ".concat(g,", 列索引: ").concat(y)),C("  最终使用列索引: ".concat(o," (列 ").concat(p(o),")")),e.n=5;break;case 4:return e.p=4,e.v,x('错误: 未配置 S/N 列，请先点击"设为 S/N 列"按钮',!0),e.a(2);case 5:return e.p=5,(b=a.names.getItem(f)).load("name, formula"),e.n=6,t.sync();case 6:return(w=b.getRange()).load("columnIndex, address, columnCount"),e.n=7,t.sync();case 7:E=w.columnIndex,k=h(b.formula),S=null,k&&(S=v(k)),c=null!==S?S:E,C("金额列 NamedItem: ".concat(b.name)),C("  公式: ".concat(b.formula)),C("  地址: ".concat(w.address)),C("  从 Range 获取列索引: ".concat(E," (列 ").concat(p(E),")")),k&&C("  从公式解析列名: ".concat(k,", 列索引: ").concat(S)),C("  最终使用列索引: ".concat(c," (列 ").concat(p(c),")")),e.n=9;break;case 8:return e.p=8,e.v,x('错误: 未配置金额列，请先点击"设为金额列"按钮',!0),e.a(2);case 9:if(N=r.getUsedRange()){e.n=10;break}return x("错误: 无法获取工作表使用范围",!0),e.a(2);case 10:return N.load("rowCount, columnCount, address, values"),B=[],e.n=11,t.sync();case 11:if(0!==N.rowCount&&0!==N.columnCount){e.n=12;break}return x("错误: 当前工作表没有数据",!0),e.a(2);case 12:for(L=N.rowCount,T=N.columnCount,V=1;V<=L;V++)(F=r.getRange("".concat(V,":").concat(V))).load("rowHidden"),B.push(F);return e.n=13,t.sync();case 13:if(N.values&&0!==N.values.length){e.n=14;break}return x("错误: 无法读取工作表数据 (行数: ".concat(L,", 列数: ").concat(T,")"),!0),e.a(2);case 14:for(R(),C("开始处理数据..."),C("S/N 列索引: ".concat(o,", 金额列索引: ").concat(c)),o===c&&C("警告: S/N 列和金额列的索引相同！这可能导致错误。"),j=[],N.values.length>0&&N.values[0]&&j.push(N.values[0]),O=1;O<L&&O<B.length&&O<N.values.length;O++)(z=B[O])&&!z.rowHidden&&(D=N.values[O])&&Array.isArray(D)&&j.push(D);for(H=j.length-1,C("筛选完成，可见数据行数: ".concat(H)),_=0,P=[],$=1;$<j.length;$++)M=j[$],U=$+1,M&&Array.isArray(M)&&null!==c&&c>=0&&c<M.length?(W=M[c],G=null!==o&&o>=0&&o<M.length?M[o]:"N/A",null!=W&&""!==W?(K=A(W),_+=K,P.push(K),Z="string"==typeof W?'"'.concat(W,'"'):String(W),C("Row ".concat(U,": SN列[").concat(o,"]=").concat(G,", 金额列[").concat(c,"]=").concat(Z," -> Clean=").concat(K.toFixed(2)))):C("Row ".concat(U,": SN列[").concat(o,"]=").concat(G,", 金额列[").concat(c,"]=空"))):C("Row ".concat(U,": 警告 - 金额列索引 ").concat(c," 超出数据范围 (数据长度: ").concat(M?M.length:0,")"));C("--- 汇总 ---"),C("总金额: ".concat(_.toFixed(2))),C("金额明细: [".concat(P.map(function(e){return e.toFixed(2)}).join(", "),"]")),Y=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19),J="报表_".concat(Y),e.p=15,Q=a.worksheets.add(J),e.n=21;break;case 16:e.p=16,e.v,ee=1;case 17:return e.p=18,Q=a.worksheets.add("".concat(J,"_").concat(ee)),e.a(3,21);case 19:e.p=19,e.v,ee++;case 20:e.n=17;break;case 21:Q.load("name"),te="无筛选条件";try{ne=[],ae=l(I);try{for(ae.s();!(re=ae.n()).done;)(oe=re.value).selectedValues.size<oe.allValues.length&&oe.selectedValues.size>0&&(ce=Array.from(oe.selectedValues),void 0,le=ce.length<=5?ce.join(", "):ce.slice(0,5).join(", ")+"... (共".concat(ce.length,"项)"),ne.push("".concat(oe.headerText,": ").concat(le)),C("筛选条件 - ".concat(oe.headerText,": ").concat(ce.length,"/").concat(oe.allValues.length,"项")))}catch(e){ae.e(e)}finally{ae.f()}if(ne.length>0)te=ne.join("; "),C("筛选条件: ".concat(te));else{for(se=0,ie=1;ie<B.length;ie++)B[ie]&&B[ie].rowHidden&&se++;se>0?(te="已筛选 (隐藏".concat(se,"行)"),C("有".concat(se,"行被隐藏"))):C("未检测到筛选条件")}}catch(e){console.warn("获取筛选条件失败:",e),C("获取筛选条件失败: ".concat(e.message))}if((ue=Q.getRange("A1:E6")).format.verticalAlignment=Excel.VerticalAlignment.center,ue.format.horizontalAlignment=Excel.HorizontalAlignment.left,ue.format.fill.color="#F5F5F5",ue.format.font.name="Arial",ue.format.font.size=11,ue.format.font.color="#323130",de=[["报表 Dashboard","","","",""],["总条数",H.toString(),"","源表名称",s],["总金额",_.toFixed(2),"","生成时间",(new Date).toLocaleString("zh-CN")],["筛选条件",te,"","",""],["","","","",""],["","","","",""]],ue.values=de,(fe=Q.getRange("A1:E1")).merge(),fe.format.font.size=14,fe.format.font.bold=!0,fe.format.font.color="#0078d4",fe.format.horizontalAlignment=Excel.HorizontalAlignment.center,(me=Q.getRange("A2:A4")).format.font.bold=!0,me.format.font.color="#323130",(ge=Q.getRange("B2:B3")).format.font.color="#0078d4",ge.format.font.bold=!0,(pe=Q.getRange("A4")).format.font.bold=!0,pe.format.font.color="#323130",(ve=Q.getRange("B4:E4")).merge(),ve.format.font.color="#605e5c",ve.format.wrapText=!0,Q.getRange("D2:D3").format.font.bold=!0,Q.getRange("E2:E3").format.font.color="#323130",ue.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("EdgeTop").color="#D1D1D1",ue.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("EdgeBottom").color="#D1D1D1",ue.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("EdgeLeft").color="#D1D1D1",ue.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("EdgeRight").color="#D1D1D1",ue.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("InsideHorizontal").color="#E1E1E1",ue.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,ue.format.borders.getItem("InsideVertical").color="#E1E1E1",j.length>0&&(he=p(T-1),(ye=Q.getRange("A6:".concat(he).concat(6+j.length-1))).values=j,ye.format.font.name="Arial",ye.format.font.size=11,ye.format.font.color="#323130",ye.format.verticalAlignment=Excel.VerticalAlignment.center,ye.format.horizontalAlignment=Excel.HorizontalAlignment.left,(be=Q.getRange("A6:".concat(he,"6"))).format.fill.color="#0078d4",be.format.font.bold=!0,be.format.font.color="#FFFFFF",be.format.font.size=11,be.format.font.name="Arial",be.format.horizontalAlignment=Excel.HorizontalAlignment.center,be.format.verticalAlignment=Excel.VerticalAlignment.center,be.format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,be.format.borders.getItem("EdgeTop").color="#005a9e",be.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,be.format.borders.getItem("EdgeBottom").color="#005a9e",be.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,be.format.borders.getItem("EdgeLeft").color="#005a9e",be.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,be.format.borders.getItem("EdgeRight").color="#005a9e",j.length>1))for((we=Q.getRange("A7:".concat(he).concat(6+j.length-1))).format.borders.getItem("EdgeTop").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("EdgeTop").color="#E1E1E1",we.format.borders.getItem("EdgeBottom").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("EdgeBottom").color="#E1E1E1",we.format.borders.getItem("EdgeLeft").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("EdgeLeft").color="#E1E1E1",we.format.borders.getItem("EdgeRight").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("EdgeRight").color="#E1E1E1",we.format.borders.getItem("InsideHorizontal").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("InsideHorizontal").color="#F0F0F0",we.format.borders.getItem("InsideVertical").style=Excel.BorderLineStyle.continuous,we.format.borders.getItem("InsideVertical").color="#F0F0F0",Ie=7;Ie<=6+j.length;Ie++)Q.getRange("A".concat(Ie,":").concat(he).concat(Ie)).format.fill.color=(Ie-7)%2==0?"#FAFAFA":"#FFFFFF";return Q.getUsedRange().format.autofitColumns(),Q.getUsedRange().format.rowHeight=20,Q.getRange("1:6").format.rowHeight=25,Q.getRange("4:4").format.rowHeight=30,Q.activate(),e.n=22,t.sync();case 22:return q(Q.name,H,_),e.n=23,X();case 23:x("报表生成成功！共 ".concat(H," 条记录，总金额: ").concat(_.toFixed(2)));case 24:return e.a(2)}},e,null,[[18,19],[15,16],[5,8],[1,4]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("生成报表时出错:",t),x("生成报表失败: ".concat(t.message),!0);case 3:return e.a(2)}},e,null,[[0,2]])})),re.apply(this,arguments)}function oe(){return oe=u(n().m(function e(){var t;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Excel.run(function(){var e=u(n().m(function e(t){var a,r,o,c,l,s,i,u,p;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=t.workbook,e.p=1,(r=a.names.getItem(m)).load("formula"),e.n=2,t.sync();case 2:(o=r.formula.match(/=([^!]+)!([^$]+)/))&&(w?(w.dataRange=r.formula.replace(/^=/,""),w.sheetName=o[1]):w={dataRange:r.formula.replace(/^=/,""),headerRow:0,snColumn:0,amtColumn:0,sheetName:o[1]}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.p=4,(c=a.names.getItem(g)).load("formula"),e.n=5,t.sync();case 5:(l=c.formula.match(/:(\d+):/))&&w&&(w.headerRow=parseInt(l[1])),e.n=7;break;case 6:e.p=6,e.v;case 7:return e.p=7,s=a.names.getItem(d),(i=s.getRange()).load("columnIndex"),e.n=8,t.sync();case 8:w&&(w.snColumn=i.columnIndex),e.n=10;break;case 9:e.p=9,e.v;case 10:return e.p=10,u=a.names.getItem(f),(p=u.getRange()).load("columnIndex"),e.n=11,t.sync();case 11:w&&(w.amtColumn=p.columnIndex),e.n=13;break;case 12:e.p=12,e.v;case 13:return e.a(2)}},e,null,[[10,12],[7,9],[4,6],[1,3]])}));return function(t){return e.apply(this,arguments)}}());case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("加载主报表配置时出错:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),oe.apply(this,arguments)}Office.onReady(function(e){var t,n,a,r,c,l,s,i,u,d,m;e.host===Office.HostType.Excel&&(null===(t=document.getElementById("btn-set-data-range"))||void 0===t||t.addEventListener("click",function(){!function(){N.apply(this,arguments)}()}),null===(n=document.getElementById("btn-set-header-row"))||void 0===n||n.addEventListener("click",function(){!function(){B.apply(this,arguments)}()}),null===(a=document.getElementById("btn-set-sn"))||void 0===a||a.addEventListener("click",function(){!function(){T.apply(this,arguments)}()}),null===(r=document.getElementById("btn-set-amt"))||void 0===r||r.addEventListener("click",function(){!function(e,t){L.apply(this,arguments)}(f,"金额列")}),null===(c=document.getElementById("btn-enable-filter"))||void 0===c||c.addEventListener("click",function(){!function(){W.apply(this,arguments)}()}),null===(l=document.getElementById("btn-generate"))||void 0===l||l.addEventListener("click",function(){!function(){re.apply(this,arguments)}()}),null===(s=document.getElementById("btn-apply-filter"))||void 0===s||s.addEventListener("click",function(){!function(){J.apply(this,arguments)}()}),null===(i=document.getElementById("btn-clear-filter"))||void 0===i||i.addEventListener("click",function(){!function(){Q.apply(this,arguments)}()}),null===(u=document.getElementById("btn-save-filter"))||void 0===u||u.addEventListener("click",function(){!function(){var e;if(0!==I.length){for(var t=[],n=0,a=I;n<a.length;n++){var r=a[n];r.selectedValues.size<r.allValues.length&&r.selectedValues.size>0&&t.push({columnIndex:r.columnIndex,columnName:p(r.columnIndex),headerText:r.headerText,filterType:"values",filterValues:Array.from(r.selectedValues),isFiltered:!0})}if(0!==t.length){var c={id:"filter_".concat(Date.now()),name:"筛选_".concat((new Date).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),createTime:(new Date).toISOString(),sheetName:(null===(e=w)||void 0===e?void 0:e.sheetName)||"未知",filterSettings:t,config:w?o({},w):{dataRange:"",headerRow:1,snColumn:0,amtColumn:0,sheetName:""}};b.unshift(c),_();var l=t.map(function(e){return"".concat(e.headerText,"(").concat(e.filterValues.length,"项)")}).join(", ");x("已保存筛选条件: ".concat(l))}else x("没有需要保存的筛选条件（所有字段都是全选状态）",!0)}else x("请先加载筛选面板",!0)}()}),null===(d=document.getElementById("btn-reset-filter"))||void 0===d||d.addEventListener("click",function(){!function(){ae.apply(this,arguments)}()}),null===(m=document.getElementById("data-range-info"))||void 0===m||m.addEventListener("click",function(){te()}),function(){return oe.apply(this,arguments)}().then(function(){V(),F(),_()}),console.log("Excel Add-in 初始化完成"))})}(),function(){"use strict";new URL(n(58394),n.b)}()}();
//# sourceMappingURL=taskpane.js.map