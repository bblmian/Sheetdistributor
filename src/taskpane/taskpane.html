<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>报表生成器</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <!-- Office UI Fabric Core -->
    <link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css">

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />
</head>

<body class="ms-Fabric ms-font-m">
    <div class="ms-Grid" dir="ltr">
        <main class="ms-Grid-row">
            <div class="ms-Grid-col ms-sm12">
                <!-- Header -->
                <header class="app-header">
                    <div class="header-content">
                        <i class="ms-Icon ms-Icon--ExcelDocument header-icon" aria-hidden="true"></i>
                        <span class="ms-font-l ms-fontWeight-semibold header-title">报表生成器</span>
                    </div>
        </header>
                
                <!-- 配置主报表 Section -->
                <section class="ms-Grid-row section-card">
                    <div class="ms-Grid-col ms-sm12">
                        <div class="section-header">
                            <i class="ms-Icon ms-Icon--Settings section-icon" aria-hidden="true"></i>
                            <span class="ms-font-m-plus ms-fontWeight-semibold">配置主报表</span>
                        </div>
                        <p class="ms-font-s section-hint">按顺序选择主报表的各个部分</p>
                        
                        <div class="config-steps">
                            <!-- Step 1: 数据区域 -->
                            <div class="config-step ms-Grid-row">
                                <div class="ms-Grid-col ms-sm4 step-label-col">
                                    <span class="ms-font-s ms-fontWeight-semibold step-number">1.</span>
                                    <span class="ms-font-s ms-fontWeight-semibold">主报表区域</span>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <button id="btn-set-data-range" class="ms-Button ms-Button--small">
                                        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Table" aria-hidden="true"></i></span>
                                        <span class="ms-Button-label">选择区域</span>
                                    </button>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <span id="data-range-info" class="step-value clickable ms-font-s" title="点击跳转到主报表">未配置</span>
                                </div>
                            </div>
                            
                            <!-- Step 2: 标题行 -->
                            <div class="config-step ms-Grid-row">
                                <div class="ms-Grid-col ms-sm4 step-label-col">
                                    <span class="ms-font-s ms-fontWeight-semibold step-number">2.</span>
                                    <span class="ms-font-s ms-fontWeight-semibold">标题行</span>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <button id="btn-set-header-row" class="ms-Button ms-Button--small">
                                        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Header" aria-hidden="true"></i></span>
                                        <span class="ms-Button-label">选择标题行</span>
                                    </button>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <span id="header-row-info" class="step-value ms-font-s">未配置</span>
                                </div>
                            </div>
                            
                            <!-- Step 3: S/N 列 -->
                            <div class="config-step ms-Grid-row">
                                <div class="ms-Grid-col ms-sm4 step-label-col">
                                    <span class="ms-font-s ms-fontWeight-semibold step-number">3.</span>
                                    <span class="ms-font-s ms-fontWeight-semibold">S/N 列</span>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <button id="btn-set-sn" class="ms-Button ms-Button--small">
                                        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--NumberField" aria-hidden="true"></i></span>
                                        <span class="ms-Button-label">选择 S/N 列</span>
                                    </button>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <span id="sn-col-info" class="step-value ms-font-s">未配置</span>
                                </div>
                            </div>
                            
                            <!-- Step 4: 金额列 -->
                            <div class="config-step ms-Grid-row">
                                <div class="ms-Grid-col ms-sm4 step-label-col">
                                    <span class="ms-font-s ms-fontWeight-semibold step-number">4.</span>
                                    <span class="ms-font-s ms-fontWeight-semibold">金额列</span>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <button id="btn-set-amt" class="ms-Button ms-Button--small">
                                        <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Money" aria-hidden="true"></i></span>
                                        <span class="ms-Button-label">选择金额列</span>
            </button>
                                </div>
                                <div class="ms-Grid-col ms-sm4">
                                    <span id="amt-col-info" class="step-value ms-font-s">未配置</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="config-actions">
                            <button id="btn-enable-filter" class="ms-Button ms-Button--primary">
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--FilterSolid" aria-hidden="true"></i></span>
                                <span class="ms-Button-label">启用筛选</span>
            </button>
                        </div>
                    </div>
                </section>
                
                <!-- 筛选面板 Section -->
                <section class="ms-Grid-row section-card">
                    <div class="ms-Grid-col ms-sm12">
                        <div class="section-header">
                            <i class="ms-Icon ms-Icon--Filter section-icon" aria-hidden="true"></i>
                            <span class="ms-font-m-plus ms-fontWeight-semibold">筛选面板</span>
                        </div>
                        
                        <div id="filter-panel" class="filter-panel">
                            <div class="filter-panel-hint ms-font-s">
                                <i class="ms-Icon ms-Icon--Info" aria-hidden="true"></i>
                                请先点击"启用筛选"加载字段
                            </div>
                        </div>
                        
                        <div class="filter-actions">
                            <button id="btn-reset-filter" class="ms-Button ms-Button--icon" title="重置：清除所有筛选并跳转到主报表" disabled>
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Refresh" aria-hidden="true"></i></span>
                            </button>
                            <button id="btn-apply-filter" class="ms-Button ms-Button--primary ms-Button--icon" title="应用筛选" disabled>
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Filter" aria-hidden="true"></i></span>
                            </button>
                            <button id="btn-generate" class="ms-Button ms-Button--icon btn-success" title="生成过滤报表" disabled>
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--DocumentSet" aria-hidden="true"></i></span>
                            </button>
                            <button id="btn-save-filter" class="ms-Button ms-Button--icon" title="保存筛选条件" disabled>
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Save" aria-hidden="true"></i></span>
                            </button>
                            <button id="btn-clear-filter" class="ms-Button ms-Button--icon btn-danger" title="清除当前筛选" disabled>
                                <span class="ms-Button-icon"><i class="ms-Icon ms-Icon--Cancel" aria-hidden="true"></i></span>
            </button>
                        </div>
                        
                        <div id="current-filter-display" class="current-filter-display">
                            <div class="no-filters ms-font-s">
                                <i class="ms-Icon ms-Icon--Info" aria-hidden="true"></i>
                                当前未应用筛选条件
                            </div>
                        </div>
                        
                        <div class="subsection-header">
                            <i class="ms-Icon ms-Icon--FavoriteList" aria-hidden="true"></i>
                            <span class="ms-font-s ms-fontWeight-semibold">已保存的筛选条件</span>
                        </div>
                        <div id="filter-conditions-list" class="filter-conditions-list">
                            <div class="no-filters ms-font-s">暂无保存的筛选条件</div>
                        </div>
                    </div>
                </section>
                
                <!-- 已生成的报表 Section -->
                <section class="ms-Grid-row section-card">
                    <div class="ms-Grid-col ms-sm12">
                        <div class="section-header">
                            <i class="ms-Icon ms-Icon--ReportDocument section-icon" aria-hidden="true"></i>
                            <span class="ms-font-m-plus ms-fontWeight-semibold">已生成的报表</span>
                        </div>
                        
                        <div class="ms-Table" id="reports-table-container">
                            <table id="reports-table" class="reports-table">
                                <thead>
                                    <tr>
                                        <th class="ms-font-s ms-fontWeight-semibold">报表名称</th>
                                        <th class="ms-font-s ms-fontWeight-semibold">生成时间</th>
                                        <th class="ms-font-s ms-fontWeight-semibold">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="reports-table-body">
                                    <tr>
                                        <td colspan="3" class="no-reports ms-font-s">
                                            <i class="ms-Icon ms-Icon--DocumentSearch" aria-hidden="true"></i>
                                            暂无报表
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
        </section>
                
                <!-- Message Area -->
                <div id="message-area" class="message-area ms-font-s"></div>
                
                <!-- 筛选条件文本区域 -->
                <div id="filter-text-container" class="filter-text-container" style="display: none;">
                    <div class="filter-text-header">
                        <i class="ms-Icon ms-Icon--Copy" aria-hidden="true"></i>
                        <span class="ms-font-s ms-fontWeight-semibold">筛选条件（点击复制）</span>
                        <span id="copy-success-hint" class="copy-success-hint ms-font-xs">已复制!</span>
                    </div>
                    <div id="filter-text-content" class="filter-text-content ms-font-s" title="点击复制到剪贴板"></div>
                </div>
                
                <!-- Debug Log -->
                <div id="debug-log" class="debug-log ms-font-xs"></div>
            </div>
    </main>
    </div>
    
    <!-- 确认对话框 -->
    <div id="confirm-dialog" class="ms-Dialog confirm-dialog-overlay">
        <div class="ms-Dialog-main confirm-dialog">
            <div class="ms-Dialog-header confirm-dialog-header">
                <p class="ms-Dialog-title ms-font-l ms-fontWeight-semibold">
                    <i class="ms-Icon ms-Icon--Warning" aria-hidden="true"></i>
                    确认操作
                </p>
            </div>
            <div class="ms-Dialog-inner">
                <div class="ms-Dialog-content confirm-dialog-body">
                    <p id="confirm-dialog-message" class="ms-font-m">确定要删除此报表吗？此操作不可恢复。</p>
                </div>
                <div class="ms-Dialog-actions confirm-dialog-footer">
                    <button id="confirm-dialog-cancel" class="ms-Button">
                        <span class="ms-Button-label">取消</span>
                    </button>
                    <button id="confirm-dialog-ok" class="ms-Button ms-Button--primary">
                        <span class="ms-Button-label">确定</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 进度条叠加层 -->
    <div id="progress-overlay" class="ms-Dialog progress-overlay">
        <div class="ms-Dialog-main progress-dialog">
            <div class="ms-Dialog-header progress-header">
                <i class="ms-Icon ms-Icon--Processing spinning-icon" aria-hidden="true"></i>
                <span id="progress-title" class="ms-font-l ms-fontWeight-semibold">处理中...</span>
            </div>
            <div class="ms-Dialog-inner progress-body">
                <p id="progress-message" class="ms-font-m">正在处理合并单元格，请耐心等待...</p>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
                <p id="progress-detail" class="progress-detail ms-font-s">0 / 0</p>
            </div>
        </div>
    </div>
</body>

</html>
